
. * ch06_The_Least_Squares_Estimator.do - January 2026 For Stata
. * Updated for online execution portability
. 
. ********** OVERVIEW OF ch06_The_Least_Squares_Estimator.do **********
. 
. * STATA Program
. * copyright C 2021 by A. Colin Cameron
. * Used for "Analyis of Economics Data: An Introduction to Econometrics"
. * by A. Colin Cameron (2021)
. 
. * To run you need file
. *   AED_GENERATEDDATA.DTA
. *   AED_GENERATEDREGRESSION.DTA
. *   AED_CENSUSREGRESSIONSDTA
. * in your directory
. 
. ********** SETUP **********
. 
. * Set random seed for reproducibility
. set seed 42

. 
. * Clear all macros
. macro drop _all

. 
. * GitHub data URL
. global github_data_url "https://raw.githubusercontent.com/quarcs-lab/data-ope
> n/master/AED/"

. 
. * Create output directories (optional - for saving figures and tables locally
> )
. cap mkdir "images"

. cap mkdir "tables"

. 
. set more off

. clear all

. 
. ************
. 
. * This STATA does analysis for Chapter 6
. *  6.1 POPULATION AND SAMPLE
. *  6.2 EXAMPLES OF SAMPLING FROM A POPULATION
. *  6.3 PROPERTIES OF THE LEAST SQUARES ESTIMATOR
. *  6.4 ESTIMATORS OF MODEL PARAMETERS
. 
. ********** DATA DESCRIPTION
. 
. * Two datasets are generated
. * The third comes from analysis of the 1880 U.S. Census
. 
. ****  6.1 POPULATION AND SAMPLE
. 
. * Figure 6.1 compares error and residual - uses no data
. 
. ****  6.2 EXAMPLES OF SAMPLING FROM A POPULATION
. 
. * Download and load data from GitHub
. clear

. copy "${github_data_url}AED_GENERATEDDATA.DTA" "temp_data.dta", replace
(file temp_data.dta not found)

. use "temp_data.dta", clear
(Data for A. Colin Cameron (2020): Analysis of Economics Data)

. erase "temp_data.dta"

. describe

Contains data from temp_data.dta
 Observations:             5                  Data for A. Colin Cameron
                                                (2020): Analysis of Economics
                                                Data
    Variables:             4                  14 Jul 2020 18:06
-------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
-------------------------------------------------------------------------------
x               float   %9.0g                 Regressor
Eygivenx        float   %9.0g                 Conditional mean E[y}x]
u               float   %9.0g                 Error term
y               float   %9.0g                 Actual value of y
-------------------------------------------------------------------------------
Sorted by: 

. summarize

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
           x |          5           3    1.581139          1          5
    Eygivenx |          5           7    3.162278          3         11
           u |          5   -1.031908    1.753559  -2.506667   1.689889
           y |          5    5.968092    1.897129   4.493333   8.609236

. 
. * Table 6.1
. list

     +-------------------------------------+
     | x   Eygivenx           u          y |
     |-------------------------------------|
  1. | 1          3    1.689889   4.689889 |
  2. | 2          5   -.3187171   4.681283 |
  3. | 3          7   -2.506667   4.493333 |
  4. | 4          9    -1.63328    7.36672 |
  5. | 5         11   -2.390764   8.609236 |
     +-------------------------------------+

. 
. /* Aside; This is how the data were generated ...
> clear
> set obs 5
> * This uses the old Stata random number generator
> set rng kiss32
> * This sets x to equal the observation number
> generate x = _n
> generate Eygivenx = 1 + 2*x
> set seed 123456
> generate u = rnormal(0,2)
> generate y = ygivenx + u
> list
> */
. 
. regress y x

      Source |       SS           df       MS      Number of obs   =         5
-------------+----------------------------------   F(1, 3)         =     10.01
       Model |   11.075732         1   11.075732   Prob > F        =    0.0507
    Residual |  3.32066288         3  1.10688763   R-squared       =    0.7693
-------------+----------------------------------   Adj R-squared   =    0.6925
       Total |  14.3963948         4  3.59909871   Root MSE        =    1.0521

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   1.052413   .3326992     3.16   0.051    -.0063843     2.11121
       _cons |   2.810853   1.103438     2.55   0.084    -.7007806    6.322487
------------------------------------------------------------------------------

. 
. * Figure 6.2 - simple version
. * Panel A
. twoway (scatter y x) (lfit Eygivenx x), title("Population line")

. graph export "images/ch06_fig2a.png", replace
(file images/ch06_fig2a.png not found)
file images/ch06_fig2a.png written in PNG format

. * Panel B
. twoway (scatter y x) (lfit y x), title("Regression line")

. graph export "images/ch06_fig2b.png", replace
(file images/ch06_fig2b.png not found)
file images/ch06_fig2b.png written in PNG format

. 
. * Three regressions from the same model
. clear

. set obs 30
Number of observations (_N) was 0, now 30.

. set seed 12345

. generate x1 = rnormal(3,1)

. generate u1 = rnormal(0,2)

. generate y1 = 1 + 2*x1 + u1

. generate x2 = rnormal(3,1)

. generate u2 = rnormal(0,2)

. generate y2 = 1 + 2*x2 + u2

. generate x3 = rnormal(3,1)

. generate u3 = rnormal(0,2)

. generate y3 = 1 + 2*x3 + u3

. regress y1 x1, noheader
------------------------------------------------------------------------------
          y1 | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
          x1 |   1.664693   .2902594     5.74   0.000     1.070123    2.259262
       _cons |   1.912222   1.030809     1.86   0.074     -.199294    4.023738
------------------------------------------------------------------------------

. regress y2 x2, noheader
------------------------------------------------------------------------------
          y2 | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
          x2 |   1.688137   .4954089     3.41   0.002     .6733376    2.702936
       _cons |   1.722569    1.58552     1.09   0.287    -1.525221    4.970358
------------------------------------------------------------------------------

. regress y3 x3, noheader
------------------------------------------------------------------------------
          y3 | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
          x3 |   2.408172   .3959205     6.08   0.000     1.597166    3.219179
       _cons |  -.7608028    1.33628    -0.57   0.574    -3.498047    1.976442
------------------------------------------------------------------------------

. 
. * Figure 6.3 - simple version
. graph twoway (scatter y1 x1) (lfit y1 x1), saving(graph1, replace)
file graph1.gph saved

. graph twoway (scatter y2 x2) (lfit y2 x2), saving(graph2, replace)
file graph2.gph saved

. graph twoway (scatter y3 x3) (lfit y3 x3), saving(graph3, replace)
(file graph3.gph not found)
file graph3.gph saved

. graph combine graph1.gph graph2.gph graph3.gph, ysize(2) xsize(6) rows(1) yco
> mmon xcommon

. 
. * Download and load data from GitHub - results of regression on 400 samples o
> f size 30
. clear

. copy "${github_data_url}AED_GENERATEDREGRESSIONS.DTA" "temp_data.dta", replac
> e
(file temp_data.dta not found)

. use "temp_data.dta", clear
(Data for A. Colin Cameron (2020): Analysis of Economics Data)

. erase "temp_data.dta"

. describe

Contains data from temp_data.dta
 Observations:           400                  Data for A. Colin Cameron
                                                (2020): Analysis of Economics
                                                Data
    Variables:             6                  14 Jul 2020 18:06
-------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
-------------------------------------------------------------------------------
slope           float   %9.0g                 Slope from 400 regressions
seslope         float   %9.0g                 Standard error of slope from 400
                                                regressions
intercept       float   %9.0g                 Intercept from 400 regressions
seintercept     float   %9.0g                 Standard error of intercept from
                                                400 regressions
rsquared        float   %9.0g                 R squared
numobs          float   %9.0g                 Number of observations in each
                                                sample
-------------------------------------------------------------------------------
Sorted by: 

. summarize

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
       slope |        400    1.988085    .3779489   .5945905   3.171479
     seslope |        400    .3780352    .0739494   .1925818   .6503775
   intercept |        400    1.018384    1.191949  -2.463927   5.666123
 seintercept |        400     1.19409     .231356   .6346849   2.000806
    rsquared |        400    .4982815    .1234996   .0854527   .8198274
-------------+---------------------------------------------------------
      numobs |        400          30           0         30         30

. 
. * Figure 6.4: simple version
. histogram slope, kdensity saving(graph1, replace)
(bin=20, start=.59459049, width=.12884443)
file graph1.gph saved

. histogram intercept, kdensity saving(graph2, replace)
(bin=20, start=-2.4639266, width=.40650247)
file graph2.gph saved

. graph combine graph1.gph graph2.gph, ysize(2.5) xsize(6) rows(1) 

. 
. * Download and load data from GitHub - results of regression on 400 samples o
> f size 120
. clear

. copy "${github_data_url}AED_CENSUSREGRESSIONS.DTA" "temp_data.dta", replace
(file temp_data.dta not found)

. use "temp_data.dta", clear
(Data for A. Colin Cameron (2020): Analysis of Economics Data)

. erase "temp_data.dta"

. describe

Contains data from temp_data.dta
 Observations:           400                  Data for A. Colin Cameron
                                                (2020): Analysis of Economics
                                                Data
    Variables:             5                  14 Jul 2020 18:06
-------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
-------------------------------------------------------------------------------
slope           float   %9.0g                 Slope from 400 regressions
seslope         float   %9.0g                 Standard error of slope from 400
                                                regressions
intercept       float   %9.0g                 Intercept from 400 regressions
seintercept     float   %9.0g                 Standard error of intercept from
                                                400 regressions
numobs          float   %9.0g                 Number of observations in each
                                                sample
-------------------------------------------------------------------------------
Sorted by: 

. summarize

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
       slope |        400   -.0103776    .0071141  -.0305974   .0071605
     seslope |        400    .0064599    .0006128   .0047745   .0083247
   intercept |        400    1.560413    .4503315   .4471589   2.803185
 seintercept |        400    .4138579    .0393695   .3053623   .5315655
      numobs |        400         200           0        200        200

. list in 1/3, clean

           slope    seslope   interc~t   seinte~t   numobs  
  1.   -.0132659   .0074519   1.707933   .4797598      200  
  2.   -.0102179   .0069313   1.534607   .4446451      200  
  3.    -.004043   .0060634   1.174318   .3894077      200  

. 
. * Figure 6.5: simple version
. histogram slope, kdensity saving(graph1, replace)
(bin=20, start=-.03059739, width=.00188789)
file graph1.gph saved

. histogram intercept, kdensity saving(graph2, replace)
(bin=20, start=.44715893, width=.11780129)
file graph2.gph saved

. graph combine graph1.gph graph2.gph, ysize(2.5) xsize(6) rows(1) 

. 
. ********** CLOSE OUTPUT
. 
. display ""


. display "Chapter 06 analysis complete."
Chapter 06 analysis complete.

. display "Figures saved to: images/"
Figures saved to: images/

. display "Tables saved to: tables/"
Tables saved to: tables/

. 
. /* Brief Stata for the chapter
> * Generated data
> clear
> set obs 5
> * use the old Stata random number generator
> set rng kiss32
> * set x to equal the observation number
> generate x = _n
> generate Eygivenx = 1 + 2*x
> set seed 123456
> generate u = rnormal(0,2)
> generate y = ygivenx + u
> list
> regress y x
> twoway (scatter y x) (lfit y x)
> twoway (scatter y x) (lfit ytrue x)
> */
. 
end of do-file
