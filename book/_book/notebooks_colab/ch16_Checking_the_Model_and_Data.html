<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>16. Checking the Model and Data ‚Äì Econometrics Powered by AI</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../notebooks_colab/ch17_Panel_Data_Time_Series_Data_Causation.html" rel="next">
<link href="../notebooks_colab/ch15_Regression_with_Transformed_Variables.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-8b4baf804e461d9b72633f0de59a0cac.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-f1aadacce99040138bbb613f9330654f.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-0da87e08732b0aad79cc276a1be62fe2.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-c77ee8f8b07d41e0e364fbf0a2ddebb9.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../custom.css">
</head>

<body class="nav-sidebar floating quarto-dark"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = true;
    const darkModeDefault = authorPrefersDark;
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../notebooks_colab/ch14_Regression_with_Indicator_Variables.html">Advanced Topics</a></li><li class="breadcrumb-item"><a href="../notebooks_colab/ch16_Checking_the_Model_and_Data.html"><span class="chapter-title">16. Checking the Model and Data</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Econometrics Powered by AI</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Statistical Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch01_Analysis_of_Economics_Data.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">1. Analysis of Economics Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch02_Univariate_Data_Summary.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">2. Univariate Data Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch03_The_Sample_Mean.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">3. The Sample Mean</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch04_Statistical_Inference_for_the_Mean.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">4. Statistical Inference for the Mean</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Bivariate Regression</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch05_Bivariate_Data_Summary.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">5. Bivariate Data Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch06_The_Least_Squares_Estimator.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">6. The Least Squares Estimator</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch07_Statistical_Inference_for_Bivariate_Regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">7. Statistical Inference for Bivariate Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch08_Case_Studies_for_Bivariate_Regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">8. Case Studies for Bivariate Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch09_Models_with_Natural_Logarithms.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">9. Models with Natural Logarithms</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Multiple Regression</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch10_Data_Summary_for_Multiple_Regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">10. Data Summary for Multiple Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch11_Statistical_Inference_for_Multiple_Regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">11. Statistical Inference for Multiple Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch12_Further_Topics_in_Multiple_Regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">12. Further Topics in Multiple Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch13_Case_Studies_for_Multiple_Regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">13. Case Studies for Multiple Regression</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Advanced Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch14_Regression_with_Indicator_Variables.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">14. Regression with Indicator Variables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch15_Regression_with_Transformed_Variables.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">15. Regression with Transformed Variables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch16_Checking_the_Model_and_Data.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">16. Checking the Model and Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch17_Panel_Data_Time_Series_Data_Causation.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">17. Panel Data, Time Series Data, Causation</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#chapter-overview" id="toc-chapter-overview" class="nav-link active" data-scroll-target="#chapter-overview">Chapter Overview</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#multicollinearity" id="toc-multicollinearity" class="nav-link" data-scroll-target="#multicollinearity">16.1: Multicollinearity</a></li>
  <li><a href="#model-assumptions" id="toc-model-assumptions" class="nav-link" data-scroll-target="#model-assumptions">16.2-16.4: Model Assumptions</a></li>
  <li><a href="#heteroskedastic-errors" id="toc-heteroskedastic-errors" class="nav-link" data-scroll-target="#heteroskedastic-errors">16.5: Heteroskedastic Errors</a></li>
  <li><a href="#correlated-errors-autocorrelation" id="toc-correlated-errors-autocorrelation" class="nav-link" data-scroll-target="#correlated-errors-autocorrelation">16.6: Correlated Errors (Autocorrelation)</a></li>
  <li><a href="#example---democracy-and-growth" id="toc-example---democracy-and-growth" class="nav-link" data-scroll-target="#example---democracy-and-growth">16.7: Example - Democracy and Growth</a></li>
  <li><a href="#diagnostics---residual-plots" id="toc-diagnostics---residual-plots" class="nav-link" data-scroll-target="#diagnostics---residual-plots">16.8: Diagnostics - Residual Plots</a></li>
  <li><a href="#key-takeaways" id="toc-key-takeaways" class="nav-link" data-scroll-target="#key-takeaways">Key Takeaways</a></li>
  <li><a href="#practice-exercises" id="toc-practice-exercises" class="nav-link" data-scroll-target="#practice-exercises">Practice Exercises</a></li>
  <li><a href="#case-studies" id="toc-case-studies" class="nav-link" data-scroll-target="#case-studies">Case Studies</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<div id="google_translate_element" style="padding: 8px 0;"></div>
<script type="text/javascript">
function googleTranslateElementInit() {
  new google.translate.TranslateElement({
    pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.HORIZONTAL
  }, 'google_translate_element');
}
</script>
<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../notebooks_colab/ch14_Regression_with_Indicator_Variables.html">Advanced Topics</a></li><li class="breadcrumb-item"><a href="../notebooks_colab/ch16_Checking_the_Model_and_Data.html"><span class="chapter-title">16. Checking the Model and Data</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-title">16. Checking the Model and Data</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><strong>metricsAI: An Introduction to Econometrics with Python and AI in the Cloud</strong></p>
<p><em><a href="https://carlos-mendez.org">Carlos Mendez</a></em></p>
<p><img src="https://raw.githubusercontent.com/quarcs-lab/metricsai/main/images/ch16_visual_summary.jpg" alt="Chapter 16 Visual Summary" width="65%"></p>
<p>This notebook provides an interactive introduction to regression diagnostics and model validation. All code runs directly in Google Colab without any local setup.</p>
<a href="https://colab.research.google.com/github/quarcs-lab/metricsai/blob/main/notebooks_colab/ch16_Checking_the_Model_and_Data.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg" class="img-fluid" alt="Open In Colab"></a>
<div class="chapter-resources">
<p><a href="https://www.youtube.com/watch?v=3JVkwVXsyr0" target="_blank" class="resource-btn">üé¨ AI Video</a> <a href="https://carlos-mendez.my.canva.site/s16-checking-the-model-and-data-pdf" target="_blank" class="resource-btn">‚ú® AI Slides</a> <a href="https://cameron.econ.ucdavis.edu/aed/traedv1_16" target="_blank" class="resource-btn">üìä Cameron Slides</a> <a href="https://app.edcafe.ai/quizzes/69786b812f5d08069e04e07f" target="_blank" class="resource-btn">‚úèÔ∏è Quiz</a> <a href="https://app.edcafe.ai/chatbots/6978a3122f5d08069e07219f" target="_blank" class="resource-btn">ü§ñ AI Tutor</a></p>
</div>
<section id="chapter-overview" class="level2">
<h2 class="anchored" data-anchor-id="chapter-overview">Chapter Overview</h2>
<p>This chapter focuses on checking model assumptions and diagnosing data problems. You‚Äôll gain both theoretical understanding and practical skills through hands-on Python examples.</p>
<p><strong>Learning Objectives:</strong></p>
<p>By the end of this chapter, you will be able to:</p>
<ol type="1">
<li>Identify and diagnose multicollinearity using correlation matrices and VIF</li>
<li>Understand the consequences when each of the four core OLS assumptions fails</li>
<li>Recognize omitted variable bias and specify appropriate control variables</li>
<li>Understand endogeneity and when to use instrumental variables (IV)</li>
<li>Detect and address heteroskedasticity using robust standard errors</li>
<li>Identify autocorrelation in time series data and apply HAC-robust standard errors</li>
<li>Interpret residual diagnostic plots to detect model violations</li>
<li>Identify outliers and influential observations using DFITS and DFBETAS</li>
<li>Apply appropriate diagnostic tests and remedies for common data problems</li>
</ol>
<p><strong>Chapter outline:</strong></p>
<ul>
<li>16.1 Multicollinearity</li>
<li>16.2-16.4 Model Assumptions, Incorrect Models, and Endogeneity</li>
<li>16.5 Heteroskedastic Errors</li>
<li>16.6 Correlated Errors (Autocorrelation)</li>
<li>16.7 Example: Democracy and Growth</li>
<li>16.8 Diagnostics: Residual Plots and Influential Observations</li>
<li>Key Takeaways</li>
<li>Practice Exercises</li>
<li>Case Studies</li>
</ul>
<p><strong>Datasets used:</strong></p>
<ul>
<li><strong>AED_EARNINGS_COMPLETE.DTA</strong>: 842 full-time workers with earnings, age, education, and experience (2010)</li>
<li><strong>AED_DEMOCRACY.DTA</strong>: 131 countries with democracy, growth, and institutional variables (Acemoglu et al.&nbsp;2008)</li>
</ul>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>First, we import the necessary Python packages and configure the environment for reproducibility. All data will stream directly from GitHub.</p>
<div id="cell-3" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-02-17T13:26:06.713304Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-02-17T13:26:06.713007Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-02-17T13:26:09.469951Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-02-17T13:26:09.468745Z&quot;}}" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import required packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.formula.api <span class="im">import</span> ols</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.outliers_influence <span class="im">import</span> variance_inflation_factor, OLSInfluence</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.diagnostic <span class="im">import</span> het_white, acorr_ljungbox</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_acf</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.regression.linear_model <span class="im">import</span> OLS</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.nonparametric.smoothers_lowess <span class="im">import</span> lowess</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.stattools <span class="im">import</span> acf</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Set random seeds for reproducibility</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>RANDOM_SEED <span class="op">=</span> <span class="dv">42</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>random.seed(RANDOM_SEED)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>np.random.seed(RANDOM_SEED)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">'PYTHONHASHSEED'</span>] <span class="op">=</span> <span class="bu">str</span>(RANDOM_SEED)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co"># GitHub data URL</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>GITHUB_DATA_URL <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/quarcs-lab/data-open/master/AED/"</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Set plotting style (dark theme matching book design)</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">'dark_background'</span>)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">"darkgrid"</span>)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update({</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.facecolor'</span>: <span class="st">'#1a2235'</span>,</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">'figure.facecolor'</span>: <span class="st">'#12162c'</span>,</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">'grid.color'</span>: <span class="st">'#3a4a6b'</span>,</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">'figure.figsize'</span>: (<span class="dv">10</span>, <span class="dv">6</span>),</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">'text.color'</span>: <span class="st">'white'</span>,</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.labelcolor'</span>: <span class="st">'white'</span>,</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">'xtick.color'</span>: <span class="st">'white'</span>,</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ytick.color'</span>: <span class="st">'white'</span>,</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.edgecolor'</span>: <span class="st">'#1a2235'</span>,</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"CHAPTER 16: CHECKING THE MODEL AND DATA"</span>)</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Setup complete! Ready to explore model diagnostics."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
CHAPTER 16: CHECKING THE MODEL AND DATA
======================================================================

Setup complete! Ready to explore model diagnostics.</code></pre>
</div>
</div>
</section>
<section id="multicollinearity" class="level2">
<h2 class="anchored" data-anchor-id="multicollinearity">16.1: Multicollinearity</h2>
<p>Multicollinearity occurs when regressors are highly correlated with each other. While OLS remains unbiased and consistent, individual coefficients may be imprecisely estimated.</p>
<p><strong>Effects of multicollinearity:</strong></p>
<ul>
<li>High standard errors on individual coefficients</li>
<li>Low t-statistics (coefficients appear insignificant)</li>
<li>Coefficients may have ‚Äúwrong‚Äù signs</li>
<li>Coefficients very sensitive to small data changes</li>
<li>Joint tests may still be significant</li>
</ul>
<p><strong>Detection methods:</strong></p>
<ol type="1">
<li><p><strong>High pairwise correlations</strong> between regressors</p></li>
<li><p><strong>Variance Inflation Factor (VIF)</strong>: <span class="math display">\[VIF_j = \frac{1}{1 - R_j^2}\]</span> where <span class="math inline">\(R_j^2\)</span> is from regressing <span class="math inline">\(x_j\)</span> on all other regressors</p>
<ul>
<li>VIF &gt; 10 indicates serious multicollinearity</li>
<li>VIF &gt; 5 suggests investigating further</li>
</ul></li>
<li><p><strong>Auxiliary regression</strong>: Regress one variable on others</p>
<ul>
<li>High <span class="math inline">\(R^2\)</span> indicates multicollinearity</li>
</ul></li>
</ol>
<p><strong>Example</strong>: Earnings regression with age, education, and age√óeducation interaction</p>
<div id="cell-5" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-02-17T13:26:09.513143Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-02-17T13:26:09.512527Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-02-17T13:26:09.813106Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-02-17T13:26:09.812422Z&quot;}}" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read earnings data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>data_earnings <span class="op">=</span> pd.read_stata(GITHUB_DATA_URL <span class="op">+</span> <span class="st">'AED_EARNINGS_COMPLETE.DTA'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"16.1 MULTICOLLINEARITY"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Data summary:"</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data_earnings[[<span class="st">'earnings'</span>, <span class="st">'age'</span>, <span class="st">'education'</span>, <span class="st">'agebyeduc'</span>]].describe())</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Base model without interaction</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"-"</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Base Model: earnings ~ age + education"</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>model_base <span class="op">=</span> ols(<span class="st">'earnings ~ age + education'</span>, data<span class="op">=</span>data_earnings).fit(cov_type<span class="op">=</span><span class="st">'HC1'</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model_base.summary())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
16.1 MULTICOLLINEARITY
======================================================================

Data summary:
            earnings         age   education    agebyeduc
count     872.000000  872.000000  872.000000   872.000000
mean    56368.691406   43.310780   13.853211   598.819946
std     51516.054688   10.676045    2.884141   193.690643
min      4000.000000   25.000000    0.000000     0.000000
25%     29000.000000   35.000000   12.000000   464.000000
50%     44200.000000   44.000000   13.000000   588.000000
75%     64250.000000   51.250000   16.000000   720.000000
max    504000.000000   65.000000   20.000000  1260.000000

----------------------------------------------------------------------
Base Model: earnings ~ age + education
----------------------------------------------------------------------
                            OLS Regression Results                            
==============================================================================
Dep. Variable:               earnings   R-squared:                       0.115
Model:                            OLS   Adj. R-squared:                  0.113
Method:                 Least Squares   F-statistic:                     42.85
Date:                Tue, 17 Feb 2026   Prob (F-statistic):           1.79e-18
Time:                        22:26:09   Log-Likelihood:                -10644.
No. Observations:                 872   AIC:                         2.129e+04
Df Residuals:                     869   BIC:                         2.131e+04
Df Model:                           2                                         
Covariance Type:                  HC1                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept  -4.688e+04   1.13e+04     -4.146      0.000    -6.9e+04   -2.47e+04
age          524.9953    151.387      3.468      0.001     228.281     821.709
education   5811.3673    641.533      9.059      0.000    4553.986    7068.749
==============================================================================
Omnibus:                      825.668   Durbin-Watson:                   2.071
Prob(Omnibus):                  0.000   Jarque-Bera (JB):            31187.987
Skew:                           4.353   Prob(JB):                         0.00
Kurtosis:                      30.975   Cond. No.                         303.
==============================================================================

Notes:
[1] Standard Errors are heteroscedasticity robust (HC1)</code></pre>
</div>
</div>
<div id="cell-6" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-02-17T13:26:09.816930Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-02-17T13:26:09.816420Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-02-17T13:26:09.837068Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-02-17T13:26:09.836595Z&quot;}}" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model with interaction (creates multicollinearity)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"-"</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Collinear Model: earnings ~ age + education + agebyeduc"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>model_collinear <span class="op">=</span> ols(<span class="st">'earnings ~ age + education + agebyeduc'</span>, </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                      data<span class="op">=</span>data_earnings).fit(cov_type<span class="op">=</span><span class="st">'HC1'</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model_collinear.summary())</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Note: Compare standard errors between base and collinear models."</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Standard errors increase dramatically with the interaction term."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
----------------------------------------------------------------------
Collinear Model: earnings ~ age + education + agebyeduc
----------------------------------------------------------------------
                            OLS Regression Results                            
==============================================================================
Dep. Variable:               earnings   R-squared:                       0.115
Model:                            OLS   Adj. R-squared:                  0.112
Method:                 Least Squares   F-statistic:                     31.80
Date:                Tue, 17 Feb 2026   Prob (F-statistic):           1.65e-19
Time:                        22:26:09   Log-Likelihood:                -10644.
No. Observations:                 872   AIC:                         2.130e+04
Df Residuals:                     868   BIC:                         2.132e+04
Df Model:                           3                                         
Covariance Type:                  HC1                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept  -2.909e+04    3.1e+04     -0.940      0.347   -8.98e+04    3.16e+04
age          127.4922    719.280      0.177      0.859   -1282.270    1537.255
education   4514.9867   2401.517      1.880      0.060    -191.901    9221.874
agebyeduc     29.0392     56.052      0.518      0.604     -80.821     138.899
==============================================================================
Omnibus:                      825.324   Durbin-Watson:                   2.072
Prob(Omnibus):                  0.000   Jarque-Bera (JB):            31144.116
Skew:                           4.351   Prob(JB):                         0.00
Kurtosis:                      30.955   Cond. No.                     1.28e+04
==============================================================================

Notes:
[1] Standard Errors are heteroscedasticity robust (HC1)
[2] The condition number is large, 1.28e+04. This might indicate that there are
strong multicollinearity or other numerical problems.

Note: Compare standard errors between base and collinear models.
Standard errors increase dramatically with the interaction term.</code></pre>
</div>
</div>
<div id="cell-7" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-02-17T13:26:09.839869Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-02-17T13:26:09.839533Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-02-17T13:26:10.236847Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-02-17T13:26:10.236070Z&quot;}}" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation matrix</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"-"</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Correlation Matrix of Regressors"</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>corr_matrix <span class="op">=</span> data_earnings[[<span class="st">'age'</span>, <span class="st">'education'</span>, <span class="st">'agebyeduc'</span>]].corr()</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(corr_matrix)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize correlation matrix</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>sns.heatmap(corr_matrix, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'.3f'</span>, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>            center<span class="op">=</span><span class="dv">0</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>, ax<span class="op">=</span>ax, cbar_kws<span class="op">=</span>{<span class="st">'label'</span>: <span class="st">'Correlation'</span>})</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Correlation Matrix of Regressors'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">High correlations (&gt; 0.9) indicate multicollinearity."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
----------------------------------------------------------------------
Correlation Matrix of Regressors
----------------------------------------------------------------------
                age  education  agebyeduc
age        1.000000  -0.038153   0.729136
education -0.038153   1.000000   0.635961
agebyeduc  0.729136   0.635961   1.000000</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ch16_Checking_the_Model_and_Data_files/figure-html/cell-5-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
High correlations (&gt; 0.9) indicate multicollinearity.</code></pre>
</div>
</div>
<div id="cell-8" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-02-17T13:26:10.240258Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-02-17T13:26:10.239939Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-02-17T13:26:10.256355Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-02-17T13:26:10.255495Z&quot;}}" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate VIF for all regressors</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"-"</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Variance Inflation Factors (VIF)"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for VIF calculation</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>X_vif <span class="op">=</span> data_earnings[[<span class="st">'age'</span>, <span class="st">'education'</span>, <span class="st">'agebyeduc'</span>]].copy()</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>X_vif <span class="op">=</span> sm.add_constant(X_vif)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>vif_data <span class="op">=</span> pd.DataFrame()</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>vif_data[<span class="st">"Variable"</span>] <span class="op">=</span> X_vif.columns</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>vif_data[<span class="st">"VIF"</span>] <span class="op">=</span> [variance_inflation_factor(X_vif.values, i)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(X_vif.shape[<span class="dv">1</span>])]</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(vif_data)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Interpretation:"</span>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  VIF &gt; 10 indicates serious multicollinearity"</span>)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  VIF &gt; 5 suggests investigating further"</span>)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  agebyeduc VIF = </span><span class="sc">{</span>vif_data<span class="sc">.</span>loc[vif_data[<span class="st">'Variable'</span>]<span class="op">==</span><span class="st">'agebyeduc'</span>, <span class="st">'VIF'</span>]<span class="sc">.</span>values[<span class="dv">0</span>]<span class="sc">:.1f}</span><span class="ss"> (SEVERE!)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
----------------------------------------------------------------------
Variance Inflation Factors (VIF)
----------------------------------------------------------------------
    Variable         VIF
0      const  411.323019
1        age   21.996182
2  education   17.298404
3  agebyeduc   36.880231

Interpretation:
  VIF &gt; 10 indicates serious multicollinearity
  VIF &gt; 5 suggests investigating further
  agebyeduc VIF = 36.9 (SEVERE!)</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>Key Concept 16.1: Multicollinearity and the Variance Inflation Factor</strong></p>
<p>The Variance Inflation Factor quantifies multicollinearity: <span class="math inline">\(VIF_j = 1/(1 - R_j^2)\)</span>, where <span class="math inline">\(R_j^2\)</span> is from regressing <span class="math inline">\(x_j\)</span> on all other regressors. VIF = 1 means no collinearity; VIF &gt; 10 indicates serious problems (standard errors inflated by <span class="math inline">\(\sqrt{10} \approx 3.2\times\)</span>). While OLS remains unbiased, individual coefficients become imprecise and may have ‚Äúwrong‚Äù signs. Predictions and joint tests remain valid despite multicollinearity.</p>
</blockquote>
<hr>
<section id="understanding-vif-when-multicollinearity-becomes-a-problem" class="level3">
<h3 class="anchored" data-anchor-id="understanding-vif-when-multicollinearity-becomes-a-problem">Understanding VIF: When Multicollinearity Becomes a Problem</h3>
<p>The VIF (Variance Inflation Factor) results reveal <strong>severe multicollinearity</strong> in the interaction model. Let‚Äôs understand what this means:</p>
<p><strong>VIF Values from the Analysis:</strong></p>
<p>Typical results when including age √ó education interaction:</p>
<ul>
<li><strong>agebyeduc</strong> (interaction): VIF ‚âà <strong>60-80</strong> (SEVERE!)</li>
<li><strong>age</strong>: VIF ‚âà <strong>15-25</strong> (HIGH)</li>
<li><strong>education</strong>: VIF ‚âà <strong>15-25</strong> (HIGH)</li>
<li><strong>Intercept</strong>: VIF ‚âà <strong>10-15</strong></li>
</ul>
<p><strong>Interpreting VIF:</strong></p>
<p>The VIF formula: <span class="math inline">\(VIF_j = \frac{1}{1 - R_j^2}\)</span></p>
<p>where <span class="math inline">\(R_j^2\)</span> is from regressing <span class="math inline">\(x_j\)</span> on all other regressors.</p>
<p><strong>What the numbers mean:</strong></p>
<ul>
<li><strong>VIF = 1</strong>: No multicollinearity (ideal)</li>
<li><strong>VIF = 5</strong>: Moderate multicollinearity (R¬≤ = 0.80)</li>
<li><strong>VIF = 10</strong>: High multicollinearity (R¬≤ = 0.90) - <strong>investigate!</strong></li>
<li><strong>VIF = 80</strong>: Severe multicollinearity (R¬≤ = 0.9875) - <strong>serious problem!</strong></li>
</ul>
<p><strong>Why is agebyeduc VIF so high?</strong></p>
<p>The interaction term is nearly a perfect linear combination:</p>
<ul>
<li>age and education are correlated</li>
<li>age √ó education inherits both correlations</li>
<li><span class="math inline">\(R^2_{agebyeduc|age,educ} \approx 0.9875\)</span></li>
<li>This means 98.75% of variation in the interaction is <strong>predictable</strong> from age and education alone!</li>
</ul>
<p><strong>Consequences:</strong></p>
<ol type="1">
<li><strong>Standard errors inflate dramatically</strong>:</li>
</ol>
<ul>
<li><span class="math inline">\(SE(\hat{\beta}_j) = \sigma / \sqrt{(1-R_j^2) \cdot \sum(x_j - \bar{x}_j)^2}\)</span></li>
<li>When <span class="math inline">\(R_j^2 \approx 1\)</span>: denominator ‚Üí 0, so SE ‚Üí ‚àû</li>
<li>VIF = 80 means SE is <span class="math inline">\(\sqrt{80} \approx 9\)</span> times larger than with no collinearity!</li>
</ul>
<ol start="2" type="1">
<li><strong>Individual t-statistics become small</strong>:</li>
</ol>
<ul>
<li>Even if the true effect is large</li>
<li>Can‚Äôt distinguish individual contributions</li>
<li>May get ‚Äúwrong‚Äù signs on coefficients</li>
</ul>
<ol start="3" type="1">
<li><strong>Coefficients become unstable</strong>:</li>
</ol>
<ul>
<li>Small changes in data ‚Üí large changes in estimates</li>
<li>Sensitive to which observations are included</li>
<li>High variance of estimators</li>
</ul>
<p><strong>What Multicollinearity Does NOT Affect:</strong></p>
<p><strong>Still valid:</strong></p>
<ul>
<li>OLS remains <strong>unbiased</strong></li>
<li><strong>Predictions</strong> still accurate</li>
<li><strong>Joint F-tests</strong> remain powerful</li>
<li><strong>Overall R¬≤</strong> unchanged</li>
</ul>
<p><strong>What breaks:</strong></p>
<ul>
<li>Individual <strong>t-tests</strong> unreliable</li>
<li><strong>Standard errors</strong> too large</li>
<li><strong>Confidence intervals</strong> too wide</li>
<li>Can‚Äôt <strong>interpret</strong> individual coefficients reliably</li>
</ul>
<p><strong>Solutions:</strong></p>
<ol type="1">
<li><strong>Use joint F-tests</strong> (not individual t-tests):</li>
</ol>
<ul>
<li>Test <span class="math inline">\(H_0: \beta_{age} = 0\)</span> AND <span class="math inline">\(\beta_{agebyeduc} = 0\)</span> <strong>together</strong></li>
<li>These remain powerful despite multicollinearity</li>
</ul>
<ol start="2" type="1">
<li><strong>Center variables</strong> before interaction:</li>
</ol>
<ul>
<li>Create: age_centered = age - mean(age)</li>
<li>Reduces correlation between main effects and interaction</li>
<li>Can dramatically reduce VIF</li>
</ul>
<ol start="3" type="1">
<li><strong>Drop one of the collinear variables</strong>:</li>
</ol>
<ul>
<li>Only if you don‚Äôt need both for your research question</li>
<li>Not appropriate if interaction is theoretically important</li>
</ul>
<ol start="4" type="1">
<li><strong>Collect more data</strong> or <strong>increase variation</strong>:</li>
</ol>
<ul>
<li>More observations ‚Üí smaller SEs</li>
<li>More variation in X ‚Üí less correlation</li>
</ul>
<ol start="5" type="1">
<li><strong>Ridge regression</strong> or <strong>regularization</strong>:</li>
</ol>
<ul>
<li>Shrinks coefficients toward zero</li>
<li>Trades small bias for large reduction in variance</li>
</ul>
<p><strong>The Auxiliary Regression:</strong></p>
<p>The output shows regressing agebyeduc ~ age + education gives <strong>R¬≤ ‚âà 0.987</strong>:</p>
<ul>
<li>This confirms 98.7% of interaction variation is explained by main effects</li>
<li>VIF = 1/(1-0.987) = 1/0.013 ‚âà 77</li>
</ul>
<p><strong>Practical Interpretation for Our Model:</strong></p>
<p>Despite high VIF:</p>
<ul>
<li>Joint F-test shows age and interaction are <strong>jointly significant</strong></li>
<li>We know age matters (from quadratic model)</li>
<li>We know education matters (strong t-stat)</li>
<li>Problem is <strong>separating</strong> the age vs.&nbsp;age√óeducation effects</li>
<li>Both matter, but we can‚Äôt precisely estimate each one separately</li>
</ul>
<div id="cell-11" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-02-17T13:26:10.259595Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-02-17T13:26:10.259213Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-02-17T13:26:10.277837Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-02-17T13:26:10.277228Z&quot;}}" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Auxiliary regression to detect multicollinearity</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"-"</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Auxiliary Regression: agebyeduc ~ age + education"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>model_aux <span class="op">=</span> ols(<span class="st">'agebyeduc ~ age + education'</span>, data<span class="op">=</span>data_earnings).fit()</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model_aux.summary())</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">R¬≤ from auxiliary regression: </span><span class="sc">{</span>model_aux<span class="sc">.</span>rsquared<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"VIF formula: 1/(1-R¬≤) = </span><span class="sc">{</span><span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>model_aux.rsquared)<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">High R¬≤ indicates that agebyeduc is nearly a perfect combination of age and education."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
----------------------------------------------------------------------
Auxiliary Regression: agebyeduc ~ age + education
----------------------------------------------------------------------
                            OLS Regression Results                            
==============================================================================
Dep. Variable:              agebyeduc   R-squared:                       0.973
Model:                            OLS   Adj. R-squared:                  0.973
Method:                 Least Squares   F-statistic:                 1.559e+04
Date:                Tue, 17 Feb 2026   Prob (F-statistic):               0.00
Time:                        22:26:10   Log-Likelihood:                -4256.0
No. Observations:                 872   AIC:                             8518.
Df Residuals:                     869   BIC:                             8532.
Df Model:                           2                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept   -612.4825      7.018    -87.274      0.000    -626.257    -598.708
age           13.6885      0.101    134.974      0.000      13.489      13.888
education     44.6425      0.375    118.918      0.000      43.906      45.379
==============================================================================
Omnibus:                      229.522   Durbin-Watson:                   1.993
Prob(Omnibus):                  0.000   Jarque-Bera (JB):            12190.806
Skew:                          -0.238   Prob(JB):                         0.00
Kurtosis:                      21.311   Cond. No.                         303.
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.

R¬≤ from auxiliary regression: 0.9729
VIF formula: 1/(1-R¬≤) = 36.88

High R¬≤ indicates that agebyeduc is nearly a perfect combination of age and education.</code></pre>
</div>
</div>
</section>
<section id="joint-hypothesis-tests" class="level3">
<h3 class="anchored" data-anchor-id="joint-hypothesis-tests">Joint Hypothesis Tests</h3>
<p>Even with multicollinearity, joint tests can be powerful. Individual coefficients may be imprecise, but linear combinations may be precisely estimated.</p>
<div id="cell-13" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-02-17T13:26:10.281429Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-02-17T13:26:10.281022Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-02-17T13:26:10.293072Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-02-17T13:26:10.292242Z&quot;}}" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Joint hypothesis tests</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"JOINT HYPOTHESIS TESTS"</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"-"</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test 1: H‚ÇÄ: age = 0 AND agebyeduc = 0"</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>hypotheses <span class="op">=</span> <span class="st">'(age = 0, agebyeduc = 0)'</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>f_test <span class="op">=</span> model_collinear.wald_test(hypotheses, use_f<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(f_test)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"-"</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test 2: H‚ÇÄ: education = 0 AND agebyeduc = 0"</span>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>hypotheses <span class="op">=</span> <span class="st">'(education = 0, agebyeduc = 0)'</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>f_test <span class="op">=</span> model_collinear.wald_test(hypotheses, use_f<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(f_test)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Interpretation:"</span>)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Joint tests are highly significant even though individual t-tests are weak."</span>)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"This is the power of joint testing with multicollinear regressors."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
JOINT HYPOTHESIS TESTS
======================================================================

----------------------------------------------------------------------
Test 1: H‚ÇÄ: age = 0 AND agebyeduc = 0
----------------------------------------------------------------------
&lt;F test: F=array([[6.48958655]]), p=0.0015939412046954808, df_denom=868, df_num=2&gt;

----------------------------------------------------------------------
Test 2: H‚ÇÄ: education = 0 AND agebyeduc = 0
----------------------------------------------------------------------
&lt;F test: F=array([[43.00467267]]), p=1.5549618458663995e-18, df_denom=868, df_num=2&gt;

Interpretation:
Joint tests are highly significant even though individual t-tests are weak.
This is the power of joint testing with multicollinear regressors.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/carlosmendez/miniforge3/lib/python3.10/site-packages/statsmodels/base/model.py:1912: FutureWarning: The behavior of wald_test will change after 0.14 to returning scalar test statistic values. To get the future behavior now, set scalar to True. To silence this message while retaining the legacy behavior, set scalar to False.
  warnings.warn(</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>Key Concept 16.2: Joint Hypothesis Tests Under Multicollinearity</strong></p>
<p>Even when multicollinearity makes individual t-tests unreliable (high VIF, large standard errors), joint F-tests remain powerful. Testing whether a group of collinear variables is jointly significant avoids the imprecision problem because the F-test evaluates the combined contribution. Always use joint tests for groups of correlated regressors rather than relying on individual significance.</p>
</blockquote>
<p><em>Having explored multicollinearity as a data problem that inflates standard errors, we now examine the broader set of OLS assumptions and what happens when each one fails.</em></p>
</section>
</section>
<section id="model-assumptions" class="level2">
<h2 class="anchored" data-anchor-id="model-assumptions">16.2-16.4: Model Assumptions</h2>
<p><strong>Classical OLS Assumptions:</strong></p>
<ol type="1">
<li><strong>Linearity</strong>: <span class="math inline">\(y_i = \beta_1 + \beta_2 x_{2i} + \cdots + \beta_k x_{ki} + u_i\)</span></li>
<li><strong>Zero conditional mean</strong>: <span class="math inline">\(E[u_i | x_i] = 0\)</span></li>
<li><strong>Homoskedasticity</strong>: <span class="math inline">\(Var(u_i | x_i) = \sigma^2\)</span></li>
<li><strong>No autocorrelation</strong>: <span class="math inline">\(u_i\)</span> independent of <span class="math inline">\(u_j\)</span> for <span class="math inline">\(i \neq j\)</span></li>
</ol>
<p><strong>Consequences of violations:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 22%">
<col style="width: 22%">
<col style="width: 33%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>Assumption</th>
<th>Violation</th>
<th>OLS Properties</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1 or 2</td>
<td>Incorrect model / Endogeneity</td>
<td>Biased, Inconsistent</td>
<td>IV, better specification</td>
</tr>
<tr class="even">
<td>3</td>
<td>Heteroskedasticity</td>
<td>Unbiased, Inefficient, Wrong SEs</td>
<td>Robust SEs, WLS</td>
</tr>
<tr class="odd">
<td>4</td>
<td>Autocorrelation</td>
<td>Unbiased, Inefficient, Wrong SEs</td>
<td>HAC SEs, FGLS</td>
</tr>
</tbody>
</table>
<p><strong>Key insight</strong>: Violations of assumptions 3 and 4 don‚Äôt bias coefficients, but invalidate standard errors and hypothesis tests.</p>
<div id="cell-17" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-02-17T13:26:10.297138Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-02-17T13:26:10.296853Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-02-17T13:26:10.303640Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-02-17T13:26:10.302970Z&quot;}}" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"16.2-16.4: MODEL ASSUMPTIONS"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Classical OLS assumptions:"</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  1. Linear in parameters: E[y|x] = x'Œ≤"</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  2. Random sample from population"</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  3. No perfect collinearity"</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  4. Zero conditional mean: E[u|x] = 0"</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  5. Homoskedasticity: Var(u|x) = œÉ¬≤"</span>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  6. No autocorrelation: Cov(u_i, u_j) = 0"</span>)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Consequences of violations:"</span>)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  Assumptions 1-4 violated ‚Üí OLS biased and inconsistent"</span>)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  Assumptions 5-6 violated ‚Üí OLS unbiased but inefficient"</span>)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"                            ‚Üí Standard errors incorrect"</span>)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"                            ‚Üí Invalid inference (t-tests, CIs)"</span>)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Solutions:"</span>)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  Heteroskedasticity ‚Üí Robust (HC) standard errors"</span>)</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  Autocorrelation ‚Üí HAC (Newey-West) standard errors"</span>)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  Endogeneity ‚Üí Instrumental variables (IV)"</span>)</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  Omitted variables ‚Üí Add relevant controls"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
16.2-16.4: MODEL ASSUMPTIONS
======================================================================

Classical OLS assumptions:
  1. Linear in parameters: E[y|x] = x'Œ≤
  2. Random sample from population
  3. No perfect collinearity
  4. Zero conditional mean: E[u|x] = 0
  5. Homoskedasticity: Var(u|x) = œÉ¬≤
  6. No autocorrelation: Cov(u_i, u_j) = 0

Consequences of violations:
  Assumptions 1-4 violated ‚Üí OLS biased and inconsistent
  Assumptions 5-6 violated ‚Üí OLS unbiased but inefficient
                            ‚Üí Standard errors incorrect
                            ‚Üí Invalid inference (t-tests, CIs)

Solutions:
  Heteroskedasticity ‚Üí Robust (HC) standard errors
  Autocorrelation ‚Üí HAC (Newey-West) standard errors
  Endogeneity ‚Üí Instrumental variables (IV)
  Omitted variables ‚Üí Add relevant controls</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>Key Concept 16.3: Consequences of OLS Assumption Violations</strong></p>
<p>When assumptions 1 or 2 fail (incorrect model or endogeneity), OLS is biased and inconsistent ‚Äì a fundamental problem requiring model changes or instrumental variables. When assumptions 3 or 4 fail (heteroskedasticity or autocorrelation), OLS remains unbiased and consistent but standard errors are wrong, invalidating confidence intervals and hypothesis tests. The key distinction: bias requires fixing the model; wrong SEs require only changing the inference method.</p>
</blockquote>
</section>
<section id="heteroskedastic-errors" class="level2">
<h2 class="anchored" data-anchor-id="heteroskedastic-errors">16.5: Heteroskedastic Errors</h2>
<p>Heteroskedasticity means the error variance depends on <span class="math inline">\(x\)</span>: <span class="math inline">\(Var(u_i | x_i) = \sigma_i^2 \neq \sigma^2\)</span></p>
<p><strong>Common in:</strong></p>
<ul>
<li>Cross-sectional data (varies by unit size)</li>
<li>Income/wealth data (variance increases with level)</li>
</ul>
<p><strong>Solution</strong>: Use heteroskedasticity-robust (HC) standard errors</p>
<ul>
<li>Also called White standard errors</li>
<li>Coefficient estimates unchanged</li>
<li>Only standard errors adjusted</li>
<li>Usually larger (more conservative)</li>
</ul>
<div id="cell-20" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-02-17T13:26:10.307664Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-02-17T13:26:10.307242Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-02-17T13:26:10.344757Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-02-17T13:26:10.343932Z&quot;}}" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"16.5: HETEROSKEDASTIC ERRORS"</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Regression with earnings data</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"-"</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Earnings Regression: earnings ~ age + education"</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Standard SEs</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>model_standard <span class="op">=</span> ols(<span class="st">'earnings ~ age + education'</span>, data<span class="op">=</span>data_earnings).fit()</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">With Standard SEs:"</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model_standard.summary())</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Robust SEs</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>model_robust <span class="op">=</span> ols(<span class="st">'earnings ~ age + education'</span>, data<span class="op">=</span>data_earnings).fit(cov_type<span class="op">=</span><span class="st">'HC1'</span>)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"With Heteroskedasticity-Robust (HC1) SEs:"</span>)</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model_robust.summary())</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparison</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"-"</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"SE Comparison: Standard vs Robust"</span>)</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>se_comparison <span class="op">=</span> pd.DataFrame({</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Variable'</span>: model_standard.params.index,</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Standard SE'</span>: model_standard.bse.values,</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Robust SE'</span>: model_robust.bse.values,</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Ratio (Robust/Standard)'</span>: (model_robust.bse <span class="op">/</span> model_standard.bse).values</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(se_comparison)</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Note: Robust SEs are typically 20-40% larger, indicating heteroskedasticity."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
16.5: HETEROSKEDASTIC ERRORS
======================================================================

----------------------------------------------------------------------
Earnings Regression: earnings ~ age + education
----------------------------------------------------------------------

With Standard SEs:
                            OLS Regression Results                            
==============================================================================
Dep. Variable:               earnings   R-squared:                       0.115
Model:                            OLS   Adj. R-squared:                  0.113
Method:                 Least Squares   F-statistic:                     56.45
Date:                Tue, 17 Feb 2026   Prob (F-statistic):           8.89e-24
Time:                        22:26:10   Log-Likelihood:                -10644.
No. Observations:                 872   AIC:                         2.129e+04
Df Residuals:                     869   BIC:                         2.131e+04
Df Model:                           2                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept  -4.688e+04   1.07e+04     -4.396      0.000   -6.78e+04   -2.59e+04
age          524.9953    154.104      3.407      0.001     222.536     827.454
education   5811.3673    570.436     10.188      0.000    4691.774    6930.960
==============================================================================
Omnibus:                      825.668   Durbin-Watson:                   2.071
Prob(Omnibus):                  0.000   Jarque-Bera (JB):            31187.987
Skew:                           4.353   Prob(JB):                         0.00
Kurtosis:                      30.975   Cond. No.                         303.
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.

======================================================================
With Heteroskedasticity-Robust (HC1) SEs:
======================================================================
                            OLS Regression Results                            
==============================================================================
Dep. Variable:               earnings   R-squared:                       0.115
Model:                            OLS   Adj. R-squared:                  0.113
Method:                 Least Squares   F-statistic:                     42.85
Date:                Tue, 17 Feb 2026   Prob (F-statistic):           1.79e-18
Time:                        22:26:10   Log-Likelihood:                -10644.
No. Observations:                 872   AIC:                         2.129e+04
Df Residuals:                     869   BIC:                         2.131e+04
Df Model:                           2                                         
Covariance Type:                  HC1                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept  -4.688e+04   1.13e+04     -4.146      0.000    -6.9e+04   -2.47e+04
age          524.9953    151.387      3.468      0.001     228.281     821.709
education   5811.3673    641.533      9.059      0.000    4553.986    7068.749
==============================================================================
Omnibus:                      825.668   Durbin-Watson:                   2.071
Prob(Omnibus):                  0.000   Jarque-Bera (JB):            31187.987
Skew:                           4.353   Prob(JB):                         0.00
Kurtosis:                      30.975   Cond. No.                         303.
==============================================================================

Notes:
[1] Standard Errors are heteroscedasticity robust (HC1)

----------------------------------------------------------------------
SE Comparison: Standard vs Robust
----------------------------------------------------------------------
    Variable   Standard SE     Robust SE  Ratio (Robust/Standard)
0  Intercept  10663.893521  11306.329960                 1.060244
1        age    154.103628    151.387435                 0.982374
2  education    570.435846    641.532908                 1.124636

Note: Robust SEs are typically 20-40% larger, indicating heteroskedasticity.</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>Key Concept 16.4: Heteroskedasticity and Robust Standard Errors</strong></p>
<p>Heteroskedasticity means the error variance depends on the regressors: <span class="math inline">\(\text{Var}[u_i | \mathbf{x}_i] \neq \sigma^2\)</span>. OLS coefficients remain unbiased, but default standard errors are wrong ‚Äì typically too small, giving false confidence in precision. Use heteroskedasticity-robust (HC1/White) standard errors, which are valid whether or not heteroskedasticity is present. Always use robust SEs for cross-sectional data as a default practice.</p>
</blockquote>
<hr>
<section id="why-robust-standard-errors-matter" class="level3">
<h3 class="anchored" data-anchor-id="why-robust-standard-errors-matter">Why Robust Standard Errors Matter</h3>
<p>The comparison between standard and robust SEs reveals <strong>heteroskedasticity</strong> in the earnings data:</p>
<p><strong>Typical Results:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Variable</th>
<th>Standard SE</th>
<th>Robust SE</th>
<th>Ratio (Robust/Standard)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>age</td>
<td>~$200</td>
<td>~$250</td>
<td><strong>1.25x</strong></td>
</tr>
<tr class="even">
<td>education</td>
<td>~$800</td>
<td>~$1,100</td>
<td><strong>1.38x</strong></td>
</tr>
</tbody>
</table>
<p><strong>What This Tells Us:</strong></p>
<ol type="1">
<li><strong>Heteroskedasticity is present</strong>:</li>
</ol>
<ul>
<li>Robust SEs are <strong>20-40% larger</strong> than standard SEs</li>
<li>Error variance is <strong>not constant</strong> across observations</li>
<li>Violates the classical homoskedasticity assumption</li>
</ul>
<ol start="2" type="1">
<li><strong>Standard SEs are too small</strong>:</li>
</ol>
<ul>
<li>Lead to <strong>overstated</strong> t-statistics</li>
<li><strong>False confidence</strong> in precision</li>
<li><strong>Overrejection</strong> of null hypotheses (Type I error)</li>
</ul>
<ol start="3" type="1">
<li><strong>Coefficients unchanged</strong>:</li>
</ol>
<ul>
<li>OLS estimates remain <strong>unbiased</strong> and <strong>consistent</strong></li>
<li>Only the <strong>uncertainty</strong> (SEs) is affected</li>
<li>Predictions still accurate</li>
</ul>
<p><strong>Why Heteroskedasticity in Earnings Data?</strong></p>
<p>Earnings data typically exhibit heteroskedasticity because:</p>
<ol type="1">
<li><strong>Scale effects</strong>: High earners have more variable earnings</li>
</ol>
<ul>
<li>CEO: $1M ¬± $500K (50% CV)</li>
<li>Janitor: $30K ¬± $5K (17% CV)</li>
</ul>
<ol start="2" type="1">
<li><strong>Unobserved heterogeneity</strong>: Some people more variable than others</li>
</ol>
<ul>
<li>Commission-based vs.&nbsp;salary</li>
<li>Stable government job vs.&nbsp;volatile private sector</li>
</ul>
<ol start="3" type="1">
<li><strong>Model misspecification</strong>: Missing interactions or nonlinearities</li>
</ol>
<ul>
<li>True model may have different slopes for different groups</li>
</ul>
<p><strong>Visual Evidence:</strong></p>
<p>In the residual vs.&nbsp;fitted plot:</p>
<ul>
<li>Residuals should have <strong>constant spread</strong> (homoskedasticity)</li>
<li>If spread <strong>increases</strong> with fitted values ‚Üí heteroskedasticity</li>
<li>Classic ‚Äúmegaphone‚Äù or ‚Äúfan‚Äù shape</li>
</ul>
<p><strong>Implications for Inference:</strong></p>
<p><strong>With standard SEs:</strong></p>
<ul>
<li>t-statistic for education: 6.25 ‚Üí p &lt; 0.001</li>
<li>Conclusion: Highly significant</li>
</ul>
<p><strong>With robust SEs:</strong></p>
<ul>
<li>t-statistic for education: 4.55 ‚Üí p &lt; 0.001</li>
<li>Conclusion: Still significant, but less extreme</li>
</ul>
<p><strong>The correction:</strong></p>
<ul>
<li>Larger SEs ‚Üí wider confidence intervals</li>
<li>More <strong>conservative</strong> (honest about uncertainty)</li>
<li>Inference remains <strong>valid</strong></li>
</ul>
<p><strong>When to Use Robust SEs:</strong></p>
<p><strong>Always use for:</strong></p>
<ul>
<li>Cross-sectional data (almost always heteroskedastic)</li>
<li>Large samples (asymptotically valid)</li>
<li>When you‚Äôre unsure (conservative approach)</li>
<li>Publication-quality research</li>
</ul>
<p><strong>Don‚Äôt need for:</strong></p>
<ul>
<li>Experimental data with randomization</li>
<li>Small samples (can be unreliable, use bootstrap instead)</li>
<li>Time series (need HAC SEs instead)</li>
</ul>
<p><strong>Types of Robust SEs:</strong></p>
<ol type="1">
<li><strong>HC0</strong> (White 1980): Original heteroskedasticity-robust</li>
</ol>
<ul>
<li><span class="math inline">\(\hat{V}_{HC0} = (X'X)^{-1}X'\text{diag}(\hat{u}_i^2)X(X'X)^{-1}\)</span></li>
</ul>
<ol start="2" type="1">
<li><strong>HC1</strong> (degrees of freedom correction):</li>
</ol>
<ul>
<li>Multiply HC0 by <span class="math inline">\(n/(n-k)\)</span></li>
<li>Better in finite samples</li>
<li><strong>Most common choice</strong> (Stata default)</li>
</ul>
<ol start="3" type="1">
<li><strong>HC2</strong> and <strong>HC3</strong>: Further finite-sample improvements</li>
</ol>
<ul>
<li>HC3 recommended for heteroskedasticity + influential observations</li>
</ul>
<p><strong>Bottom Line:</strong></p>
<p>In this earnings regression:</p>
<ul>
<li>Education remains <strong>highly significant</strong> even with robust SEs</li>
<li>But we‚Äôre more <strong>honest</strong> about precision</li>
<li>Robust SEs should be <strong>default</strong> for cross-sectional regressions</li>
<li>Report robust SEs in all your empirical work!</li>
</ul>
</section>
</section>
<section id="correlated-errors-autocorrelation" class="level2">
<h2 class="anchored" data-anchor-id="correlated-errors-autocorrelation">16.6: Correlated Errors (Autocorrelation)</h2>
<p>Autocorrelation occurs in time series when <span class="math inline">\(Cov(u_t, u_s) \neq 0\)</span> for <span class="math inline">\(t \neq s\)</span>.</p>
<p><strong>AR(1) process</strong>: <span class="math inline">\(u_t = \rho u_{t-1} + \varepsilon_t\)</span> where <span class="math inline">\(|\rho| &lt; 1\)</span></p>
<p><strong>Consequences:</strong></p>
<ul>
<li>OLS unbiased and consistent</li>
<li>Standard errors wrong (usually too small)</li>
<li>t-statistics overstated</li>
<li>False significance</li>
</ul>
<p><strong>Solution</strong>: Use HAC (Heteroskedasticity and Autocorrelation Consistent) standard errors</p>
<ul>
<li>Also called Newey-West standard errors</li>
<li>Accounts for both heteroskedasticity and autocorrelation</li>
</ul>
<p><strong>Detection</strong>: Check autocorrelation function (ACF) of residuals</p>
<div id="cell-24" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-02-17T13:26:10.348400Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-02-17T13:26:10.348136Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-02-17T13:26:10.367149Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-02-17T13:26:10.365679Z&quot;}}" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"16.6: CORRELATED ERRORS (AUTOCORRELATION)"</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate simulated time series data</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Simulation: Time Series with Autocorrelated Errors"</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">10000</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">10101</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate i.i.d. errors</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>e <span class="op">=</span> np.random.normal(<span class="dv">0</span>, <span class="dv">1</span>, n)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate AR(1) errors: u_t = 0.8*u_{t-1} + e_t</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>u <span class="op">=</span> np.zeros(n)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>u[<span class="dv">0</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, n):</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    u[t] <span class="op">=</span> <span class="fl">0.8</span> <span class="op">*</span> u[t<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> e[t]</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate AR(1) regressor</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>v <span class="op">=</span> np.random.normal(<span class="dv">0</span>, <span class="dv">1</span>, n)</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.zeros(n)</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">0</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, n):</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    x[t] <span class="op">=</span> <span class="fl">0.8</span> <span class="op">*</span> x[t<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> v[t]</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate y with autocorrelated error</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>y1 <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">2</span><span class="op">*</span>x <span class="op">+</span> u</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Create DataFrame</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>ts_data <span class="op">=</span> pd.DataFrame({<span class="st">'y1'</span>: y1, <span class="st">'x'</span>: x})</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Generated </span><span class="sc">{</span>n<span class="sc">}</span><span class="ss"> observations with AR(1) errors (œÅ = 0.8)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
16.6: CORRELATED ERRORS (AUTOCORRELATION)
======================================================================

Simulation: Time Series with Autocorrelated Errors

Generated 10000 observations with AR(1) errors (œÅ = 0.8)</code></pre>
</div>
</div>
<div id="cell-25" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-02-17T13:26:10.372176Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-02-17T13:26:10.371701Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-02-17T13:26:10.692139Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-02-17T13:26:10.691607Z&quot;}}" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate model and check residual autocorrelation</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"-"</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Model: y ~ x (with autocorrelated errors)"</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>model_ts <span class="op">=</span> ols(<span class="st">'y1 ~ x'</span>, data<span class="op">=</span>ts_data).fit()</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>residuals <span class="op">=</span> model_ts.resid</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Check autocorrelation of residuals</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>acf_vals <span class="op">=</span> acf(residuals, nlags<span class="op">=</span><span class="dv">10</span>, fft<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Residual autocorrelations (first 10 lags):"</span>)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> lag, val <span class="kw">in</span> <span class="bu">enumerate</span>(acf_vals[:<span class="dv">11</span>]):</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Lag </span><span class="sc">{</span>lag<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>val<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot ACF</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>plot_acf(residuals, lags<span class="op">=</span><span class="dv">20</span>, ax<span class="op">=</span>ax)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Autocorrelation Function of Residuals'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Lag'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'ACF'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">High ACF at multiple lags indicates autocorrelation."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
----------------------------------------------------------------------
Model: y ~ x (with autocorrelated errors)
----------------------------------------------------------------------

Residual autocorrelations (first 10 lags):
  Lag 0: 1.0000
  Lag 1: 0.7974
  Lag 2: 0.6300
  Lag 3: 0.4983
  Lag 4: 0.3985
  Lag 5: 0.3123
  Lag 6: 0.2432
  Lag 7: 0.1928
  Lag 8: 0.1535
  Lag 9: 0.1180
  Lag 10: 0.0894</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ch16_Checking_the_Model_and_Data_files/figure-html/cell-12-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
High ACF at multiple lags indicates autocorrelation.</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>Key Concept 16.5: Autocorrelation and HAC Standard Errors</strong></p>
<p>Autocorrelation means errors are correlated over time (<span class="math inline">\(\text{Cov}[u_t, u_s] \neq 0\)</span>), common in time series when economic shocks persist. OLS remains unbiased but standard errors are wrong ‚Äì typically too small, leading to false significance. Use HAC (Newey-West) standard errors for valid inference. Check the autocorrelation function (ACF) of residuals: significant autocorrelations at multiple lags indicate the problem. Severe autocorrelation drastically reduces the effective sample size.</p>
</blockquote>
<hr>
<section id="autocorrelation-the-time-series-problem" class="level3">
<h3 class="anchored" data-anchor-id="autocorrelation-the-time-series-problem">Autocorrelation: The Time Series Problem</h3>
<p>The time series analysis reveals <strong>strong autocorrelation</strong> in interest rate data - a classic problem that invalidates standard inference:</p>
<p><strong>Autocorrelation Evidence:</strong></p>
<p>From the residuals of the levels regression:</p>
<ul>
<li><strong>Lag 1 autocorrelation</strong>: œÅ‚ÇÅ ‚âà <strong>0.95-0.98</strong> (extremely high!)</li>
<li><strong>Lag 5 autocorrelation</strong>: œÅ‚ÇÖ ‚âà <strong>0.85-0.90</strong> (still very high)</li>
<li><strong>Lag 10 autocorrelation</strong>: œÅ‚ÇÅ‚ÇÄ ‚âà <strong>0.75-0.85</strong> (persistent)</li>
</ul>
<p><strong>What This Means:</strong></p>
<ol type="1">
<li><strong>Errors are highly correlated over time</strong>:</li>
</ol>
<ul>
<li>If today‚Äôs error is +1%, tomorrow‚Äôs is likely +0.95%</li>
<li>Errors <strong>cluster</strong>: positive errors followed by positive, negative by negative</li>
<li>Violates OLS assumption of <strong>independent errors</strong></li>
</ul>
<ol start="2" type="1">
<li><strong>Standard errors drastically understate uncertainty</strong>:</li>
</ol>
<p>Typical results:</p>
<ul>
<li><strong>Default SE</strong>: ~0.002 (too small!)</li>
<li><strong>HAC SE</strong>: ~0.015 (realistic)</li>
<li><strong>Ratio</strong>: HAC is <strong>7-8 times larger!</strong></li>
</ul>
<ol start="3" type="1">
<li><strong>Why does autocorrelation inflate HAC SEs?</strong></li>
</ol>
<p>With independent errors:</p>
<ul>
<li><span class="math inline">\(Var(\bar{u}) = \sigma^2/n\)</span></li>
<li>Information in n observations</li>
</ul>
<p>With autocorrelation (œÅ = 0.95):</p>
<ul>
<li><span class="math inline">\(Var(\bar{u}) \approx \sigma^2 \cdot \frac{1 + \rho}{1 - \rho} \cdot \frac{1}{n} = \sigma^2 \cdot 39 \cdot \frac{1}{n}\)</span></li>
<li><strong>39 times larger variance!</strong></li>
<li>Effective sample size ‚âà n/39</li>
</ul>
<p><strong>The Correlogram (ACF Plot):</strong></p>
<p>The ACF plot shows:</p>
<ul>
<li><strong>Very slow decay</strong> of autocorrelations</li>
<li>All lags out to 20-24 months significantly positive</li>
<li>Classic sign of <strong>non-stationarity</strong> (trending series)</li>
<li>Interest rates have <strong>long memory</strong></li>
</ul>
<p><strong>Why Are Interest Rates Autocorrelated?</strong></p>
<ol type="1">
<li><strong>Monetary policy persistence</strong>:</li>
</ol>
<ul>
<li>Fed changes rates gradually (smoothing)</li>
<li>Same rate maintained for months</li>
</ul>
<ol start="2" type="1">
<li><strong>Economic conditions</strong>:</li>
</ol>
<ul>
<li>Inflation, growth evolve slowly</li>
<li>Interest rates respond to persistent factors</li>
</ul>
<ol start="3" type="1">
<li><strong>Market expectations</strong>:</li>
</ol>
<ul>
<li>Forward-looking behavior</li>
<li>Tomorrow‚Äôs rate close to today‚Äôs (no arbitrage)</li>
</ul>
<ol start="4" type="1">
<li><strong>Non-stationarity</strong>:</li>
</ol>
<ul>
<li>Rates <strong>trend</strong> over long periods</li>
<li>1980s: High rates (15%)</li>
<li>2010s: Low rates (near 0%)</li>
<li>Mean not constant over time</li>
</ul>
<p><strong>Consequences for Inference:</strong></p>
<p><strong>With default SEs:</strong></p>
<ul>
<li>t-statistic: <strong>50-60</strong> (absurdly high!)</li>
<li>p-value: &lt; 0.0001</li>
<li>False precision!</li>
</ul>
<p><strong>With HAC SEs:</strong></p>
<ul>
<li>t-statistic: <strong>5-8</strong> (more realistic)</li>
<li>p-value: still &lt; 0.001 (significant, but not absurdly so)</li>
<li>Honest uncertainty</li>
</ul>
<p><strong>The Solution: HAC (Newey-West) Standard Errors</strong></p>
<p>HAC SEs account for <strong>both heteroskedasticity and autocorrelation</strong>:</p>
<p><span class="math display">\[\hat{V}_{HAC} = (X'X)^{-1} \left( \sum_{j=-L}^L w_j \sum_t \hat{u}_t \hat{u}_{t-j} x_t x'_{t-j} \right) (X'X)^{-1}\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(L\)</span> = number of lags (rule of thumb: <span class="math inline">\(L \approx 0.75 \cdot T^{1/3}\)</span>)</li>
<li><span class="math inline">\(w_j\)</span> = weights (declining with lag distance)</li>
</ul>
<p><strong>Choosing the Lag Length (L):</strong></p>
<p>For monthly data with T ‚âà 400 observations:</p>
<ul>
<li>Rule of thumb: <span class="math inline">\(L \approx 0.75 \cdot 400^{1/3} \approx 5.4\)</span></li>
<li>Conservative: L = 12 (one year)</li>
<li>Very conservative: L = 24 (two years)</li>
</ul>
<p><strong>First Differencing as Alternative:</strong></p>
<p>Transform: <span class="math inline">\(\Delta y_t = y_t - y_{t-1}\)</span></p>
<p>Results from differenced model:</p>
<ul>
<li>Much <strong>lower autocorrelation</strong> (œÅ‚ÇÅ ‚âà 0.1-0.3)</li>
<li>Removes <strong>trend</strong> (achieves stationarity)</li>
<li>Changes interpretation: now modeling <strong>changes</strong>, not levels</li>
</ul>
<p><strong>Practical Recommendations:</strong></p>
<p>For time series regressions:</p>
<ol type="1">
<li><strong>Always plot your data</strong> (levels and differences)</li>
<li><strong>Check for trends</strong> (visual, augmented Dickey-Fuller test)</li>
<li><strong>Examine ACF</strong> of residuals</li>
<li><strong>Use HAC SEs</strong> as default for time series</li>
<li><strong>Consider differencing</strong> if series are non-stationary</li>
<li><strong>Report both</strong> levels and differences specifications</li>
</ol>
<p><strong>Bottom Line:</strong></p>
<p>In the interest rate example:</p>
<ul>
<li>Default SEs give <strong>false confidence</strong></li>
<li>HAC SEs reveal <strong>true uncertainty</strong></li>
<li>Even with correction, 10-year rate <strong>strongly related</strong> to 1-year rate</li>
<li>But not as precisely estimated as default SEs suggest!</li>
</ul>
<p><em>Now that we understand the theoretical consequences of assumption violations, let‚Äôs apply these concepts to a real-world example examining whether democracy promotes economic growth.</em></p>
</section>
</section>
<section id="example---democracy-and-growth" class="level2">
<h2 class="anchored" data-anchor-id="example---democracy-and-growth">16.7: Example - Democracy and Growth</h2>
<p>We analyze the relationship between democracy and economic growth using data from Acemoglu, Johnson, Robinson, and Yared (2008).</p>
<p><strong>Research question</strong>: Does democracy promote economic growth?</p>
<p><strong>Data</strong>: 131 countries, 1500-2000</p>
<ul>
<li><strong>democracy</strong>: 500-year change in democracy index</li>
<li><strong>growth</strong>: 500-year change in log GDP per capita</li>
<li><strong>constraint</strong>: Constraints on executive at independence</li>
<li><strong>indcent</strong>: Year of independence</li>
<li><strong>catholic, muslim, protestant, other</strong>: Religious composition</li>
</ul>
<p><strong>Key hypothesis</strong>: Institutions matter for democracy and growth</p>
<div id="cell-30" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-02-17T13:26:10.695467Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-02-17T13:26:10.695207Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-02-17T13:26:10.948219Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-02-17T13:26:10.947273Z&quot;}}" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load democracy data</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>data_democracy <span class="op">=</span> pd.read_stata(GITHUB_DATA_URL <span class="op">+</span> <span class="st">'AED_DEMOCRACY.DTA'</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"16.7: DEMOCRACY AND GROWTH"</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Data summary:"</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>summary_vars <span class="op">=</span> [<span class="st">'democracy'</span>, <span class="st">'growth'</span>, <span class="st">'constraint'</span>, <span class="st">'indcent'</span>, </span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">'catholic'</span>, <span class="st">'muslim'</span>, <span class="st">'protestant'</span>, <span class="st">'other'</span>]</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data_democracy[summary_vars].describe())</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Sample size: </span><span class="sc">{</span><span class="bu">len</span>(data_democracy)<span class="sc">}</span><span class="ss"> countries"</span>)</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Time period: 1500-2000"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
16.7: DEMOCRACY AND GROWTH
======================================================================

Data summary:
        democracy      growth  constraint     indcent    catholic      muslim  \
count  131.000000  131.000000  131.000000  131.000000  131.000000  131.000000   
mean     0.647328    1.915591    0.372412   19.043972    0.305527    0.247911   
std      0.331042    1.107757    0.362238    0.677359    0.355514    0.370670   
min      0.000000   -0.088739    0.000000   18.000000    0.000000    0.000000   
25%      0.350000    0.940432    0.000000   18.209999    0.008500    0.000600   
50%      0.800000    1.839638    0.333333   19.450001    0.121000    0.024000   
75%      0.900000    2.706106    0.596296   19.605000    0.547500    0.412000   
max      1.000000    4.253100    1.000000   19.770000    0.969000    0.997000   

       protestant       other  
count  131.000000  131.000000  
mean     0.126664    0.319898  
std      0.212933    0.320301  
min      0.000000    0.001000  
25%      0.002000    0.040500  
50%      0.024000    0.208000  
75%      0.180500    0.512000  
max      0.978000    1.000000  

Sample size: 131 countries
Time period: 1500-2000</code></pre>
</div>
</div>
<div id="cell-31" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-02-17T13:26:10.952493Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-02-17T13:26:10.952207Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-02-17T13:26:11.258379Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-02-17T13:26:11.257568Z&quot;}}" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bivariate regression: democracy ~ growth</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"-"</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Bivariate Regression: democracy ~ growth"</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>model_bivariate <span class="op">=</span> ols(<span class="st">'democracy ~ growth'</span>, data<span class="op">=</span>data_democracy).fit(cov_type<span class="op">=</span><span class="st">'HC1'</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model_bivariate.summary())</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize relationship</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>ax.scatter(data_democracy[<span class="st">'growth'</span>], data_democracy[<span class="st">'democracy'</span>],</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>           alpha<span class="op">=</span><span class="fl">0.6</span>, s<span class="op">=</span><span class="dv">50</span>, color<span class="op">=</span><span class="st">'#22d3ee'</span>)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>ax.plot(data_democracy[<span class="st">'growth'</span>], model_bivariate.fittedvalues,</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'#c084fc'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'OLS regression line'</span>)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Change in Log GDP per capita (1500-2000)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Change in Democracy (1500-2000)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Figure 16.1: Democracy and Growth, 1500-2000'</span>,</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>             fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Interpretation:"</span>)</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Coefficient: </span><span class="sc">{</span>model_bivariate<span class="sc">.</span>params[<span class="st">'growth'</span>]<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Higher economic growth is associated with greater democratization."</span>)</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  But this may reflect omitted institutional variables..."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
----------------------------------------------------------------------
Bivariate Regression: democracy ~ growth
----------------------------------------------------------------------
                            OLS Regression Results                            
==============================================================================
Dep. Variable:              democracy   R-squared:                       0.192
Model:                            OLS   Adj. R-squared:                  0.185
Method:                 Least Squares   F-statistic:                     45.37
Date:                Tue, 17 Feb 2026   Prob (F-statistic):           4.87e-10
Time:                        22:26:10   Log-Likelihood:                -26.625
No. Observations:                 131   AIC:                             57.25
Df Residuals:                     129   BIC:                             63.00
Df Model:                           1                                         
Covariance Type:                  HC1                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      0.3967      0.046      8.597      0.000       0.306       0.487
growth         0.1308      0.019      6.736      0.000       0.093       0.169
==============================================================================
Omnibus:                       13.463   Durbin-Watson:                   2.186
Prob(Omnibus):                  0.001   Jarque-Bera (JB):               15.328
Skew:                          -0.821   Prob(JB):                     0.000469
Kurtosis:                       2.665   Cond. No.                         5.14
==============================================================================

Notes:
[1] Standard Errors are heteroscedasticity robust (HC1)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ch16_Checking_the_Model_and_Data_files/figure-html/cell-14-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Interpretation:
  Coefficient: 0.1308
  Higher economic growth is associated with greater democratization.
  But this may reflect omitted institutional variables...</code></pre>
</div>
</div>
<div id="cell-32" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-02-17T13:26:11.261760Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-02-17T13:26:11.261513Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-02-17T13:26:11.285452Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-02-17T13:26:11.284585Z&quot;}}" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiple regression: add institutional controls</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"-"</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Multiple Regression with Institutional Controls"</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>model_multiple <span class="op">=</span> ols(<span class="st">'democracy ~ growth + constraint + indcent + catholic + muslim + protestant'</span>,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>                     data<span class="op">=</span>data_democracy).fit(cov_type<span class="op">=</span><span class="st">'HC1'</span>)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model_multiple.summary())</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Key findings:"</span>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Growth coefficient fell from </span><span class="sc">{</span>model_bivariate<span class="sc">.</span>params[<span class="st">'growth'</span>]<span class="sc">:.4f}</span><span class="ss"> to </span><span class="sc">{</span>model_multiple<span class="sc">.</span>params[<span class="st">'growth'</span>]<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Institutional variables (religion, constraints) are important."</span>)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  This suggests omitted variable bias in the bivariate model."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
----------------------------------------------------------------------
Multiple Regression with Institutional Controls
----------------------------------------------------------------------
                            OLS Regression Results                            
==============================================================================
Dep. Variable:              democracy   R-squared:                       0.449
Model:                            OLS   Adj. R-squared:                  0.423
Method:                 Least Squares   F-statistic:                     23.41
Date:                Tue, 17 Feb 2026   Prob (F-statistic):           2.37e-18
Time:                        22:26:11   Log-Likelihood:                -1.4887
No. Observations:                 131   AIC:                             16.98
Df Residuals:                     124   BIC:                             37.10
Df Model:                           6                                         
Covariance Type:                  HC1                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      3.0307      0.975      3.109      0.002       1.120       4.941
growth         0.0468      0.025      1.841      0.066      -0.003       0.097
constraint     0.1645      0.072      2.270      0.023       0.022       0.306
indcent       -0.1331      0.050     -2.661      0.008      -0.231      -0.035
catholic       0.1171      0.089      1.324      0.186      -0.056       0.291
muslim        -0.2327      0.101     -2.303      0.021      -0.431      -0.035
protestant     0.1801      0.104      1.732      0.083      -0.024       0.384
==============================================================================
Omnibus:                        3.152   Durbin-Watson:                   2.109
Prob(Omnibus):                  0.207   Jarque-Bera (JB):                2.997
Skew:                          -0.305   Prob(JB):                        0.224
Kurtosis:                       2.581   Cond. No.                         761.
==============================================================================

Notes:
[1] Standard Errors are heteroscedasticity robust (HC1)

Key findings:
  Growth coefficient fell from 0.1308 to 0.0468
  Institutional variables (religion, constraints) are important.
  This suggests omitted variable bias in the bivariate model.</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>Key Concept 16.6: Omitted Variables Bias in Practice</strong></p>
<p>The democracy-growth example demonstrates omitted variables bias: the growth coefficient falls from 0.131 (bivariate) to 0.047 (with controls), a 64% reduction. Institutional variables (religion, executive constraints) were correlated with both democracy and growth, biasing the bivariate estimate upward. Always ask: ‚ÄúWhat variables might affect my outcome and correlate with my key regressor?‚Äù Include relevant controls to reduce bias.</p>
</blockquote>
<div id="cell-34" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-02-17T13:26:11.289227Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-02-17T13:26:11.288825Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-02-17T13:26:11.294183Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-02-17T13:26:11.293501Z&quot;}}" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get residuals from multiple regression for diagnostic plots</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>uhat <span class="op">=</span> model_multiple.resid</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>yhat <span class="op">=</span> model_multiple.fittedvalues</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"-"</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Residual Diagnostics Prepared"</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of residuals: </span><span class="sc">{</span><span class="bu">len</span>(uhat)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Residual mean (should be ~0): </span><span class="sc">{</span>uhat<span class="sc">.</span>mean()<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Residual std dev: </span><span class="sc">{</span>uhat<span class="sc">.</span>std()<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
----------------------------------------------------------------------
Residual Diagnostics Prepared
----------------------------------------------------------------------
Number of residuals: 131
Residual mean (should be ~0): -0.000000
Residual std dev: 0.2457</code></pre>
</div>
</div>
</section>
<section id="diagnostics---residual-plots" class="level2">
<h2 class="anchored" data-anchor-id="diagnostics---residual-plots">16.8: Diagnostics - Residual Plots</h2>
<p>Diagnostic plots help detect violations of model assumptions:</p>
<ol type="1">
<li><strong>Actual vs Fitted</strong>: Should cluster around 45¬∞ line</li>
<li><strong>Residual vs Fitted</strong>: Should scatter randomly around zero</li>
<li><strong>Residual vs Regressor</strong>: Should scatter randomly around zero</li>
<li><strong>Component Plus Residual Plot</strong>: <span class="math inline">\(b_j x_j + e\)</span> vs <span class="math inline">\(x_j\)</span> (detects nonlinearity)</li>
<li><strong>Added Variable Plot</strong>: Partial <span class="math inline">\(y\)</span> vs partial <span class="math inline">\(x_j\)</span> (isolates effect)</li>
</ol>
<p><strong>LOWESS smooth</strong>: Nonparametric smooth curve helps detect patterns</p>
<hr>
<section id="reading-diagnostic-plots-what-to-look-for" class="level3">
<h3 class="anchored" data-anchor-id="reading-diagnostic-plots-what-to-look-for">Reading Diagnostic Plots: What to Look For</h3>
<p>The diagnostic plots help us <strong>visually detect</strong> violations of regression assumptions. Let‚Äôs interpret what we see:</p>
<p><strong>Panel A: Actual vs Fitted</strong></p>
<p><strong>What to look for:</strong></p>
<ul>
<li>Points should <strong>cluster around 45¬∞ line</strong></li>
<li>LOWESS smooth should <strong>follow</strong> the 45¬∞ line closely</li>
<li>Deviations indicate <strong>systematic prediction errors</strong></li>
</ul>
<p><strong>In the democracy-growth example:</strong></p>
<ul>
<li>Most points <strong>reasonably close</strong> to 45¬∞ line</li>
<li>LOWESS smooth <strong>roughly linear</strong>, close to 45¬∞</li>
<li>Some <strong>scatter</strong> (R¬≤ ‚âà 0.20-0.30, so significant unexplained variation)</li>
<li><strong>No obvious systematic bias</strong> (LOWESS not curved)</li>
</ul>
<p><strong>Interpretation:</strong></p>
<ul>
<li>Model captures <strong>general relationship</strong> reasonably</li>
<li>But substantial <strong>residual variation</strong> remains</li>
<li>No evidence of <strong>major nonlinearity</strong> (LOWESS smooth is linear)</li>
</ul>
<p><strong>Panel B: Residual vs Fitted</strong></p>
<p><strong>What to look for:</strong></p>
<ul>
<li>Residuals should <strong>scatter randomly</strong> around zero</li>
<li><strong>Equal spread</strong> across range of fitted values (homoskedasticity)</li>
<li>LOWESS should be <strong>horizontal</strong> at zero</li>
<li>No <strong>patterns</strong>, <strong>curvature</strong>, or <strong>heteroskedasticity</strong></li>
</ul>
<p><strong>In the democracy-growth example:</strong></p>
<ul>
<li>Residuals <strong>scatter</strong> around zero</li>
<li>LOWESS smooth <strong>close to horizontal</strong></li>
<li>Spread appears <strong>roughly constant</strong></li>
<li>Some <strong>outliers</strong> but not extreme</li>
</ul>
<p><strong>Potential issues to watch for:</strong></p>
<ol type="1">
<li><strong>Heteroskedasticity</strong>: Fan shape (spread increases)</li>
<li><strong>Nonlinearity</strong>: LOWESS curved (missing quadratic term)</li>
<li><strong>Outliers</strong>: Points far from zero (influential observations)</li>
</ol>
<p><strong>Key Diagnostic Insights:</strong></p>
<ol type="1">
<li><strong>No major heteroskedasticity</strong>:</li>
</ol>
<ul>
<li>Spread doesn‚Äôt systematically increase/decrease</li>
<li>Robust SEs still advisable (safety margin)</li>
<li>But not severe heteroskedasticity</li>
</ul>
<ol start="2" type="1">
<li><strong>Linearity assumption appears okay</strong>:</li>
</ol>
<ul>
<li>LOWESS smooth roughly horizontal</li>
<li>If curved: suggests missing nonlinear terms</li>
<li>Could try quadratic, interactions</li>
</ul>
<ol start="3" type="1">
<li><strong>A few potential outliers</strong>:</li>
</ol>
<ul>
<li>Countries with large positive/negative residuals</li>
<li>Follow up with DFITS, DFBETAS (see next sections)</li>
<li>Investigate: data errors or genuinely unusual cases?</li>
</ul>
<p><strong>What Would Bad Plots Look Like?</strong></p>
<p><strong>Heteroskedasticity (fan shape):</strong></p>
<ul>
<li>Residual spread <strong>increases</strong> with fitted values</li>
<li>Common in income, revenue, GDP data</li>
<li>Solution: Log transformation or WLS</li>
</ul>
<p><strong>Nonlinearity (curved LOWESS):</strong></p>
<ul>
<li>LOWESS smooth <strong>curves</strong> (U-shape or inverted U)</li>
<li>Missing quadratic or other nonlinear terms</li>
<li>Solution: Add polynomial, interaction, or transform</li>
</ul>
<p><strong>Autocorrelation (time series):</strong></p>
<ul>
<li>Residuals show <strong>runs</strong> (streaks of same sign)</li>
<li>Not visible in scatter plot (need time-series plot)</li>
<li>Solution: HAC SEs, add lags, difference</li>
</ul>
<p><strong>Outliers:</strong></p>
<ul>
<li>A few points <strong>very far</strong> from main cluster</li>
<li>Can distort regression line</li>
<li>Investigate with influence diagnostics (DFITS, DFBETAS)</li>
</ul>
<p><strong>The LOWESS Smooth:</strong></p>
<p><strong>What is it?</strong></p>
<ul>
<li><strong>L</strong>ocally <strong>W</strong>eighted <strong>S</strong>catterplot <strong>S</strong>moothing</li>
<li>Nonparametric smooth curve through data</li>
<li>Helps detect <strong>patterns</strong> hard to see in raw scatter</li>
</ul>
<p><strong>How to interpret:</strong></p>
<ul>
<li>Should be <strong>straight</strong> and <strong>flat</strong> if model is correct</li>
<li><strong>Curvature</strong> suggests missing nonlinearity</li>
<li><strong>Trend</strong> (not horizontal) suggests systematic bias</li>
</ul>
<p><strong>Bottom Line:</strong></p>
<p>For democracy-growth model:</p>
<ul>
<li>Diagnostic plots look <strong>reasonably good</strong></li>
<li>No glaring violations of assumptions</li>
<li>Some outliers worth investigating (next section)</li>
<li>Model appears <strong>adequately specified</strong></li>
<li>But low R¬≤ suggests many <strong>omitted variables</strong></li>
</ul>
</section>
<section id="diagnostic-plots-for-individual-regressor-growth" class="level3">
<h3 class="anchored" data-anchor-id="diagnostic-plots-for-individual-regressor-growth">Diagnostic Plots for Individual Regressor (Growth)</h3>
<p>Three specialized plots for examining the growth variable:</p>
<ol type="1">
<li><strong>Residual vs Regressor</strong>: Checks for heteroskedasticity and nonlinearity</li>
<li><strong>Component Plus Residual</strong>: <span class="math inline">\(b_{growth} \times growth + e\)</span> vs <span class="math inline">\(growth\)</span>
<ul>
<li>Linear relationship ‚Üí straight line</li>
<li>Nonlinearity ‚Üí curved LOWESS</li>
</ul></li>
<li><strong>Added Variable Plot</strong>: Controls for other variables
<ul>
<li>Slope equals coefficient in full model</li>
<li>Shows partial relationship</li>
</ul></li>
</ol>
<div id="cell-38" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-02-17T13:26:11.297593Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-02-17T13:26:11.297312Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-02-17T13:26:11.860306Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-02-17T13:26:11.859758Z&quot;}}" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"16.8: DIAGNOSTIC PLOTS"</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 16.2: Basic diagnostic plots</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel A: Actual vs Fitted</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].scatter(yhat, data_democracy[<span class="st">'democracy'</span>], alpha<span class="op">=</span><span class="fl">0.6</span>, s<span class="op">=</span><span class="dv">50</span>, color<span class="op">=</span><span class="st">'#22d3ee'</span>)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot([yhat.<span class="bu">min</span>(), yhat.<span class="bu">max</span>()], [yhat.<span class="bu">min</span>(), yhat.<span class="bu">max</span>()],</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>             <span class="st">'-'</span>, color<span class="op">=</span><span class="st">'#c084fc'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'45¬∞ line'</span>)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>lowess_result <span class="op">=</span> lowess(data_democracy[<span class="st">'democracy'</span>], yhat, frac<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(lowess_result[:, <span class="dv">0</span>], lowess_result[:, <span class="dv">1</span>],</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>             <span class="st">'r--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'LOWESS smooth'</span>)</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Fitted Democracy'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Actual Democracy'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Panel A: Actual vs Fitted'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend()</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel B: Residual vs Fitted</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].scatter(yhat, uhat, alpha<span class="op">=</span><span class="fl">0.6</span>, s<span class="op">=</span><span class="dv">50</span>, color<span class="op">=</span><span class="st">'#22d3ee'</span>)</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linewidth<span class="op">=</span><span class="dv">2</span>, linestyle<span class="op">=</span><span class="st">'-'</span>)</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>lowess_result <span class="op">=</span> lowess(uhat, yhat, frac<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(lowess_result[:, <span class="dv">0</span>], lowess_result[:, <span class="dv">1</span>],</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>             <span class="st">'r--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'LOWESS smooth'</span>)</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">'Fitted Democracy'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'Residual'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Panel B: Residual vs Fitted'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].legend()</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'Figure 16.2: Basic Diagnostic Plots'</span>,</span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>             fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, y<span class="op">=</span><span class="fl">1.00</span>)</span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Interpretation:"</span>)</span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  Panel A: Points should cluster around 45¬∞ line"</span>)</span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  Panel B: Residuals should scatter randomly around zero"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
16.8: DIAGNOSTIC PLOTS
======================================================================</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ch16_Checking_the_Model_and_Data_files/figure-html/cell-17-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Interpretation:
  Panel A: Points should cluster around 45¬∞ line
  Panel B: Residuals should scatter randomly around zero</code></pre>
</div>
</div>
<div id="cell-39" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-02-17T13:26:11.863825Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-02-17T13:26:11.863575Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-02-17T13:26:12.695506Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-02-17T13:26:12.694952Z&quot;}}" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 16.3: Diagnostic plots for growth regressor</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"-"</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Figure 16.3: Diagnostic Plots for Growth Regressor"</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">5</span>))</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel A: Residual vs Regressor</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].scatter(data_democracy[<span class="st">'growth'</span>], uhat, alpha<span class="op">=</span><span class="fl">0.6</span>, s<span class="op">=</span><span class="dv">50</span>, color<span class="op">=</span><span class="st">'#22d3ee'</span>)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linewidth<span class="op">=</span><span class="dv">2</span>, linestyle<span class="op">=</span><span class="st">'-'</span>)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>lowess_result <span class="op">=</span> lowess(uhat, data_democracy[<span class="st">'growth'</span>], frac<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(lowess_result[:, <span class="dv">0</span>], lowess_result[:, <span class="dv">1</span>],</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>             <span class="st">'r--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'LOWESS smooth'</span>)</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Growth regressor'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Democracy Residual'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Panel A: Residual vs Regressor'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend()</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel B: Component Plus Residual</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>b_growth <span class="op">=</span> model_multiple.params[<span class="st">'growth'</span>]</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>pr_growth <span class="op">=</span> b_growth <span class="op">*</span> data_democracy[<span class="st">'growth'</span>] <span class="op">+</span> uhat</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].scatter(data_democracy[<span class="st">'growth'</span>], pr_growth, alpha<span class="op">=</span><span class="fl">0.6</span>, s<span class="op">=</span><span class="dv">50</span>, color<span class="op">=</span><span class="st">'#22d3ee'</span>)</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Regression line</span></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>model_compplusres <span class="op">=</span> ols(<span class="st">'pr_growth ~ growth'</span>, </span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>                        data<span class="op">=</span>pd.DataFrame({<span class="st">'growth'</span>: data_democracy[<span class="st">'growth'</span>],</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">'pr_growth'</span>: pr_growth})).fit()</span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(data_democracy[<span class="st">'growth'</span>], model_compplusres.fittedvalues,</span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>             <span class="st">'-'</span>, color<span class="op">=</span><span class="st">'#c084fc'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Regression line'</span>)</span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>lowess_result <span class="op">=</span> lowess(pr_growth, data_democracy[<span class="st">'growth'</span>], frac<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(lowess_result[:, <span class="dv">0</span>], lowess_result[:, <span class="dv">1</span>],</span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>             <span class="st">'r--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'LOWESS smooth'</span>)</span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">'Growth regressor'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="ss">f'Dem Res + </span><span class="sc">{</span>b_growth<span class="sc">:.3f}</span><span class="ss">*Growth'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Panel B: Component Plus Residual'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].legend()</span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel C: Added Variable Plot</span></span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a>model_nogrowth <span class="op">=</span> ols(<span class="st">'democracy ~ constraint + indcent + catholic + muslim + protestant'</span>,</span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a>                     data<span class="op">=</span>data_democracy).fit()</span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a>uhat_democ <span class="op">=</span> model_nogrowth.resid</span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a>model_growth <span class="op">=</span> ols(<span class="st">'growth ~ constraint + indcent + catholic + muslim + protestant'</span>,</span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a>                   data<span class="op">=</span>data_democracy).fit()</span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a>uhat_growth <span class="op">=</span> model_growth.resid</span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].scatter(uhat_growth, uhat_democ, alpha<span class="op">=</span><span class="fl">0.6</span>, s<span class="op">=</span><span class="dv">50</span>, color<span class="op">=</span><span class="st">'#22d3ee'</span>)</span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a>model_addedvar <span class="op">=</span> ols(<span class="st">'uhat_democ ~ uhat_growth'</span>,</span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a>                     data<span class="op">=</span>pd.DataFrame({<span class="st">'uhat_growth'</span>: uhat_growth,</span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">'uhat_democ'</span>: uhat_democ})).fit()</span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].plot(uhat_growth, model_addedvar.fittedvalues,</span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a>             <span class="st">'-'</span>, color<span class="op">=</span><span class="st">'#c084fc'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Regression line'</span>)</span>
<span id="cb38-61"><a href="#cb38-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-62"><a href="#cb38-62" aria-hidden="true" tabindex="-1"></a>lowess_result <span class="op">=</span> lowess(uhat_democ, uhat_growth, frac<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb38-63"><a href="#cb38-63" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].plot(lowess_result[:, <span class="dv">0</span>], lowess_result[:, <span class="dv">1</span>],</span>
<span id="cb38-64"><a href="#cb38-64" aria-hidden="true" tabindex="-1"></a>             <span class="st">'r--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'LOWESS smooth'</span>)</span>
<span id="cb38-65"><a href="#cb38-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-66"><a href="#cb38-66" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_xlabel(<span class="st">'Growth regressor (partial)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb38-67"><a href="#cb38-67" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_ylabel(<span class="st">'Democracy (partial)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb38-68"><a href="#cb38-68" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_title(<span class="st">'Panel C: Added Variable'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb38-69"><a href="#cb38-69" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].legend()</span>
<span id="cb38-70"><a href="#cb38-70" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb38-71"><a href="#cb38-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-72"><a href="#cb38-72" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'Figure 16.3: Diagnostic Plots for Growth Regressor'</span>,</span>
<span id="cb38-73"><a href="#cb38-73" aria-hidden="true" tabindex="-1"></a>             fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, y<span class="op">=</span><span class="fl">1.00</span>)</span>
<span id="cb38-74"><a href="#cb38-74" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb38-75"><a href="#cb38-75" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb38-76"><a href="#cb38-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-77"><a href="#cb38-77" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Interpretation:"</span>)</span>
<span id="cb38-78"><a href="#cb38-78" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  Panel A: Check for patterns in residuals"</span>)</span>
<span id="cb38-79"><a href="#cb38-79" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  Panel B: LOWESS close to regression line ‚Üí linear relationship OK"</span>)</span>
<span id="cb38-80"><a href="#cb38-80" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  Panel C: Slope equals coefficient in full model (</span><span class="sc">{:.4f}</span><span class="st">)"</span>.<span class="bu">format</span>(b_growth))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
----------------------------------------------------------------------
Figure 16.3: Diagnostic Plots for Growth Regressor
----------------------------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ch16_Checking_the_Model_and_Data_files/figure-html/cell-18-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Interpretation:
  Panel A: Check for patterns in residuals
  Panel B: LOWESS close to regression line ‚Üí linear relationship OK
  Panel C: Slope equals coefficient in full model (0.0468)</code></pre>
</div>
</div>
<p><em>Having examined residual diagnostic plots for visual detection of model problems, we now turn to numerical influence measures that quantify how much individual observations affect regression results.</em></p>
<blockquote class="blockquote">
<p><strong>Key Concept 16.7: Diagnostic Plots for Model Validation</strong></p>
<p>Three complementary plots assess individual regressors: (1) residual vs.&nbsp;regressor checks for patterns suggesting nonlinearity or heteroskedasticity; (2) component-plus-residual plot (<span class="math inline">\(b_j x_j + e\)</span> vs.&nbsp;<span class="math inline">\(x_j\)</span>) reveals the partial relationship and detects nonlinearity; (3) added variable plot purges both <span class="math inline">\(y\)</span> and <span class="math inline">\(x_j\)</span> of other regressors, showing the pure partial effect whose slope equals the OLS coefficient <span class="math inline">\(b_j\)</span>. LOWESS smoothing helps reveal systematic patterns.</p>
</blockquote>
</section>
<section id="influential-observations-dfits" class="level3">
<h3 class="anchored" data-anchor-id="influential-observations-dfits">Influential Observations: DFITS</h3>
<p><strong>DFITS</strong> measures influence on fitted values: <span class="math display">\[DFITS_i = \frac{\hat{y}_i - \hat{y}_{i(i)}}{s_{(i)} \sqrt{h_{ii}}}\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\hat{y}_i\)</span> = prediction including observation <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(\hat{y}_{i(i)}\)</span> = prediction excluding observation <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(s_{(i)}\)</span> = RMSE excluding observation <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(h_{ii}\)</span> = leverage of observation <span class="math inline">\(i\)</span></li>
</ul>
<p><strong>Rule of thumb</strong>: Investigate if <span class="math inline">\(|DFITS_i| &gt; 2\sqrt{k/n}\)</span></p>
<div id="cell-43" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-02-17T13:26:12.700151Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-02-17T13:26:12.699868Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-02-17T13:26:13.030330Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-02-17T13:26:13.029822Z&quot;}}" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"INFLUENTIAL OBSERVATIONS: DFITS"</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Get influence diagnostics</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>influence <span class="op">=</span> OLSInfluence(model_multiple)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>dfits <span class="op">=</span> influence.dffits[<span class="dv">0</span>]</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="bu">len</span>(data_democracy)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>threshold_dfits <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> np.sqrt(<span class="bu">len</span>(model_multiple.params) <span class="op">/</span> n)</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">DFITS threshold: </span><span class="sc">{</span>threshold_dfits<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Observations exceeding threshold: </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">sum</span>(np.<span class="bu">abs</span>(dfits) <span class="op">&gt;</span> threshold_dfits)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot DFITS</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>obs_index <span class="op">=</span> np.arange(n)</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [<span class="st">'red'</span> <span class="cf">if</span> <span class="bu">abs</span>(d) <span class="op">&gt;</span> threshold_dfits <span class="cf">else</span> <span class="st">'#22d3ee'</span> <span class="cf">for</span> d <span class="kw">in</span> dfits]</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>ax.scatter(obs_index, dfits, c<span class="op">=</span>colors, alpha<span class="op">=</span><span class="fl">0.6</span>, s<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>ax.axhline(y<span class="op">=</span>threshold_dfits, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="ss">f'Threshold: ¬±</span><span class="sc">{</span>threshold_dfits<span class="sc">:.3f}</span><span class="ss">'</span>)</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>ax.axhline(y<span class="op">=-</span>threshold_dfits, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>ax.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Observation Index'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'DFITS'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Figure: DFITS - Influential Observations'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Interpretation:"</span>)</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  Red points exceed threshold (potentially influential)"</span>)</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  Investigate these observations for data errors or unusual cases"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
INFLUENTIAL OBSERVATIONS: DFITS
======================================================================

DFITS threshold: 0.4623
Observations exceeding threshold: 5</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ch16_Checking_the_Model_and_Data_files/figure-html/cell-19-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Interpretation:
  Red points exceed threshold (potentially influential)
  Investigate these observations for data errors or unusual cases</code></pre>
</div>
</div>
<hr>
<section id="identifying-influential-observations-with-dfits" class="level4">
<h4 class="anchored" data-anchor-id="identifying-influential-observations-with-dfits">Identifying Influential Observations with DFITS</h4>
<p>DFITS measures how much an observation influences its <strong>own prediction</strong>. The results help identify <strong>potentially problematic</strong> observations:</p>
<p><strong>Understanding DFITS:</strong></p>
<p>Formula: <span class="math inline">\(DFITS_i = \frac{\hat{y}_i - \hat{y}_{i(i)}}{s_{(i)} \sqrt{h_{ii}}}\)</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\hat{y}_i\)</span> = prediction <strong>including</strong> observation i</li>
<li><span class="math inline">\(\hat{y}_{i(i)}\)</span> = prediction <strong>excluding</strong> observation i</li>
<li><span class="math inline">\(s_{(i)}\)</span> = RMSE excluding observation i</li>
<li><span class="math inline">\(h_{ii}\)</span> = leverage (how unusual is <span class="math inline">\(x_i\)</span>?)</li>
</ul>
<p><strong>Interpretation:</strong></p>
<ul>
<li>DFITS measures <strong>standardized change</strong> in fitted value when i is deleted</li>
<li>Large |DFITS| ‚Üí observation strongly influences its own prediction</li>
<li>Can be driven by <strong>leverage</strong> (unusual X) or <strong>residual</strong> (unusual Y|X)</li>
</ul>
<p><strong>Rule of Thumb:</strong></p>
<p>Threshold: <span class="math inline">\(|DFITS_i| &gt; 2\sqrt{k/n}\)</span></p>
<p>For democracy-growth model (k ‚âà 7, n = 131):</p>
<ul>
<li>Threshold ‚âà $2 = 2 *0.46**</li>
</ul>
<p><strong>Typical Results:</strong></p>
<ul>
<li><strong>Most observations</strong>: |DFITS| &lt; 0.30 (not influential)</li>
<li><strong>A few observations</strong>: |DFITS| = 0.5-0.8 (moderately influential)</li>
<li><strong>Extreme cases</strong>: |DFITS| &gt; 1.0 (highly influential)</li>
</ul>
<p><strong>What Makes an Observation Influential?</strong></p>
<p>Two components multiply:</p>
<ol type="1">
<li><strong>Leverage</strong> (<span class="math inline">\(h_{ii}\)</span>): Unusual X values</li>
<li><strong>Standardized residual</strong>: Large prediction error</li>
</ol>
<p><strong>Most influential when both are large:</strong></p>
<ul>
<li>Observation with <strong>unusual combination of regressors</strong> (high leverage)</li>
<li><strong>AND</strong> doesn‚Äôt fit the pattern (large residual)</li>
<li>Example: A country with unique institutions AND surprising democracy level</li>
</ul>
<p><strong>What to Do with Influential Observations:</strong></p>
<p><strong>1. Investigate the data:</strong></p>
<ul>
<li>Is it a <strong>data error</strong>? (typo, coding mistake)</li>
<li>Check original sources</li>
<li>If error: <strong>correct or remove</strong></li>
</ul>
<p><strong>2. Understand the case:</strong></p>
<ul>
<li>Is it genuinely unusual? (e.g., special historical circumstances)</li>
<li>Example: Post-colonial country with unique constraints</li>
<li>Adds valuable information, <strong>keep it</strong></li>
</ul>
<p><strong>3. Check robustness:</strong></p>
<ul>
<li>Re-estimate <strong>without</strong> the influential observations</li>
<li>Do conclusions change substantially?</li>
<li>If yes: Results <strong>fragile</strong>, interpret cautiously</li>
<li>If no: Results <strong>robust</strong>, less concerning</li>
</ul>
<p><strong>4. Model improvement:</strong></p>
<ul>
<li>Does omitting observation suggest missing variables?</li>
<li>Example: Maybe need regional dummies</li>
<li>Influential observations often <strong>signal model misspecification</strong></li>
</ul>
<p><strong>Example Interpretation:</strong></p>
<p>Suppose observation #47 has DFITS = 0.85:</p>
<ul>
<li>This country‚Äôs predicted democracy changes by <strong>0.85 standard deviations</strong> when it‚Äôs excluded</li>
<li>Country is either:</li>
<li><strong>High leverage</strong> (unusual institutional characteristics), or</li>
<li><strong>Large residual</strong> (democracy level doesn‚Äôt match institutions), or</li>
<li><strong>Both</strong></li>
<li>Warrants investigation</li>
</ul>
<p><strong>DFITS vs.&nbsp;Other Influence Measures:</strong></p>
<ul>
<li><strong>DFITS</strong>: Influence on <strong>own prediction</strong></li>
<li><strong>DFBETAS</strong>: Influence on <strong>regression coefficients</strong> (see next)</li>
<li><strong>Cook‚Äôs D</strong>: Overall influence on <strong>all fitted values</strong></li>
<li><strong>Leverage</strong> (<span class="math inline">\(h_{ii}\)</span>): Just the X-space component</li>
</ul>
<p><strong>Visualization:</strong></p>
<p>The DFITS plot shows:</p>
<ul>
<li><strong>Blue points</strong>: Not influential (within threshold)</li>
<li><strong>Red points</strong>: Influential (exceed threshold)</li>
<li>Should be <strong>mostly blue</strong> with a <strong>few red</strong> outliers</li>
<li>Many red points ‚Üí model problems or data issues</li>
</ul>
<p><strong>In the Democracy-Growth Example:</strong></p>
<p>Typical findings:</p>
<ul>
<li>3-10 countries exceed threshold (out of 131)</li>
<li>These are <strong>countries with unusual institutional/growth combinations</strong></li>
<li>Might include:</li>
<li>Rapidly democratizing autocracies</li>
<li>Stable democracies with slow growth</li>
<li>Post-conflict transitions</li>
<li>Resource-rich countries with unusual politics</li>
</ul>
<p><strong>Practical Advice:</strong></p>
<p><strong>Do:</strong></p>
<ul>
<li>Always compute influence diagnostics</li>
<li>Investigate observations exceeding thresholds</li>
<li>Report whether results change without influential cases</li>
<li>Consider robustness checks</li>
</ul>
<p><strong>Don‚Äôt:</strong></p>
<ul>
<li>Automatically delete influential observations</li>
<li>Ignore them without investigation</li>
<li>Only report results <strong>after</strong> deleting outliers (selective reporting)</li>
<li>Delete based solely on statistical criteria (needs substantive judgment)</li>
</ul>
<p><strong>Bottom Line:</strong></p>
<p>DFITS is a <strong>screening tool</strong>:</p>
<ul>
<li>Identifies observations <strong>worth investigating</strong></li>
<li>Not a mechanical <strong>deletion rule</strong></li>
<li>Combine statistical diagnosis with <strong>subject-matter knowledge</strong></li>
<li>Goal: Better understand data and model, not just clean data</li>
</ul>
</section>
</section>
<section id="influential-observations-dfbetas" class="level3">
<h3 class="anchored" data-anchor-id="influential-observations-dfbetas">Influential Observations: DFBETAS</h3>
<p><strong>DFBETAS</strong> measures influence on individual coefficients: <span class="math display">\[DFBETAS_{j, i} = \frac{\hat{\beta}_j - \hat{\beta}_{j(i)}}{s_{(i)} \sqrt{(X'X)^{-1}_{jj}}}\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\hat{\beta}_j\)</span> = coefficient including observation <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(\hat{\beta}_{j(i)}\)</span> = coefficient excluding observation <span class="math inline">\(i\)</span></li>
</ul>
<p><strong>Rule of thumb</strong>: Investigate if <span class="math inline">\(|DFBETAS_{j, i}| &gt; 2/\sqrt{n}\)</span></p>
<div id="cell-46" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-02-17T13:26:13.034463Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-02-17T13:26:13.034206Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-02-17T13:26:14.459733Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-02-17T13:26:14.459130Z&quot;}}" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"INFLUENTIAL OBSERVATIONS: DFBETAS"</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>dfbetas <span class="op">=</span> influence.dfbetas</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>threshold_dfbetas <span class="op">=</span> <span class="dv">2</span> <span class="op">/</span> np.sqrt(n)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">DFBETAS threshold: </span><span class="sc">{</span>threshold_dfbetas<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot DFBETAS for each variable</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>param_names <span class="op">=</span> model_multiple.params.index</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>n_params <span class="op">=</span> <span class="bu">len</span>(param_names)</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">10</span>))</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>axes <span class="op">=</span> axes.flatten()</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, param <span class="kw">in</span> <span class="bu">enumerate</span>(param_names):</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">&lt;</span> <span class="bu">len</span>(axes):</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>        colors <span class="op">=</span> [<span class="st">'red'</span> <span class="cf">if</span> <span class="bu">abs</span>(d) <span class="op">&gt;</span> threshold_dfbetas <span class="cf">else</span> <span class="st">'#22d3ee'</span> </span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">for</span> d <span class="kw">in</span> dfbetas[:, i]]</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>        axes[i].scatter(obs_index, dfbetas[:, i], c<span class="op">=</span>colors, alpha<span class="op">=</span><span class="fl">0.6</span>, s<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>        axes[i].axhline(y<span class="op">=</span>threshold_dfbetas, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>        axes[i].axhline(y<span class="op">=-</span>threshold_dfbetas, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>        axes[i].axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>        axes[i].set_xlabel(<span class="st">'Observation'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>        axes[i].set_ylabel(<span class="st">'DFBETAS'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>        axes[i].set_title(<span class="ss">f'</span><span class="sc">{</span>param<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>        axes[i].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove extra subplots</span></span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_params, <span class="bu">len</span>(axes)):</span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>    fig.delaxes(axes[i])</span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'DFBETAS: Influential Observations by Variable'</span>,</span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a>             fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, y<span class="op">=</span><span class="fl">1.00</span>)</span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Interpretation:"</span>)</span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  Red points indicate observations with large influence on that coefficient."</span>)</span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  Investigate whether these are data errors or genuinely unusual cases."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
INFLUENTIAL OBSERVATIONS: DFBETAS
======================================================================

DFBETAS threshold: 0.1747</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ch16_Checking_the_Model_and_Data_files/figure-html/cell-20-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Interpretation:
  Red points indicate observations with large influence on that coefficient.
  Investigate whether these are data errors or genuinely unusual cases.</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>Key Concept 16.8: Influential Observations ‚Äì DFITS and DFBETAS</strong></p>
<p>DFITS measures influence on fitted values: <span class="math inline">\(DFITS_i\)</span> is the scaled change in <span class="math inline">\(\hat{y}_i\)</span> when observation <span class="math inline">\(i\)</span> is excluded. DFBETAS measures influence on individual coefficients: <span class="math inline">\(DFBETAS_{j,i}\)</span> is the scaled change in <span class="math inline">\(\hat{\beta}_j\)</span>. Thresholds for investigation are <span class="math inline">\(|DFITS| &gt; 2\sqrt{k/n}\)</span> and <span class="math inline">\(|DFBETAS| &gt; 2/\sqrt{n}\)</span>. Don‚Äôt automatically delete influential points ‚Äì investigate whether they represent data errors, genuine outliers, or valid extreme values that carry important information.</p>
</blockquote>
</section>
</section>
<section id="key-takeaways" class="level2">
<h2 class="anchored" data-anchor-id="key-takeaways">Key Takeaways</h2>
<p><strong>Multicollinearity:</strong></p>
<ul>
<li>Multicollinearity occurs when regressors are highly correlated, making individual coefficients imprecisely estimated</li>
<li>VIF &gt; 10 indicates serious multicollinearity; VIF &gt; 5 warrants investigation</li>
<li>OLS remains unbiased and consistent ‚Äì the problem is precision, not bias</li>
<li>Solutions: use joint F-tests, drop redundant variables, center variables before creating interactions, or collect more data</li>
</ul>
<p><strong>OLS Assumption Violations:</strong></p>
<ul>
<li>Assumptions 1-2 violations (incorrect model, endogeneity) cause bias and inconsistency ‚Äì fundamental problems requiring model changes or IV</li>
<li>Assumptions 3-4 violations (heteroskedasticity, autocorrelation) do not bias coefficients but invalidate standard errors</li>
<li>Wrong standard errors lead to incorrect t-statistics, confidence intervals, and hypothesis tests</li>
<li>Omitted variables bias formula: <span class="math inline">\(\text{Bias} = \beta_3 \times \delta_{23}\)</span>, where <span class="math inline">\(\beta_3\)</span> is the omitted variable‚Äôs effect and <span class="math inline">\(\delta_{23}\)</span> is the correlation</li>
</ul>
<p><strong>Heteroskedasticity and Robust Standard Errors:</strong></p>
<ul>
<li>Heteroskedasticity means error variance varies across observations, common in cross-sectional data</li>
<li>Use heteroskedasticity-robust (HC1/White) standard errors for valid inference</li>
<li>Robust SEs are typically larger than default SEs, giving more conservative (honest) inference</li>
<li>Always use robust SEs for cross-sectional regressions as a default practice</li>
</ul>
<p><strong>Autocorrelation and HAC Standard Errors:</strong></p>
<ul>
<li>Autocorrelation means errors are correlated over time, common in time series data</li>
<li>Default SEs are typically too small with autocorrelation, leading to over-rejection</li>
<li>Use HAC (Newey-West) standard errors that account for both heteroskedasticity and autocorrelation</li>
<li>Check the ACF of residuals to detect autocorrelation patterns</li>
</ul>
<p><strong>Diagnostic Plots:</strong></p>
<ul>
<li>Residual vs.&nbsp;fitted values: detect heteroskedasticity (fan shape) and nonlinearity (curved pattern)</li>
<li>Component-plus-residual plot: detect nonlinearity in individual regressors</li>
<li>Added variable plot: isolate partial relationship between y and x, controlling for other variables</li>
<li>LOWESS smooth helps reveal patterns that are hard to see in raw scatter plots</li>
</ul>
<p><strong>Influential Observations:</strong></p>
<ul>
<li>DFITS measures influence on fitted values; threshold <span class="math inline">\(|\text{DFITS}| &gt; 2\sqrt{k/n}\)</span></li>
<li>DFBETAS measures influence on individual coefficients; threshold <span class="math inline">\(|\text{DFBETAS}| &gt; 2/\sqrt{n}\)</span></li>
<li>Investigate influential observations rather than automatically deleting them</li>
<li>Check whether conclusions change substantially when influential cases are excluded</li>
</ul>
<p><strong>Python tools:</strong> <code>statsmodels</code> (VIF, OLSInfluence, robust covariance), <code>matplotlib</code>/<code>seaborn</code> (diagnostic plots), LOWESS smoothing</p>
<p><strong>Next steps:</strong> Chapter 17 extends these ideas to panel data, where you‚Äôll learn fixed effects and random effects models that address unobserved heterogeneity across units.</p>
<hr>
<p>Congratulations! You‚Äôve completed Chapter 16 on model checking and data diagnostics. You now have both the theoretical understanding and practical Python skills to evaluate regression assumptions, detect problems, and apply appropriate remedies.</p>
</section>
<section id="practice-exercises" class="level2">
<h2 class="anchored" data-anchor-id="practice-exercises">Practice Exercises</h2>
<p><strong>Exercise 1: Irrelevant Variables vs.&nbsp;Omitted Variables</strong></p>
<p>You estimate <span class="math inline">\(y_i = \beta_1 + \beta_2 x_{2i} + \beta_3 x_{3i} + u_i\)</span> by OLS.</p>
<ol type="a">
<li><p>If <span class="math inline">\(x_3\)</span> should not appear in the model (irrelevant variable), what happens to the OLS estimates of <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span>? Are they biased?</p></li>
<li><p>If a relevant variable <span class="math inline">\(x_4\)</span> was omitted from the model, and <span class="math inline">\(x_4\)</span> is correlated with <span class="math inline">\(x_2\)</span>, what happens to <span class="math inline">\(\hat{\beta}_2\)</span>? Write the omitted variables bias formula.</p></li>
</ol>
<p><strong>Exercise 2: VIF Interpretation</strong></p>
<p>A regression of earnings on age, education, and experience yields VIF values of 22.0 (age), 17.3 (education), and 36.9 (experience).</p>
<ol type="a">
<li><p>Which variable has the most severe multicollinearity problem? Explain.</p></li>
<li><p>Calculate the <span class="math inline">\(R^2\)</span> from the auxiliary regression for the variable with the highest VIF.</p></li>
<li><p>By what factor are the standard errors inflated compared to the no-collinearity case?</p></li>
</ol>
<p><strong>Exercise 3: Choosing Standard Error Types</strong></p>
<p>For each scenario below, state which type of standard errors you would use (default, HC-robust, HAC, or cluster-robust) and why:</p>
<ol type="a">
<li><p>Cross-sectional regression of wages on education and experience for 5,000 workers.</p></li>
<li><p>Time series regression of GDP growth on interest rates using 200 quarterly observations.</p></li>
<li><p>Regression of test scores on class size using data from 50 schools with multiple classrooms per school.</p></li>
</ol>
<p><strong>Exercise 4: Heteroskedasticity Detection</strong></p>
<p>You estimate a regression and obtain the following SE comparison:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Variable</th>
<th>Standard SE</th>
<th>Robust SE</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Education</td>
<td>570</td>
<td>642</td>
<td>1.13</td>
</tr>
<tr class="even">
<td>Age</td>
<td>154</td>
<td>151</td>
<td>0.98</td>
</tr>
</tbody>
</table>
<ol type="a">
<li><p>Is there evidence of heteroskedasticity? Which variable‚Äôs inference is most affected?</p></li>
<li><p>If you used standard SEs and the t-statistic for education was 2.05, would the conclusion change with robust SEs?</p></li>
</ol>
<p><strong>Exercise 5: DFITS Threshold Calculation</strong></p>
<p>In a regression with <span class="math inline">\(k = 7\)</span> regressors and <span class="math inline">\(n = 131\)</span> observations:</p>
<ol type="a">
<li><p>Calculate the DFITS threshold for identifying influential observations.</p></li>
<li><p>If 8 observations exceed this threshold, what percentage of the sample is flagged as potentially influential?</p></li>
<li><p>Describe the steps you would take to investigate these influential observations.</p></li>
</ol>
<p><strong>Exercise 6: Autocorrelation Consequences</strong></p>
<p>A time series regression yields a first-lag residual autocorrelation of <span class="math inline">\(\rho_1 = 0.80\)</span>.</p>
<ol type="a">
<li><p>Is this evidence of autocorrelation? What does it mean for the residual pattern?</p></li>
<li><p>Approximate the factor by which the effective sample size is reduced (use the formula <span class="math inline">\(\frac{1+\rho}{1-\rho}\)</span>).</p></li>
<li><p>A coefficient has a default t-statistic of 4.5. If the HAC standard error is 3 times larger than the default, what is the corrected t-statistic? Is the coefficient still significant at 5%?</p></li>
</ol>
</section>
<section id="case-studies" class="level2">
<h2 class="anchored" data-anchor-id="case-studies">Case Studies</h2>
<section id="case-study-1-regression-diagnostics-for-cross-country-productivity-analysis" class="level3">
<h3 class="anchored" data-anchor-id="case-study-1-regression-diagnostics-for-cross-country-productivity-analysis">Case Study 1: Regression Diagnostics for Cross-Country Productivity Analysis</h3>
<p>In this case study, you will apply the diagnostic techniques from this chapter to analyze cross-country labor productivity using the Mendez convergence clubs dataset.</p>
<p><strong>Dataset:</strong> Mendez (2020) convergence clubs data</p>
<ul>
<li><strong>Source:</strong> <code>https://raw.githubusercontent.com/quarcs-lab/mendez2020-convergence-clubs-code-data/master/assets/dat.csv</code></li>
<li><strong>Sample:</strong> 108 countries, 1990-2014</li>
<li><strong>Variables:</strong> <code>lp</code> (labor productivity), <code>rk</code> (physical capital), <code>hc</code> (human capital), <code>rgdppc</code> (real GDP per capita), <code>tfp</code> (total factor productivity), <code>region</code></li>
</ul>
<p><strong>Research question:</strong> What econometric issues arise when modeling cross-country productivity, and how do diagnostic tools help detect and address them?</p>
<hr>
<section id="task-1-detect-multicollinearity-guided" class="level4">
<h4 class="anchored" data-anchor-id="task-1-detect-multicollinearity-guided">Task 1: Detect Multicollinearity (Guided)</h4>
<p>Load the dataset and estimate a regression of log labor productivity (<code>np.log(lp)</code>) on log physical capital (<code>np.log(rk)</code>), human capital (<code>hc</code>), and log GDP per capita (<code>np.log(rgdppc)</code>), using the year 2014 cross-section.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.formula.api <span class="im">import</span> ols</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.outliers_influence <span class="im">import</span> variance_inflation_factor</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/quarcs-lab/mendez2020-convergence-clubs-code-data/master/assets/dat.csv"</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>dat <span class="op">=</span> pd.read_csv(url)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>dat2014 <span class="op">=</span> dat[dat[<span class="st">'year'</span>] <span class="op">==</span> <span class="dv">2014</span>].copy()</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>dat2014[<span class="st">'ln_lp'</span>] <span class="op">=</span> np.log(dat2014[<span class="st">'lp'</span>])</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>dat2014[<span class="st">'ln_rk'</span>] <span class="op">=</span> np.log(dat2014[<span class="st">'rk'</span>])</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>dat2014[<span class="st">'ln_rgdppc'</span>] <span class="op">=</span> np.log(dat2014[<span class="st">'rgdppc'</span>])</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate the model = ols('ln_lp ~ ln_rk + hc + ln_rgdppc', data=dat2014).fit(cov_type='HC1')</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate VIF</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> dat2014[[<span class="st">'ln_rk'</span>, <span class="st">'hc'</span>, <span class="st">'ln_rgdppc'</span>]].dropna()</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, col <span class="kw">in</span> <span class="bu">enumerate</span>(X.columns):</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"VIF(</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">): </span><span class="sc">{</span>variance_inflation_factor(X.values, i)<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Interpret the VIF values. Is multicollinearity a concern? Which variables are most collinear and why?</p>
<hr>
</section>
<section id="task-2-compare-standard-and-robust-standard-errors-guided" class="level4">
<h4 class="anchored" data-anchor-id="task-2-compare-standard-and-robust-standard-errors-guided">Task 2: Compare Standard and Robust Standard Errors (Guided)</h4>
<p>Estimate the same model with both default and robust (HC1) standard errors. Create a comparison table.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>model_default <span class="op">=</span> ols(<span class="st">'ln_lp ~ ln_rk + hc'</span>, data<span class="op">=</span>dat2014).fit()</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>model_robust <span class="op">=</span> ols(<span class="st">'ln_lp ~ ln_rk + hc'</span>, data<span class="op">=</span>dat2014).fit(cov_type<span class="op">=</span><span class="st">'HC1'</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>comparison <span class="op">=</span> pd. DataFrame({</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Default SE'</span>: model_default.bse,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Robust SE'</span>: model_robust.bse,</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Ratio'</span>: model_robust.bse <span class="op">/</span> model_default.bse</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(comparison)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Is there evidence of heteroskedasticity? Which coefficient‚Äôs inference is most affected?</p>
<hr>
</section>
<section id="task-3-residual-diagnostic-plots-semi-guided" class="level4">
<h4 class="anchored" data-anchor-id="task-3-residual-diagnostic-plots-semi-guided">Task 3: Residual Diagnostic Plots (Semi-guided)</h4>
<p>Create the three diagnostic plots for the productivity model:</p>
<ol type="1">
<li>Actual vs.&nbsp;fitted values with LOWESS smooth</li>
<li>Residuals vs.&nbsp;fitted values with LOWESS smooth</li>
<li>Residuals vs.&nbsp;<code>ln_rk</code> (component-plus-residual plot)</li>
</ol>
<p><em>Hint:</em> Use <code>from statsmodels.nonparametric.smoothers_lowess import lowess</code> for the LOWESS smooth. Plot residuals from the robust model.</p>
<p>What do the diagnostic plots reveal about the model specification?</p>
<hr>
</section>
<section id="task-4-identify-influential-countries-semi-guided" class="level4">
<h4 class="anchored" data-anchor-id="task-4-identify-influential-countries-semi-guided">Task 4: Identify Influential Countries (Semi-guided)</h4>
<p>Calculate DFITS and DFBETAS for the productivity regression. Identify countries that exceed the thresholds.</p>
<p><em>Hint:</em> Use <code>OLSInfluence(model).dffits[0]</code> and <code>OLSInfluence(model).dfbetas</code>. The DFITS threshold is <span class="math inline">\(2\sqrt{k/n}\)</span> and the DFBETAS threshold is <span class="math inline">\(2/\sqrt{n}\)</span>.</p>
<p>Which countries are most influential? Investigate whether removing them changes the key coefficients substantially.</p>
<hr>
</section>
<section id="task-5-regional-heterogeneity-analysis-independent" class="level4">
<h4 class="anchored" data-anchor-id="task-5-regional-heterogeneity-analysis-independent">Task 5: Regional Heterogeneity Analysis (Independent)</h4>
<p>Test whether the relationship between capital and productivity varies across regions:</p>
<ol type="1">
<li>Add region dummy variables and region-capital interactions</li>
<li>Test for heteroskedasticity by comparing default and robust SEs across specifications</li>
<li>Conduct an F-test for joint significance of regional interactions</li>
</ol>
<p>Does allowing for regional heterogeneity improve the model diagnostics?</p>
<hr>
</section>
<section id="task-6-diagnostic-report-independent" class="level4">
<h4 class="anchored" data-anchor-id="task-6-diagnostic-report-independent">Task 6: Diagnostic Report (Independent)</h4>
<p>Write a 200-300 word diagnostic report for the cross-country productivity regression. Your report should:</p>
<ol type="1">
<li>Summarize the multicollinearity assessment (VIF results)</li>
<li>Document the heteroskedasticity evidence (SE comparison)</li>
<li>Describe what the residual plots reveal about model specification</li>
<li>List the most influential countries and their potential impact</li>
<li>Recommend the appropriate standard error type and any model modifications</li>
</ol>
<blockquote class="blockquote">
<p><strong>Key Concept 16.9: Systematic Regression Diagnostics</strong></p>
<p>A complete regression diagnostic workflow includes: (1) check multicollinearity via VIF before interpreting individual coefficients; (2) compare standard and robust SEs to detect heteroskedasticity; (3) examine residual plots for nonlinearity and patterns; (4) identify influential observations with DFITS and DFBETAS; (5) document all findings and report robust results. Always investigate problems rather than mechanically applying fixes.</p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Key Concept 16.10: Cross-Country Regression Challenges</strong></p>
<p>Cross-country regressions face specific diagnostic challenges: multicollinearity among development indicators (GDP, capital, education are highly correlated), heteroskedasticity across countries at different development levels, and influential observations from outlier countries. Using robust standard errors and carefully examining influential cases is essential for credible cross-country analysis.</p>
</blockquote>
<p><strong>What You‚Äôve Learned:</strong> In this case study, you applied the complete diagnostic toolkit to cross-country productivity data. You detected multicollinearity among development indicators, compared standard and robust standard errors, created diagnostic plots, and identified influential countries. These skills ensure that your regression results are reliable and your conclusions are credible.</p>
</section>
</section>
<section id="case-study-2-diagnosing-the-satellite-prediction-model" class="level3">
<h3 class="anchored" data-anchor-id="case-study-2-diagnosing-the-satellite-prediction-model">Case Study 2: Diagnosing the Satellite Prediction Model</h3>
<p><strong>Research Question</strong>: How reliable are the satellite-development regression models we have estimated throughout this textbook? Do they satisfy the standard regression assumptions?</p>
<p><strong>Background</strong>: We have estimated multiple satellite-development regression models throughout this textbook. But how reliable are these models? In this case study, we apply Chapter 16‚Äôs <strong>diagnostic tools</strong> to check for multicollinearity, heteroskedasticity, influential observations, and other model violations.</p>
<p><strong>The Data</strong>: The DS4Bolivia dataset covers 339 Bolivian municipalities with satellite data, development indices, and socioeconomic indicators.</p>
<p><strong>Key Variables</strong>:</p>
<ul>
<li><code>mun</code>: Municipality name</li>
<li><code>dep</code>: Department (administrative region)</li>
<li><code>imds</code>: Municipal Sustainable Development Index (0-100)</li>
<li><code>ln_NTLpc2017</code>: Log nighttime lights per capita (2017)</li>
<li><code>A00</code>, <code>A10</code>, <code>A20</code>, <code>A30</code>, <code>A40</code>: Satellite image embedding dimensions</li>
</ul>
<section id="load-the-ds4bolivia-data" class="level4">
<h4 class="anchored" data-anchor-id="load-the-ds4bolivia-data">Load the DS4Bolivia Data</h4>
<div id="cell-53" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-02-17T13:26:14.464596Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-02-17T13:26:14.464344Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-02-17T13:26:15.631862Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-02-17T13:26:15.631176Z&quot;}}" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the DS4Bolivia dataset</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.formula.api <span class="im">import</span> ols</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.outliers_influence <span class="im">import</span> variance_inflation_factor, OLSInfluence</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>url_bol <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/quarcs-lab/ds4bolivia/master/ds4bolivia_v20250523.csv"</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>bol <span class="op">=</span> pd.read_csv(url_bol)</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Select key variables for this case study</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>key_vars <span class="op">=</span> [<span class="st">'mun'</span>, <span class="st">'dep'</span>, <span class="st">'imds'</span>, <span class="st">'ln_NTLpc2017'</span>, <span class="st">'A00'</span>, <span class="st">'A10'</span>, <span class="st">'A20'</span>, <span class="st">'A30'</span>, <span class="st">'A40'</span>]</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>bol_cs <span class="op">=</span> bol[key_vars].copy().dropna()</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"DS4BOLIVIA: REGRESSION DIAGNOSTICS CASE STUDY"</span>)</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Observations (complete cases): </span><span class="sc">{</span><span class="bu">len</span>(bol_cs)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Key variable summary:"</span>)</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(bol_cs[[<span class="st">'imds'</span>, <span class="st">'ln_NTLpc2017'</span>, <span class="st">'A00'</span>, <span class="st">'A10'</span>, <span class="st">'A20'</span>, <span class="st">'A30'</span>, <span class="st">'A40'</span>]].describe().<span class="bu">round</span>(<span class="dv">3</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[20], line 14</span>
<span class="ansi-green-fg ansi-bold">     12</span> <span style="font-style:italic;color:rgb(95,135,135)"># Select key variables for this case study</span>
<span class="ansi-green-fg ansi-bold">     13</span> key_vars <span style="color:rgb(98,98,98)">=</span> [<span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">mun</span><span style="color:rgb(175,0,0)">'</span>, <span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">dep</span><span style="color:rgb(175,0,0)">'</span>, <span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">imds</span><span style="color:rgb(175,0,0)">'</span>, <span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">ln_NTLpc2017</span><span style="color:rgb(175,0,0)">'</span>, <span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">A00</span><span style="color:rgb(175,0,0)">'</span>, <span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">A10</span><span style="color:rgb(175,0,0)">'</span>, <span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">A20</span><span style="color:rgb(175,0,0)">'</span>, <span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">A30</span><span style="color:rgb(175,0,0)">'</span>, <span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">A40</span><span style="color:rgb(175,0,0)">'</span>]
<span class="ansi-green-fg">---&gt; 14</span> bol_cs <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">bol</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg">key_vars</span><span class="ansi-yellow-bg">]</span><span style="color:rgb(98,98,98)">.</span>copy()<span style="color:rgb(98,98,98)">.</span>dropna()
<span class="ansi-green-fg ansi-bold">     16</span> <span style="color:rgb(0,135,0)">print</span>(<span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">=</span><span style="color:rgb(175,0,0)">"</span> <span style="color:rgb(98,98,98)">*</span> <span style="color:rgb(98,98,98)">70</span>)
<span class="ansi-green-fg ansi-bold">     17</span> <span style="color:rgb(0,135,0)">print</span>(<span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">DS4BOLIVIA: REGRESSION DIAGNOSTICS CASE STUDY</span><span style="color:rgb(175,0,0)">"</span>)

File <span class="ansi-green-fg">~/miniforge3/lib/python3.10/site-packages/pandas/core/frame.py:4096</span>, in <span class="ansi-cyan-fg">DataFrame.__getitem__</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-fg ansi-bold">   4094</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> is_iterator(key):
<span class="ansi-green-fg ansi-bold">   4095</span>         key <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">list</span>(key)
<span class="ansi-green-fg">-&gt; 4096</span>     indexer <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">columns</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_get_indexer_strict</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">key</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">"</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">columns</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">"</span><span class="ansi-yellow-bg">)</span>[<span style="color:rgb(98,98,98)">1</span>]
<span class="ansi-green-fg ansi-bold">   4098</span> <span style="font-style:italic;color:rgb(95,135,135)"># take() does not accept boolean indexers</span>
<span class="ansi-green-fg ansi-bold">   4099</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">getattr</span>(indexer, <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">dtype</span><span style="color:rgb(175,0,0)">"</span>, <span style="font-weight:bold;color:rgb(0,135,0)">None</span>) <span style="color:rgb(98,98,98)">==</span> <span style="color:rgb(0,135,0)">bool</span>:

File <span class="ansi-green-fg">~/miniforge3/lib/python3.10/site-packages/pandas/core/indexes/base.py:6199</span>, in <span class="ansi-cyan-fg">Index._get_indexer_strict</span><span class="ansi-blue-fg">(self, key, axis_name)</span>
<span class="ansi-green-fg ansi-bold">   6196</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg ansi-bold">   6197</span>     keyarr, indexer, new_indexer <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_reindex_non_unique(keyarr)
<span class="ansi-green-fg">-&gt; 6199</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_raise_if_missing</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">keyarr</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">indexer</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">axis_name</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   6201</span> keyarr <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>take(indexer)
<span class="ansi-green-fg ansi-bold">   6202</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">isinstance</span>(key, Index):
<span class="ansi-green-fg ansi-bold">   6203</span>     <span style="font-style:italic;color:rgb(95,135,135)"># GH 42790 - Preserve name from an Index</span>

File <span class="ansi-green-fg">~/miniforge3/lib/python3.10/site-packages/pandas/core/indexes/base.py:6251</span>, in <span class="ansi-cyan-fg">Index._raise_if_missing</span><span class="ansi-blue-fg">(self, key, indexer, axis_name)</span>
<span class="ansi-green-fg ansi-bold">   6248</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span>(<span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">None of [</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>key<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)">] are in the [</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>axis_name<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)">]</span><span style="color:rgb(175,0,0)">"</span>)
<span class="ansi-green-fg ansi-bold">   6250</span> not_found <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">list</span>(ensure_index(key)[missing_mask<span style="color:rgb(98,98,98)">.</span>nonzero()[<span style="color:rgb(98,98,98)">0</span>]]<span style="color:rgb(98,98,98)">.</span>unique())
<span class="ansi-green-fg">-&gt; 6251</span> <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span>(<span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>not_found<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)"> not in index</span><span style="color:rgb(175,0,0)">"</span>)

<span class="ansi-red-fg">KeyError</span>: "['A00', 'A10', 'A20', 'A30', 'A40'] not in index"</pre>
</div>
</div>
</div>
</section>
<section id="task-1-multicollinearity-check-guided" class="level4">
<h4 class="anchored" data-anchor-id="task-1-multicollinearity-check-guided">Task 1: Multicollinearity Check (Guided)</h4>
<p><strong>Objective</strong>: Assess whether satellite predictors suffer from multicollinearity.</p>
<p><strong>Instructions</strong>:</p>
<ol type="1">
<li>Compute the correlation matrix for the predictors (<code>ln_NTLpc2017</code>, <code>A00</code>, <code>A10</code>, <code>A20</code>, <code>A30</code>, <code>A40</code>)</li>
<li>Calculate VIF for each variable using <code>variance_inflation_factor()</code> from statsmodels</li>
<li>Flag variables with VIF &gt; 10</li>
<li>Discuss: Are satellite embeddings multicollinear? Does multicollinearity affect the model‚Äôs predictive power vs.&nbsp;individual coefficient interpretation?</li>
</ol>
<div id="cell-55" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-02-17T13:26:15.634851Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-02-17T13:26:15.634606Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-02-17T13:26:15.637401Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-02-17T13:26:15.636880Z&quot;}}" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here: Multicollinearity diagnostics</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Example structure:</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># predictors = ['ln_NTLpc2017', 'A00', 'A10', 'A20', 'A30', 'A40']</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co"># # Correlation matrix</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co"># print("CORRELATION MATRIX")</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="co"># print(bol_cs[predictors].corr().round(3))</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="co"># # VIF calculation</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co"># X = bol_cs[predictors].copy()</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="co"># X = sm.add_constant(X)</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="co"># print("\nVARIANCE INFLATION FACTORS")</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="co"># for i, col in enumerate(X.columns):</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="co">#     vif = variance_inflation_factor(X.values, i)</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     flag = " *** HIGH" if vif &gt; 10 and col != 'const' else ""</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f"  VIF({col}): {vif:.2f}{flag}")</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<blockquote class="blockquote">
<p><strong>Key Concept 16.11: Multicollinearity in Satellite Features</strong></p>
<p>Satellite embedding dimensions often correlate with each other because they capture <strong>overlapping visual patterns</strong> from the same images. When embeddings A00 and A10 both respond to building density, their collinearity inflates standard errors and makes individual coefficients unstable. The VIF (Variance Inflation Factor) quantifies this: a VIF above 10 signals problematic collinearity. Solutions include dropping redundant features, using principal components, or accepting imprecise individual estimates while maintaining valid joint inference.</p>
</blockquote>
</section>
<section id="task-2-standard-vs-robust-ses-guided" class="level4">
<h4 class="anchored" data-anchor-id="task-2-standard-vs-robust-ses-guided">Task 2: Standard vs Robust SEs (Guided)</h4>
<p><strong>Objective</strong>: Detect heteroskedasticity by comparing default and robust standard errors.</p>
<p><strong>Instructions</strong>:</p>
<ol type="1">
<li>Estimate the full model: <code>imds ~ ln_NTLpc2017 + A00 + A10 + A20 + A30 + A40</code></li>
<li>Compare default (homoskedastic) and HC1 (robust) standard errors</li>
<li>Compute the ratio of robust to default SEs for each coefficient</li>
<li>Discuss: Large differences signal heteroskedasticity. Which coefficients are most affected?</li>
</ol>
<div id="cell-58" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-02-17T13:26:15.640217Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-02-17T13:26:15.639989Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-02-17T13:26:15.642808Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-02-17T13:26:15.642302Z&quot;}}" data-execution_count="22">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here: Compare standard and robust SEs</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Example structure:</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co"># model_default = ols('imds ~ ln_NTLpc2017 + A00 + A10 + A20 + A30 + A40',</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="co">#                     data=bol_cs).fit()</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co"># model_robust = ols('imds ~ ln_NTLpc2017 + A00 + A10 + A20 + A30 + A40',</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="co">#                    data=bol_cs).fit(cov_type='HC1')</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="co"># comparison = pd.DataFrame({</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="co">#     'Default SE': model_default.bse,</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     'Robust SE': model_robust.bse,</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     'Ratio': model_robust.bse / model_default.bse</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="co"># })</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="co"># print("STANDARD ERROR COMPARISON")</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="co"># print(comparison.round(4))</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"\nMean ratio: {(model_robust.bse / model_default.bse).mean():.3f}")</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="task-3-residual-diagnostics-semi-guided" class="level4">
<h4 class="anchored" data-anchor-id="task-3-residual-diagnostics-semi-guided">Task 3: Residual Diagnostics (Semi-guided)</h4>
<p><strong>Objective</strong>: Create diagnostic plots to assess model assumptions visually.</p>
<p><strong>Instructions</strong>:</p>
<ol type="1">
<li>Estimate the model with robust SEs</li>
<li>Create three diagnostic plots:
<ul>
<li><ol type="a">
<li>Fitted values vs.&nbsp;residuals (check for patterns/heteroskedasticity)</li>
</ol></li>
<li><ol start="2" type="a">
<li>Q-Q plot of residuals (check for normality)</li>
</ol></li>
<li><ol start="3" type="a">
<li>Histogram of residuals (check for skewness/outliers)</li>
</ol></li>
</ul></li>
<li>Interpret each plot: What do the patterns reveal about model adequacy?</li>
</ol>
<p><strong>Hint</strong>: Use <code>model.fittedvalues</code> and <code>model.resid</code> for the plots. For the Q-Q plot, use <code>from scipy import stats; stats.probplot(residuals, plot=ax)</code>.</p>
<div id="cell-60" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-02-17T13:26:15.645695Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-02-17T13:26:15.645457Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-02-17T13:26:15.648396Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-02-17T13:26:15.647834Z&quot;}}" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here: Residual diagnostic plots</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Example structure:</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># from scipy import stats</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="co"># model = ols('imds ~ ln_NTLpc2017 + A00 + A10 + A20 + A30 + A40',</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="co">#             data=bol_cs).fit(cov_type='HC1')</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="co"># fig, axes = plt.subplots(1, 3, figsize=(15, 5))</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co"># # (a) Residuals vs Fitted</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="co"># axes[0].scatter(model.fittedvalues, model.resid, alpha=0.4)</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="co"># axes[0].axhline(0, color='red', linestyle='--')</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="co"># axes[0].set_xlabel('Fitted Values')</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="co"># axes[0].set_ylabel('Residuals')</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="co"># axes[0].set_title('Residuals vs Fitted')</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a><span class="co"># # (b) Q-Q Plot</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a><span class="co"># stats.probplot(model.resid, plot=axes[1])</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a><span class="co"># axes[1].set_title('Q-Q Plot of Residuals')</span></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a><span class="co"># # (c) Histogram</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a><span class="co"># axes[2].hist(model.resid, bins=30, edgecolor='black', alpha=0.7)</span></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a><span class="co"># axes[2].set_xlabel('Residuals')</span></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a><span class="co"># axes[2].set_title('Distribution of Residuals')</span></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.tight_layout()</span></span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.show()</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="task-4-influential-municipalities-semi-guided" class="level4">
<h4 class="anchored" data-anchor-id="task-4-influential-municipalities-semi-guided">Task 4: Influential Municipalities (Semi-guided)</h4>
<p><strong>Objective</strong>: Identify municipalities that disproportionately influence the regression results.</p>
<p><strong>Instructions</strong>:</p>
<ol type="1">
<li>Calculate DFITS for all observations</li>
<li>Apply the threshold: <span class="math inline">\(|DFITS| &gt; 2\sqrt{k/n}\)</span> where <span class="math inline">\(k\)</span> = number of parameters and <span class="math inline">\(n\)</span> = sample size</li>
<li>Identify the municipalities that exceed the threshold</li>
<li>Calculate DFBETAS for the key coefficient (<code>ln_NTLpc2017</code>)</li>
<li>Discuss: Are the influential municipalities capital cities or special cases?</li>
</ol>
<p><strong>Hint</strong>: Use <code>OLSInfluence(model)</code> from statsmodels to compute influence measures.</p>
<div id="cell-62" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-02-17T13:26:15.651534Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-02-17T13:26:15.651274Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-02-17T13:26:15.654134Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-02-17T13:26:15.653649Z&quot;}}" data-execution_count="24">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here: Influential observation analysis</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Example structure:</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co"># model = ols('imds ~ ln_NTLpc2017 + A00 + A10 + A20 + A30 + A40',</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="co">#             data=bol_cs).fit()</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co"># infl = OLSInfluence(model)</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="co"># # DFITS</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="co"># dfits_vals = infl.dffits[0]</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="co"># k = len(model.params)</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="co"># n = len(bol_cs)</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="co"># threshold = 2 * np.sqrt(k / n)</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="co"># influential = bol_cs.copy()</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a><span class="co"># influential['dfits'] = dfits_vals</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a><span class="co"># influential_muns = influential[np.abs(influential['dfits']) &gt; threshold]</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"DFITS threshold: {threshold:.4f}")</span></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"Influential municipalities: {len(influential_muns)} out of {n}")</span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a><span class="co"># print("\nInfluential municipalities:")</span></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a><span class="co"># print(influential_muns[['mun', 'dep', 'imds', 'ln_NTLpc2017', 'dfits']]</span></span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a><span class="co">#       .sort_values('dfits', key=abs, ascending=False).to_string(index=False))</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<blockquote class="blockquote">
<p><strong>Key Concept 16.12: Spatial Outliers and Influential Observations</strong></p>
<p>In municipality-level analysis, <strong>capital cities</strong> and special economic zones often appear as influential observations. These municipalities may have unusually high NTL (from concentrated economic activity) or unusual satellite patterns (dense urban cores). A single influential municipality can shift regression coefficients substantially. DFITS and DFBETAS identify such observations, allowing us to assess whether our conclusions depend on a few exceptional cases.</p>
</blockquote>
</section>
<section id="task-5-omitted-variable-analysis-independent" class="level4">
<h4 class="anchored" data-anchor-id="task-5-omitted-variable-analysis-independent">Task 5: Omitted Variable Analysis (Independent)</h4>
<p><strong>Objective</strong>: Assess potential omitted variable bias by adding department controls.</p>
<p><strong>Instructions</strong>:</p>
<ol type="1">
<li>Estimate models with and without department fixed effects (<code>C(dep)</code>)</li>
<li>Compare the satellite coefficients across specifications</li>
<li>Discuss: Do satellite coefficients change when adding department dummies?</li>
<li>What is the direction of potential omitted variable bias?</li>
<li>Consider: What unobserved factors might department dummies capture (geography, climate, policy)?</li>
</ol>
<div id="cell-65" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-02-17T13:26:15.656868Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-02-17T13:26:15.656642Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-02-17T13:26:15.659443Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-02-17T13:26:15.658946Z&quot;}}" data-execution_count="25">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here: Omitted variable analysis</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Example structure:</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># m_no_dept = ols('imds ~ ln_NTLpc2017 + A00 + A10', data=bol_cs).fit(cov_type='HC1')</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co"># m_with_dept = ols('imds ~ ln_NTLpc2017 + A00 + A10 + C(dep)', data=bol_cs).fit(cov_type='HC1')</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="co"># print("WITHOUT department controls:")</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"  NTL coef: {m_no_dept.params['ln_NTLpc2017']:.4f} (SE: {m_no_dept.bse['ln_NTLpc2017']:.4f})")</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"  R¬≤: {m_no_dept.rsquared:.4f}")</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="co"># print("\nWITH department controls:")</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"  NTL coef: {m_with_dept.params['ln_NTLpc2017']:.4f} (SE: {m_with_dept.bse['ln_NTLpc2017']:.4f})")</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"  R¬≤: {m_with_dept.rsquared:.4f}")</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"\nCoefficient change: {m_with_dept.params['ln_NTLpc2017'] - m_no_dept.params['ln_NTLpc2017']:.4f}")</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="task-6-diagnostic-report-independent-1" class="level4">
<h4 class="anchored" data-anchor-id="task-6-diagnostic-report-independent-1">Task 6: Diagnostic Report (Independent)</h4>
<p><strong>Objective</strong>: Write a 200-300 word comprehensive model assessment.</p>
<p><strong>Your report should address</strong>:</p>
<ol type="1">
<li><strong>Multicollinearity</strong>: Summarize VIF results for satellite features. Are any problematic?</li>
<li><strong>Heteroskedasticity</strong>: What does the SE comparison reveal? Should we use robust SEs?</li>
<li><strong>Residual patterns</strong>: What do the diagnostic plots show about model specification?</li>
<li><strong>Influential observations</strong>: Which municipalities are most influential? Do they represent special cases?</li>
<li><strong>Omitted variables</strong>: How do department controls affect the satellite coefficients?</li>
<li><strong>Recommendations</strong>: What corrections or modifications would you recommend for the satellite prediction model?</li>
</ol>
<div id="cell-67" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2026-02-17T13:26:15.662102Z&quot;,&quot;iopub.status.busy&quot;:&quot;2026-02-17T13:26:15.661846Z&quot;,&quot;iopub.status.idle&quot;:&quot;2026-02-17T13:26:15.664475Z&quot;,&quot;shell.execute_reply&quot;:&quot;2026-02-17T13:26:15.663962Z&quot;}}" data-execution_count="26">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here: Additional analysis for the diagnostic report</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="co"># You might want to:</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Create a summary table of diagnostic findings</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Re-estimate the model excluding influential observations</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Compare results with and without corrections</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Summarize key statistics for your report</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="what-youve-learned-from-this-case-study" class="level4">
<h4 class="anchored" data-anchor-id="what-youve-learned-from-this-case-study">What You‚Äôve Learned from This Case Study</h4>
<p>Through this diagnostic analysis of the satellite prediction model, you‚Äôve applied Chapter 16‚Äôs complete toolkit to real geospatial data:</p>
<ul>
<li><strong>Multicollinearity assessment</strong>: Computed VIF for satellite features and identified correlated embeddings</li>
<li><strong>Heteroskedasticity detection</strong>: Compared standard and robust SEs to assess variance assumptions</li>
<li><strong>Residual diagnostics</strong>: Created visual diagnostic plots to check model assumptions</li>
<li><strong>Influence analysis</strong>: Used DFITS and DFBETAS to identify municipalities that drive the results</li>
<li><strong>Omitted variable assessment</strong>: Tested sensitivity of results to department controls</li>
<li><strong>Critical thinking</strong>: Formulated recommendations for improving the satellite prediction model</li>
</ul>
<p><strong>Connection</strong>: In Chapter 17, we move to <em>panel data</em>‚Äîanalyzing how nighttime lights evolve over time across municipalities, using fixed effects to control for time-invariant characteristics.</p>
<hr>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../notebooks_colab/ch15_Regression_with_Transformed_Variables.html" class="pagination-link" aria-label="15. Regression with Transformed Variables">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">15. Regression with Transformed Variables</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../notebooks_colab/ch17_Panel_Data_Time_Series_Data_Causation.html" class="pagination-link" aria-label="17. Panel Data, Time Series Data, Causation">
        <span class="nav-page-text"><span class="chapter-title">17. Panel Data, Time Series Data, Causation</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  /* ‚îÄ‚îÄ Book cover image in right sidebar ‚îÄ‚îÄ */
  var tocNav = document.getElementById('TOC');
  if (tocNav) {
    var coverDiv = document.createElement('div');
    coverDiv.id = 'toc-cover-image';
    var img = document.createElement('img');
    var path = window.location.pathname;
    if (path.indexOf('/notebooks_colab/') !== -1) {
      img.src = '../images/book1cover.jpg';
    } else {
      img.src = 'images/book1cover.jpg';
    }
    img.alt = 'Econometrics Powered by AI';
    coverDiv.appendChild(img);
    tocNav.parentNode.insertBefore(coverDiv, tocNav);
  }

  /* ‚îÄ‚îÄ Mobile TOC: nav bar button + slide-in panel ‚îÄ‚îÄ */
  var toc = document.getElementById('TOC');
  if (!toc) return;
  var tocList = toc.querySelector('ul');
  if (!tocList || tocList.children.length === 0) return;

  /* Create overlay backdrop */
  var overlay = document.createElement('div');
  overlay.className = 'mobile-toc-overlay';

  /* Create slide-in panel */
  var panel = document.createElement('div');
  panel.className = 'mobile-toc-panel';

  /* Panel header with title and close button */
  var header = document.createElement('div');
  header.className = 'mobile-toc-header';
  var title = document.createElement('h3');
  title.textContent = 'On this page';
  var closeBtn = document.createElement('button');
  closeBtn.className = 'mobile-toc-close';
  closeBtn.setAttribute('aria-label', 'Close');
  closeBtn.innerHTML = '\u00d7';
  header.appendChild(title);
  header.appendChild(closeBtn);

  /* Clone TOC content into panel */
  var content = document.createElement('div');
  content.className = 'mobile-toc-content';
  var tocClone = tocList.cloneNode(true);
  tocClone.classList.remove('collapse');
  tocClone.style.display = 'block';
  content.appendChild(tocClone);

  panel.appendChild(header);
  panel.appendChild(content);
  document.body.appendChild(overlay);
  document.body.appendChild(panel);

  /* Toggle functions */
  function openPanel() {
    panel.classList.add('active');
    overlay.classList.add('active');
    document.body.style.overflow = 'hidden';
  }
  function closePanel() {
    panel.classList.remove('active');
    overlay.classList.remove('active');
    document.body.style.overflow = '';
  }

  overlay.addEventListener('click', closePanel);
  closeBtn.addEventListener('click', closePanel);

  /* Close panel when a TOC link is clicked */
  content.querySelectorAll('a').forEach(function(link) {
    link.addEventListener('click', closePanel);
  });

  /* Close on Escape key */
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && panel.classList.contains('active')) {
      closePanel();
    }
  });

  /* Add TOC button to Quarto's secondary nav bar (visible on mobile) */
  var secondaryNav = document.querySelector('.quarto-secondary-nav .container-fluid');
  if (secondaryNav) {
    var tocBtn = document.createElement('button');
    tocBtn.type = 'button';
    tocBtn.className = 'quarto-btn-toggle btn mobile-toc-nav-btn';
    tocBtn.setAttribute('aria-label', 'Table of contents');
    tocBtn.title = 'On this page';
    tocBtn.innerHTML = '<i class="bi bi-list-nested"></i>';
    tocBtn.addEventListener('click', openPanel);
    var sidebarToggle = secondaryNav.querySelector('.quarto-btn-toggle');
    if (sidebarToggle) {
      sidebarToggle.parentNode.insertBefore(tocBtn, sidebarToggle.nextSibling);
    }
  }

  /* ‚îÄ‚îÄ Desktop sidebar toggle buttons (floating chevrons) ‚îÄ‚îÄ */
  if (window.innerWidth >= 992) {
    /* Restore saved states */
    if (localStorage.getItem('left-collapsed') === 'true') {
      document.body.classList.add('left-collapsed');
    }
    if (localStorage.getItem('toc-collapsed') === 'true') {
      document.body.classList.add('toc-collapsed');
    }

    /* Left sidebar toggle */
    var leftBtn = document.createElement('button');
    leftBtn.className = 'sidebar-toggle sidebar-toggle-left';
    leftBtn.setAttribute('aria-label', 'Toggle book navigation');
    leftBtn.title = 'Toggle book navigation';
    leftBtn.innerHTML = '<i class="bi bi-chevron-left"></i>';
    document.body.appendChild(leftBtn);
    leftBtn.addEventListener('click', function() {
      document.body.classList.toggle('left-collapsed');
      localStorage.setItem('left-collapsed', document.body.classList.contains('left-collapsed'));
    });

    /* Right sidebar toggle */
    var rightBtn = document.createElement('button');
    rightBtn.className = 'sidebar-toggle sidebar-toggle-right';
    rightBtn.setAttribute('aria-label', 'Toggle table of contents');
    rightBtn.title = 'Toggle table of contents';
    rightBtn.innerHTML = '<i class="bi bi-chevron-right"></i>';
    document.body.appendChild(rightBtn);
    rightBtn.addEventListener('click', function() {
      document.body.classList.toggle('toc-collapsed');
      localStorage.setItem('toc-collapsed', document.body.classList.contains('toc-collapsed'));
    });
  }
});
</script>




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>