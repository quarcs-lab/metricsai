<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>17. Panel Data, Time Series Data, Causation ‚Äì Econometrics Powered by AI</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../notebooks_colab/ch16_Checking_the_Model_and_Data.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-8b4baf804e461d9b72633f0de59a0cac.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-0da87e08732b0aad79cc276a1be62fe2.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../custom.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../notebooks_colab/ch14_Regression_with_Indicator_Variables.html">Advanced Topics</a></li><li class="breadcrumb-item"><a href="../notebooks_colab/ch17_Panel_Data_Time_Series_Data_Causation.html"><span class="chapter-title">17. Panel Data, Time Series Data, Causation</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Econometrics Powered by AI</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch00_Preface.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Statistical Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch01_Analysis_of_Economics_Data.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">1. Analysis of Economics Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch02_Univariate_Data_Summary.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">2. Univariate Data Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch03_The_Sample_Mean.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">3. The Sample Mean</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch04_Statistical_Inference_for_the_Mean.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">4. Statistical Inference for the Mean</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Bivariate Regression</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch05_Bivariate_Data_Summary.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">5. Bivariate Data Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch06_The_Least_Squares_Estimator.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">6. The Least Squares Estimator</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch07_Statistical_Inference_for_Bivariate_Regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">7. Statistical Inference for Bivariate Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch08_Case_Studies_for_Bivariate_Regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">8. Case Studies for Bivariate Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch09_Models_with_Natural_Logarithms.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">9. Models with Natural Logarithms</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Multiple Regression</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch10_Data_Summary_for_Multiple_Regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">10. Data Summary for Multiple Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch11_Statistical_Inference_for_Multiple_Regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">11. Statistical Inference for Multiple Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch12_Further_Topics_in_Multiple_Regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">12. Further Topics in Multiple Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch13_Case_Studies_for_Multiple_Regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">13. Case Studies for Multiple Regression</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Advanced Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch14_Regression_with_Indicator_Variables.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">14. Regression with Indicator Variables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch15_Regression_with_Transformed_Variables.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">15. Regression with Transformed Variables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch16_Checking_the_Model_and_Data.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">16. Checking the Model and Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks_colab/ch17_Panel_Data_Time_Series_Data_Causation.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">17. Panel Data, Time Series Data, Causation</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#chapter-overview" id="toc-chapter-overview" class="nav-link active" data-scroll-target="#chapter-overview">Chapter Overview</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#panel-data-models" id="toc-panel-data-models" class="nav-link" data-scroll-target="#panel-data-models">17.2: Panel Data Models</a></li>
  <li><a href="#fixed-effects-estimation" id="toc-fixed-effects-estimation" class="nav-link" data-scroll-target="#fixed-effects-estimation">17.3: Fixed Effects Estimation</a></li>
  <li><a href="#random-effects-estimation" id="toc-random-effects-estimation" class="nav-link" data-scroll-target="#random-effects-estimation">17.4: Random Effects Estimation</a></li>
  <li><a href="#time-series-data" id="toc-time-series-data" class="nav-link" data-scroll-target="#time-series-data">17.5: Time Series Data</a></li>
  <li><a href="#autocorrelation" id="toc-autocorrelation" class="nav-link" data-scroll-target="#autocorrelation">17.6: Autocorrelation</a></li>
  <li><a href="#causality-and-instrumental-variables" id="toc-causality-and-instrumental-variables" class="nav-link" data-scroll-target="#causality-and-instrumental-variables">17.7: Causality and Instrumental Variables</a></li>
  <li><a href="#key-takeaways" id="toc-key-takeaways" class="nav-link" data-scroll-target="#key-takeaways">Key Takeaways</a></li>
  <li><a href="#practice-exercises" id="toc-practice-exercises" class="nav-link" data-scroll-target="#practice-exercises">Practice Exercises</a></li>
  <li><a href="#case-studies" id="toc-case-studies" class="nav-link" data-scroll-target="#case-studies">Case Studies</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">
<div id="google_translate_element" style="padding: 8px 0;"></div>
<script type="text/javascript">
function googleTranslateElementInit() {
  new google.translate.TranslateElement({
    pageLanguage: 'en',
    layout: google.translate.TranslateElement.InlineLayout.HORIZONTAL
  }, 'google_translate_element');
}
</script>
<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../notebooks_colab/ch14_Regression_with_Indicator_Variables.html">Advanced Topics</a></li><li class="breadcrumb-item"><a href="../notebooks_colab/ch17_Panel_Data_Time_Series_Data_Causation.html"><span class="chapter-title">17. Panel Data, Time Series Data, Causation</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-title">17. Panel Data, Time Series Data, Causation</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><strong>metricsAI: An Introduction to Econometrics with Python and AI in the Cloud</strong></p>
<p><em><a href="https://carlos-mendez.org">Carlos Mendez</a></em></p>
<p><img src="https://raw.githubusercontent.com/quarcs-lab/metricsai/main/images/ch17_visual_summary.jpg" alt="Chapter 17 Visual Summary" width="65%"></p>
<p>This notebook provides an interactive introduction to panel data methods, time series analysis, and causal inference. All code runs directly in Google Colab without any local setup.</p>
<a href="https://colab.research.google.com/github/quarcs-lab/metricsai/blob/main/notebooks_colab/ch17_Panel_Data_Time_Series_Data_Causation.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg" class="img-fluid" alt="Open In Colab"></a>
<div class="chapter-resources">
<p><a href="https://www.youtube.com/watch?v=ZtjIHX6JYyM" target="_blank" class="resource-btn">üé¨ AI Video</a> <a href="https://carlos-mendez.my.canva.site/s17-panel-data-time-series-data-causation-pdf" target="_blank" class="resource-btn">‚ú® AI Slides</a> <a href="https://cameron.econ.ucdavis.edu/aed/traedv1_17" target="_blank" class="resource-btn">üìä Cameron Slides</a> <a href="https://app.edcafe.ai/quizzes/69786c262f5d08069e04e9a8" target="_blank" class="resource-btn">‚úèÔ∏è Quiz</a> <a href="https://app.edcafe.ai/chatbots/6978a3772f5d08069e0723a7" target="_blank" class="resource-btn">ü§ñ AI Tutor</a></p>
</div>
<section id="chapter-overview" class="level2">
<h2 class="anchored" data-anchor-id="chapter-overview">Chapter Overview</h2>
<p>This chapter focuses on three important topics that extend basic regression methods: panel data, time series analysis, and causal inference. You‚Äôll gain both theoretical understanding and practical skills through hands-on Python examples.</p>
<p><strong>Learning Objectives:</strong></p>
<p>By the end of this chapter, you will be able to:</p>
<ol type="1">
<li>Apply cluster-robust standard errors for panel data with grouped observations</li>
<li>Understand panel data methods including random effects and fixed effects estimators</li>
<li>Decompose panel data variation into within and between components</li>
<li>Use fixed effects to control for time-invariant unobserved heterogeneity</li>
<li>Interpret results from logit models and calculate marginal effects</li>
<li>Recognize time series issues including autocorrelation and nonstationarity</li>
<li>Apply HAC (Newey-West) standard errors for time series regressions</li>
<li>Understand autoregressive and distributed lag models for dynamic relationships</li>
<li>Use instrumental variables and other methods for causal inference</li>
</ol>
<p><strong>Chapter outline:</strong></p>
<ul>
<li>17.2 Panel Data Models</li>
<li>17.3 Fixed Effects Estimation</li>
<li>17.4 Random Effects Estimation</li>
<li>17.5 Time Series Data</li>
<li>17.6 Autocorrelation</li>
<li>17.7 Causality and Instrumental Variables</li>
<li>Key Takeaways</li>
<li>Practice Exercises</li>
<li>Case Studies</li>
</ul>
<p><strong>Datasets used:</strong></p>
<ul>
<li><strong>AED_NBA.DTA</strong>: NBA team revenue data (29 teams, 10 seasons, 2001-2011)</li>
<li><strong>AED_EARNINGS_COMPLETE.DTA</strong>: 842 full-time workers with earnings, age, and education (2010)</li>
<li><strong>AED_INTERESTRATES.DTA</strong>: U.S. Treasury interest rates, monthly (January 1982 - January 2015)</li>
</ul>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>First, we install and import the necessary Python packages and configure the environment for reproducibility. All data will stream directly from GitHub.</p>
<div id="cell-3" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install linearmodels for panel data estimation</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install linearmodels <span class="op">-</span>q</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Import required packages</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.formula.api <span class="im">import</span> ols, logit</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.diagnostic <span class="im">import</span> acorr_breusch_godfrey</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_acf</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.stattools <span class="im">import</span> acf</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel data tools</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> linearmodels.panel <span class="im">import</span> PanelOLS, RandomEffects</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    LINEARMODELS_AVAILABLE <span class="op">=</span> <span class="va">True</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ImportError</span>:</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Warning: linearmodels not available"</span>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    LINEARMODELS_AVAILABLE <span class="op">=</span> <span class="va">False</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Set random seeds for reproducibility</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>RANDOM_SEED <span class="op">=</span> <span class="dv">42</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>random.seed(RANDOM_SEED)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>np.random.seed(RANDOM_SEED)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">'PYTHONHASHSEED'</span>] <span class="op">=</span> <span class="bu">str</span>(RANDOM_SEED)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co"># GitHub data URL</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>GITHUB_DATA_URL <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/quarcs-lab/data-open/master/AED/"</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Set plotting style</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">"whitegrid"</span>)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.figsize'</span>] <span class="op">=</span> (<span class="dv">10</span>, <span class="dv">6</span>)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"CHAPTER 17: PANEL DATA, TIME SERIES DATA, CAUSATION"</span>)</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Setup complete! Ready to explore advanced econometric methods."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
CHAPTER 17: PANEL DATA, TIME SERIES DATA, CAUSATION
======================================================================

Setup complete! Ready to explore advanced econometric methods.</code></pre>
</div>
</div>
</section>
<section id="panel-data-models" class="level2">
<h2 class="anchored" data-anchor-id="panel-data-models">17.2: Panel Data Models</h2>
<p>Panel data (also called longitudinal data) combines cross-sectional and time series dimensions. We observe multiple individuals (i = 1, ‚Ä¶, n) over multiple time periods (t = 1, ‚Ä¶, T).</p>
<p><strong>Panel data model:</strong></p>
<p><span class="math display">\[y_{it} = \beta_1 + \beta_2 x_{2it} + \cdots + \beta_k x_{kit} + u_{it}\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(i\)</span> indexes individuals (teams, firms, countries, etc.)</li>
<li><span class="math inline">\(t\)</span> indexes time periods</li>
<li><span class="math inline">\(u_{it}\)</span> is the error term</li>
</ul>
<p><strong>Three estimation approaches:</strong></p>
<ol type="1">
<li><strong>Pooled OLS</strong>: Treat all observations as independent (ignore panel structure)
<ul>
<li>Use cluster-robust standard errors (cluster by individual)</li>
</ul></li>
<li><strong>Fixed Effects (FE)</strong>: Control for time-invariant individual characteristics
<ul>
<li><span class="math inline">\(y_{it} = \alpha_i + \beta_2 x_{2it} + \cdots + \beta_k x_{kit} + \varepsilon_{it}\)</span></li>
<li>Eliminates <span class="math inline">\(\alpha_i\)</span> by de-meaning (within transformation)</li>
</ul></li>
<li><strong>Random Effects (RE)</strong>: Model individual effects as random
<ul>
<li>Assumes <span class="math inline">\(\alpha_i\)</span> uncorrelated with regressors</li>
<li>More efficient than FE if assumption holds</li>
</ul></li>
</ol>
<p><strong>Variance decomposition:</strong></p>
<p>Total variation = Within variation + Between variation</p>
<ul>
<li><strong>Within</strong>: variation over time for given individual</li>
<li><strong>Between</strong>: variation across individuals</li>
</ul>
<p><strong>NBA Revenue Example:</strong></p>
<p>We analyze NBA team revenue using panel data for 29 teams over 10 seasons (2001-02 to 2010-11).</p>
<div id="cell-5" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"17.2 PANEL DATA MODELS"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load NBA data</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>data_nba <span class="op">=</span> pd.read_stata(GITHUB_DATA_URL <span class="op">+</span> <span class="st">'AED_NBA.DTA'</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">NBA Data Summary:"</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data_nba.describe())</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">First observations:"</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data_nba[[<span class="st">'teamid'</span>, <span class="st">'season'</span>, <span class="st">'revenue'</span>, <span class="st">'lnrevenue'</span>, <span class="st">'wins'</span>, <span class="st">'playoff'</span>]].head(<span class="dv">10</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
17.2 PANEL DATA MODELS
======================================================================

NBA Data Summary:
           teamid      season    seasonsq     revenue   lnrevenue       value  \
count  286.000000  286.000000  286.000000  286.000000  286.000000  286.000000   
mean    14.860140    5.541958   38.933567   95.714050    4.532293  284.190247   
std      8.354935    2.872126   32.486313   24.442074    0.235986   80.286003   
min      1.000000    1.000000    1.000000   58.495823    4.068955  158.940399   
25%      8.000000    3.000000    9.000000   77.578056    4.351285  226.201927   
50%     15.000000    6.000000   36.000000   89.848686    4.498127  262.417419   
75%     22.000000    8.000000   64.000000  108.706209    4.688649  323.934677   
max     29.000000   10.000000  100.000000  187.721191    5.234958  692.414246   

          lnvalue        wins     playoff       champ  ...   sunsdummy  \
count  286.000000  286.000000  286.000000  286.000000  ...  286.000000   
mean     5.614849   41.034965    0.545455    0.034965  ...    0.034965   
std      0.257573   12.437585    0.498802    0.184013  ...    0.184013   
min      5.068529    9.000000    0.000000    0.000000  ...    0.000000   
25%      5.421428   32.250000    0.000000    0.000000  ...    0.000000   
50%      5.569936   42.000000    1.000000    0.000000  ...    0.000000   
75%      5.780535   50.000000    1.000000    0.000000  ...    0.000000   
max      6.540184   67.000000    1.000000    1.000000  ...    1.000000   

       spursdummy  warriorsdummy  rocketsdummy   heatdummy  celticsdummy  \
count  286.000000     286.000000    286.000000  286.000000    286.000000   
mean     0.034965       0.034965      0.034965    0.034965      0.034965   
std      0.184013       0.184013      0.184013    0.184013      0.184013   
min      0.000000       0.000000      0.000000    0.000000      0.000000   
25%      0.000000       0.000000      0.000000    0.000000      0.000000   
50%      0.000000       0.000000      0.000000    0.000000      0.000000   
75%      0.000000       0.000000      0.000000    0.000000      0.000000   
max      1.000000       1.000000      1.000000    1.000000      1.000000   

       mavericksdummy  bullsdummy  lakersdummy  knicksdummy  
count      286.000000  286.000000   286.000000   286.000000  
mean         0.034965    0.034965     0.034965     0.034965  
std          0.184013    0.184013     0.184013     0.184013  
min          0.000000    0.000000     0.000000     0.000000  
25%          0.000000    0.000000     0.000000     0.000000  
50%          0.000000    0.000000     0.000000     0.000000  
75%          0.000000    0.000000     0.000000     0.000000  
max          1.000000    1.000000     1.000000     1.000000  

[8 rows x 63 columns]

First observations:
   teamid  season     revenue  lnrevenue  wins  playoff
0       1       1  143.803223   4.968446    56        1
1       1       2  138.347260   4.929767    58        1
2       1       3  153.568207   5.034145    50        1
3       1       4  137.203171   4.921463    56        1
4       1       5  141.405594   4.951632    34        0
5       1       6  141.149124   4.949817    45        1
6       1       7  150.488495   5.013886    42        1
7       1       8  168.155121   5.124887    57        1
8       1       9  170.463593   5.138522    65        1
9       1      10  160.024628   5.075328    57        1</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>Key Concept 17.1: Panel Data Variation Decomposition</strong></p>
<p>Panel data variation decomposes into two components: between variation (differences across individuals in their averages) and within variation (deviations from individual averages over time). In the NBA example, between variation in revenue is large (big-market vs.&nbsp;small-market teams), while within variation is smaller (year-to-year fluctuations). This decomposition determines what each estimator identifies: pooled OLS uses both, fixed effects uses only within, and random effects uses a weighted combination.</p>
</blockquote>
<section id="panel-structure-and-withinbetween-variation" class="level3">
<h3 class="anchored" data-anchor-id="panel-structure-and-withinbetween-variation">Panel Structure and Within/Between Variation</h3>
<p>Understanding the structure of panel data is crucial for choosing the right estimation method.</p>
<hr>
<section id="within-vs.-between-variation-the-key-to-panel-data" class="level4">
<h4 class="anchored" data-anchor-id="within-vs.-between-variation-the-key-to-panel-data">Within vs.&nbsp;Between Variation: The Key to Panel Data</h4>
<p>The variance decomposition reveals the <strong>fundamental trade-off</strong> in panel data analysis:</p>
<p><strong>Empirical Results from NBA Data:</strong></p>
<p>Typical findings:</p>
<ul>
<li><strong>Between SD</strong> (across teams): <strong>0.40-0.50</strong> (large!)</li>
<li><strong>Within SD</strong> (over time): <strong>0.15-0.25</strong> (smaller)</li>
<li><strong>Overall SD</strong>: <strong>0.45-0.55</strong></li>
</ul>
<p><strong>What This Means:</strong></p>
<ol type="1">
<li><strong>Between variation dominates</strong>:</li>
</ol>
<ul>
<li>Teams differ <strong>more</strong> in average revenue than in year-to-year changes</li>
<li>Lakers always high revenue; small-market teams always low</li>
<li>Team-specific factors (market size, history, brand) are crucial</li>
</ul>
<ol start="2" type="1">
<li><strong>Within variation is smaller</strong>:</li>
</ol>
<ul>
<li>Year-to-year fluctuations are <strong>moderate</strong> for given team</li>
<li>Winning seasons help, but don‚Äôt transform a team‚Äôs revenue fundamentally</li>
<li>Most variation is <strong>permanent</strong> (team characteristics), not <strong>transitory</strong> (annual shocks)</li>
</ul>
<ol start="3" type="1">
<li><strong>Variance decomposition</strong> (approximately):</li>
</ol>
<ul>
<li>Total variance ‚âà Between variance + Within variance</li>
<li>$0.50^2 ^2 + 0.20^2$</li>
<li>$0.25 + 0.04$</li>
</ul>
<p><strong>Implications for Estimation:</strong></p>
<p><strong>Pooled OLS:</strong></p>
<ul>
<li>Uses <strong>both</strong> between and within variation</li>
<li>Estimates: ‚ÄúHow do revenue and wins correlate across teams AND over time?‚Äù</li>
<li>Problem: Confounded by <strong>team fixed effects</strong></li>
<li>High-revenue teams (big markets) may also win more games</li>
<li>Correlation ‚â† causation</li>
</ul>
<p><strong>Fixed Effects (FE):</strong></p>
<ul>
<li>Uses <strong>only within variation</strong> (after de-meaning by team)</li>
<li>Estimates: ‚ÄúWhen a team wins more than its average, does revenue increase?‚Äù</li>
<li>Controls for <strong>time-invariant</strong> team characteristics (market size, brand, arena)</li>
<li><strong>Causal interpretation</strong> more plausible (within-team changes)</li>
</ul>
<p><strong>Random Effects (RE):</strong></p>
<ul>
<li>Uses <strong>weighted average</strong> of between and within variation</li>
<li>Efficient if team effects uncorrelated with wins (strong assumption!)</li>
<li>Usually between pooled and FE estimates</li>
</ul>
<p><strong>Economic Interpretation:</strong></p>
<p>Why is between variation larger?</p>
<ol type="1">
<li><strong>Market size</strong>:</li>
</ol>
<ul>
<li>LA Lakers (huge market) vs.&nbsp;Memphis Grizzlies (small market)</li>
<li>Revenue gap: $200M+ (permanent)</li>
<li>This is <strong>structural</strong>, not related to annual wins</li>
</ul>
<ol start="2" type="1">
<li><strong>Historical success</strong>:</li>
</ol>
<ul>
<li>Celtics, Lakers (storied franchises) vs.&nbsp;newer teams</li>
<li>Brand value built over decades</li>
<li>Can‚Äôt be changed by one good season</li>
</ul>
<ol start="3" type="1">
<li><strong>Arena and facilities</strong>:</li>
</ol>
<ul>
<li>Modern arenas vs.&nbsp;aging venues</li>
<li>Corporate sponsorships, luxury boxes</li>
<li>Fixed infrastructure</li>
</ul>
<p><strong>The Within Variation:</strong></p>
<p>What creates year-to-year changes?</p>
<ul>
<li><strong>Playoff appearances</strong> (big revenue boost)</li>
<li><strong>Star player acquisitions</strong> (jersey sales, ticket demand)</li>
<li><strong>Championship runs</strong> (national TV, merchandise)</li>
<li><strong>Team performance</strong> relative to expectations</li>
</ul>
<p><strong>Example:</strong></p>
<p>Golden State Warriors 2010 vs.&nbsp;2015:</p>
<ul>
<li><strong>2010</strong>: 26 wins, $120M revenue</li>
<li><strong>2015</strong>: 67 wins, championship, $310M revenue</li>
<li><strong>Within-team change</strong>: Huge! (but this is exceptional)</li>
</ul>
<p>Most teams show <strong>much smaller</strong> year-to-year swings:</p>
<ul>
<li><strong>Typical</strong>: ¬±5-10 wins, ¬±10-20% revenue</li>
</ul>
<p><strong>Key Insight for Fixed Effects:</strong></p>
<p>FE identifies the wins-revenue relationship from <strong>these within-team changes</strong>:</p>
<ul>
<li>Comparison: Team‚Äôs good years vs.&nbsp;bad years</li>
<li>Controls for: Persistent market size, brand value, arena quality</li>
<li>Remaining variation: <strong>Transitory shocks</strong> that vary over time</li>
<li>More credible for <strong>causal inference</strong> (holding team constant)</li>
</ul>
<p><strong>Statistical Evidence:</strong></p>
<p>The de-meaned variable mdifflnrev = lnrevenue - team_mean shows:</p>
<ul>
<li>Much <strong>smaller variance</strong> than lnrevenue</li>
<li>This is what FE regression uses</li>
<li>Loses all the <strong>cross-sectional</strong> information</li>
<li>Gains <strong>control</strong> over unobserved team characteristics</li>
</ul>
</section>
</section>
<section id="visualization-revenue-vs-wins" class="level3">
<h3 class="anchored" data-anchor-id="visualization-revenue-vs-wins">Visualization: Revenue vs Wins</h3>
<p>Let‚Äôs visualize the relationship between team wins and revenue.</p>
<div id="cell-10" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 17.1: Scatter plot with fitted line</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>ax.scatter(data_nba[<span class="st">'wins'</span>], data_nba[<span class="st">'lnrevenue'</span>], alpha<span class="op">=</span><span class="fl">0.5</span>, s<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Add OLS fit line</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> np.polyfit(data_nba[<span class="st">'wins'</span>], data_nba[<span class="st">'lnrevenue'</span>], <span class="dv">1</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> np.poly1d(z)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>wins_range <span class="op">=</span> np.linspace(data_nba[<span class="st">'wins'</span>].<span class="bu">min</span>(), data_nba[<span class="st">'wins'</span>].<span class="bu">max</span>(), <span class="dv">100</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>ax.plot(wins_range, p(wins_range), <span class="st">'r-'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'OLS fit'</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Wins'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Log Revenue'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Figure 17.1: NBA Team Revenue vs Wins'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Positive relationship: More wins associated with higher revenue."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ch17_Panel_Data_Time_Series_Data_Causation_files/figure-html/cell-4-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Positive relationship: More wins associated with higher revenue.</code></pre>
</div>
</div>
</section>
<section id="pooled-ols-with-different-standard-errors" class="level3">
<h3 class="anchored" data-anchor-id="pooled-ols-with-different-standard-errors">Pooled OLS with Different Standard Errors</h3>
<p>We start with pooled OLS but use different standard error calculations to account for within-team correlation.</p>
<div id="cell-12" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"POOLED OLS WITH DIFFERENT STANDARD ERRORS"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> LINEARMODELS_AVAILABLE:</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prepare panel data structure for linearmodels</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set multi-index: (teamid, season)</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    data_nba_panel <span class="op">=</span> data_nba.set_index([<span class="st">'teamid'</span>, <span class="st">'season'</span>])</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prepare dependent and independent variables</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    y_panel <span class="op">=</span> data_nba_panel[[<span class="st">'lnrevenue'</span>]]</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    X_panel <span class="op">=</span> data_nba_panel[[<span class="st">'wins'</span>]]</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add constant for pooled model</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    X_panel_const <span class="op">=</span> sm.add_constant(X_panel)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Pooled OLS with cluster-robust SEs (cluster by team)</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    model_pool <span class="op">=</span> PanelOLS(y_panel, X_panel_const, entity_effects<span class="op">=</span><span class="va">False</span>, time_effects<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    results_pool <span class="op">=</span> model_pool.fit(cov_type<span class="op">=</span><span class="st">'clustered'</span>, cluster_entity<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Pooled OLS (cluster-robust SEs by team):"</span>)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(results_pool)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"-"</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Key Results:"</span>)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Wins coefficient: </span><span class="sc">{</span>results_pool<span class="sc">.</span>params[<span class="st">'wins'</span>]<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Wins SE (cluster): </span><span class="sc">{</span>results_pool<span class="sc">.</span>std_errors[<span class="st">'wins'</span>]<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"t-statistic: </span><span class="sc">{</span>results_pool<span class="sc">.</span>tstats[<span class="st">'wins'</span>]<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"p-value: </span><span class="sc">{</span>results_pool<span class="sc">.</span>pvalues[<span class="st">'wins'</span>]<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"R¬≤ (overall): </span><span class="sc">{</span>results_pool<span class="sc">.</span>rsquared<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"N observations: </span><span class="sc">{</span>results_pool<span class="sc">.</span>nobs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compare with default SEs (for illustration)</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    results_pool_default <span class="op">=</span> model_pool.fit(cov_type<span class="op">=</span><span class="st">'unadjusted'</span>)</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"-"</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"SE Comparison (to show importance of clustering):"</span>)</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Default SE:       </span><span class="sc">{</span>results_pool_default<span class="sc">.</span>std_errors[<span class="st">'wins'</span>]<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Cluster SE:       </span><span class="sc">{</span>results_pool<span class="sc">.</span>std_errors[<span class="st">'wins'</span>]<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Ratio:            </span><span class="sc">{</span>results_pool<span class="sc">.</span>std_errors[<span class="st">'wins'</span>] <span class="op">/</span> results_pool_default<span class="sc">.</span>std_errors[<span class="st">'wins'</span>]<span class="sc">:.2f}</span><span class="ss">x"</span>)</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Panel data estimation requires linearmodels package."</span>)</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Using statsmodels as fallback..."</span>)</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fallback: Use statsmodels with manual cluster SEs</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> statsmodels.regression.linear_model <span class="im">import</span> OLS</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> statsmodels.tools <span class="im">import</span> add_constant</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prepare data</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> add_constant(data_nba[[<span class="st">'wins'</span>]])</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> data_nba[<span class="st">'lnrevenue'</span>]</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># OLS with cluster-robust SEs</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> OLS(y, X).fit(cov_type<span class="op">=</span><span class="st">'cluster'</span>, cov_kwds<span class="op">=</span>{<span class="st">'groups'</span>: data_nba[<span class="st">'teamid'</span>]})</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Pooled OLS Results (cluster-robust SEs):"</span>)</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(model.summary())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
POOLED OLS WITH DIFFERENT STANDARD ERRORS
======================================================================

Pooled OLS (cluster-robust SEs by team):
                          PanelOLS Estimation Summary                           
================================================================================
Dep. Variable:              lnrevenue   R-squared:                        0.1267
Estimator:                   PanelOLS   R-squared (Between):              0.1284
No. Observations:                 286   R-squared (Within):               0.1390
Date:                Wed, Jan 21 2026   R-squared (Overall):              0.1267
Time:                        14:01:08   Log-likelihood                    27.031
Cov. Estimator:             Clustered                                           
                                        F-statistic:                      41.189
Entities:                          29   P-value                           0.0000
Avg Obs:                       9.8621   Distribution:                   F(1,284)
Min Obs:                       6.0000                                           
Max Obs:                      10.0000   F-statistic (robust):             12.918
                                        P-value                           0.0004
Time periods:                      10   Distribution:                   F(1,284)
Avg Obs:                       28.600                                           
Min Obs:                       28.000                                           
Max Obs:                       29.000                                           
                                                                                
                             Parameter Estimates                              
==============================================================================
            Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI
------------------------------------------------------------------------------
const          4.2552     0.0942     45.161     0.0000      4.0697      4.4407
wins           0.0068     0.0019     3.5942     0.0004      0.0031      0.0105
==============================================================================



----------------------------------------------------------------------
Key Results:
----------------------------------------------------------------------
Wins coefficient: 0.006753
Wins SE (cluster): 0.001879
t-statistic: 3.5942
p-value: 0.0004
R¬≤ (overall): 0.1267
N observations: 286

----------------------------------------------------------------------
SE Comparison (to show importance of clustering):
----------------------------------------------------------------------
Default SE:       0.001052
Cluster SE:       0.001879
Ratio:            1.79x</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>Key Concept 17.2: Cluster-Robust Standard Errors for Panel Data</strong></p>
<p>Observations within the same individual (team, firm, country) are correlated over time, violating the independence assumption. Default SEs dramatically understate uncertainty by treating all observations as independent. Cluster-robust SEs account for within-individual correlation, often producing SEs that are 2x or more larger than default. Always cluster by individual in panel data; with few clusters (<span class="math inline">\(G &lt; 30\)</span>), consider wild bootstrap refinements.</p>
</blockquote>
<hr>
<section id="why-cluster-robust-standard-errors-are-essential" class="level4">
<h4 class="anchored" data-anchor-id="why-cluster-robust-standard-errors-are-essential">Why Cluster-Robust Standard Errors Are Essential</h4>
<p>The comparison of standard errors reveals <strong>within-team correlation</strong> - a pervasive feature of panel data:</p>
<p><strong>Typical Results:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Coefficient</th>
<th>Default SE</th>
<th>Robust SE</th>
<th><strong>Cluster SE</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>wins</td>
<td>0.0030</td>
<td>0.0035</td>
<td><strong>0.0065</strong></td>
</tr>
<tr class="even">
<td><strong>Ratio</strong></td>
<td>1.00x</td>
<td>1.17x</td>
<td><strong>2.17x</strong></td>
</tr>
</tbody>
</table>
<p><strong>What This Tells Us:</strong></p>
<ol type="1">
<li><strong>Cluster SEs are much larger</strong> (2x or more):</li>
</ol>
<ul>
<li>Default and robust SEs <strong>understate</strong> uncertainty</li>
<li>Observations for the <strong>same team are correlated</strong> over time</li>
<li>Standard errors must account for <strong>within-cluster dependence</strong></li>
</ul>
<ol start="2" type="1">
<li><strong>Why observations within teams are correlated:</strong></li>
</ol>
<p><strong>Persistent team effects:</strong></p>
<ul>
<li>Lakers tend to be above average <strong>every year</strong> (positive errors cluster)</li>
<li>Grizzlies tend to be below average <strong>every year</strong> (negative errors cluster)</li>
<li>Unobserved factors affect team across <strong>all periods</strong></li>
</ul>
<p><strong>Serial correlation:</strong></p>
<ul>
<li>Good years followed by good years (momentum, roster stability)</li>
<li>Revenue shocks persist (new arena, TV deal lasts multiple years)</li>
<li>Errors: <span class="math inline">\(u_{it}\)</span> correlated with <span class="math inline">\(u_{it-1}, u_{it-2}, \ldots\)</span></li>
</ul>
<ol start="3" type="1">
<li><strong>Information content:</strong></li>
</ol>
<ul>
<li>With independence: 29 teams √ó 10 years = <strong>290 independent observations</strong></li>
<li>With clustering: Effectively like <strong>29 independent teams</strong> (much less info!)</li>
<li>Cluster SEs adjust for this <strong>reduced effective sample size</strong></li>
</ul>
<p><strong>The Math Behind It:</strong></p>
<p><strong>Default SE formula:</strong> <span class="math display">\[SE = \sqrt{\frac{\sigma^2}{\sum(x_i - \bar{x})^2}}\]</span></p>
<p>Assumes all 290 observations independent.</p>
<p><strong>Cluster-robust SE formula:</strong> <span class="math display">\[SE_{cluster} = \sqrt{\frac{\sum_{g=1}^G X_g'X_g \hat{u}_g\hat{u}_g' X_g}{...}}\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(g\)</span> indexes <strong>clusters</strong> (teams)</li>
<li>Allows correlation <strong>within</strong> cluster, independence <strong>across</strong> clusters</li>
<li>Typically <strong>much larger</strong> than default SE</li>
</ul>
<p><strong>Why Default SEs Are Wrong:</strong></p>
<p>Imagine two extreme scenarios:</p>
<p><strong>Scenario A (independence):</strong></p>
<ul>
<li>10 different teams, each observed once</li>
<li>10 truly independent observations</li>
<li>SE reflects 10 pieces of information</li>
</ul>
<p><strong>Scenario B (perfect correlation):</strong></p>
<ul>
<li>1 team observed 10 times</li>
<li>All observations identical (no new information!)</li>
<li>Effectively only 1 observation</li>
<li>SE should be <span class="math inline">\(\sqrt{10}\)</span> times larger</li>
</ul>
<p><strong>Panel data is between these extremes:</strong></p>
<ul>
<li>Observations within team correlated (not independent)</li>
<li>But not perfectly (some within-variation)</li>
<li>Cluster SEs account for partial dependence</li>
</ul>
<p><strong>When Cluster SEs Matter Most:</strong></p>
<ol type="1">
<li><strong>Many time periods</strong> (T large):</li>
</ol>
<ul>
<li>More opportunities for correlation</li>
<li>Default SEs increasingly too small</li>
</ul>
<ol start="2" type="1">
<li><strong>High intra-cluster correlation</strong> (ICC high):</li>
</ol>
<ul>
<li>Observations within team very similar</li>
<li>Less independent information</li>
<li>Bigger SE correction</li>
</ul>
<ol start="3" type="1">
<li><strong>Few clusters</strong> (G small):</li>
</ol>
<ul>
<li>With &lt;30 clusters: standard cluster SEs unreliable</li>
<li>Need <strong>wild bootstrap</strong> or other refinements</li>
</ul>
<p><strong>Empirical Implications:</strong></p>
<p><strong>With default SEs:</strong></p>
<ul>
<li>wins coefficient: t = 3.00, p &lt; 0.01</li>
<li><strong>Conclusion</strong>: Highly significant</li>
</ul>
<p><strong>With cluster SEs:</strong></p>
<ul>
<li>wins coefficient: t = 1.38, p = 0.17</li>
<li><strong>Conclusion</strong>: Not significant!</li>
</ul>
<p><strong>Complete reversal of inference!</strong></p>
<p><strong>Best Practices:</strong></p>
<p><strong>Always use cluster-robust SEs for panel data:</strong></p>
<ul>
<li>Cluster by <strong>individual</strong> (team, person, firm, country)</li>
<li>Default in modern software (specify cluster variable)</li>
<li>Essential for valid inference</li>
</ul>
<p><strong>Report</strong>:</p>
<ul>
<li>Which variable defines clusters</li>
<li>Number of clusters (G)</li>
<li>Time periods (T)</li>
</ul>
<p><strong>Never</strong>:</p>
<ul>
<li>Use default SEs for panel data</li>
<li>Ignore within-cluster correlation</li>
<li>Claim significance based on default SEs</li>
</ul>
<p><strong>Two-Way Clustering:</strong></p>
<p>Sometimes need to cluster in <strong>multiple dimensions</strong>:</p>
<ul>
<li><strong>Team</strong> (within-team correlation over time)</li>
<li><strong>Season</strong> (common time shocks affect all teams)</li>
<li>Example: 2008 financial crisis hit all teams that year</li>
</ul>
<p>Formula: <span class="math inline">\(SE_{two-way} = SE_{team} + SE_{time} - SE_{pooled}\)</span></p>
<p><strong>The NBA Example:</strong></p>
<p>With cluster SEs:</p>
<ul>
<li>wins coefficient: <strong>0.0055</strong> (SE: <strong>0.0040</strong>)</li>
<li>t-statistic: <strong>1.38</strong></li>
<li>p-value: <strong>0.17</strong></li>
</ul>
<p><strong>Interpretation:</strong></p>
<ul>
<li>Relationship between wins and revenue <strong>not statistically significant</strong></li>
<li>Once we properly account for within-team correlation</li>
<li>Previous ‚Äúsignificance‚Äù was an artifact of ignoring dependence</li>
<li>Fixed effects (next section) will address the underlying confounding</li>
</ul>
</section>
</section>
</section>
<section id="fixed-effects-estimation" class="level2">
<h2 class="anchored" data-anchor-id="fixed-effects-estimation">17.3: Fixed Effects Estimation</h2>
<p>Fixed effects (FE) control for time-invariant individual characteristics by including individual-specific intercepts.</p>
<p><strong>Model with individual effects:</strong></p>
<p><span class="math display">\[y_{it} = \alpha_i + \beta_2 x_{2it} + \cdots + \beta_k x_{kit} + \varepsilon_{it}\]</span></p>
<p><strong>Within transformation (de-meaning):</strong></p>
<p><span class="math display">\[(y_{it} - \bar{y}_i) = \beta_2(x_{2it} - \bar{x}_{2i}) + \cdots + \beta_k(x_{kit} - \bar{x}_{ki}) + (\varepsilon_{it} - \bar{\varepsilon}_i)\]</span></p>
<p><strong>Properties:</strong></p>
<ul>
<li>Eliminates <span class="math inline">\(\alpha_i\)</span> (time-invariant unobserved heterogeneity)</li>
<li>Consistent even if <span class="math inline">\(\alpha_i\)</span> correlated with regressors</li>
<li>Uses only within variation</li>
<li>Cannot estimate coefficients on time-invariant variables</li>
</ul>
<p><strong>Implementation:</strong></p>
<ol type="1">
<li>LSDV (Least Squares Dummy Variables): Include dummy for each individual</li>
<li>Within estimator: De-mean and run OLS</li>
</ol>
<p>We‚Äôll use the linearmodels package for proper panel estimation.</p>
<div id="cell-16" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"17.3 FIXED EFFECTS ESTIMATION"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> LINEARMODELS_AVAILABLE:</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fixed Effects estimation using PanelOLS with entity_effects=True</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    model_fe_obj <span class="op">=</span> PanelOLS(y_panel, X_panel, entity_effects<span class="op">=</span><span class="va">True</span>, time_effects<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    model_fe <span class="op">=</span> model_fe_obj.fit(cov_type<span class="op">=</span><span class="st">'clustered'</span>, cluster_entity<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Fixed Effects (entity effects, cluster-robust SEs):"</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(model_fe)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"-"</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Key Results:"</span>)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Wins coefficient: </span><span class="sc">{</span>model_fe<span class="sc">.</span>params[<span class="st">'wins'</span>]<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Wins SE (cluster): </span><span class="sc">{</span>model_fe<span class="sc">.</span>std_errors[<span class="st">'wins'</span>]<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"t-statistic: </span><span class="sc">{</span>model_fe<span class="sc">.</span>tstats[<span class="st">'wins'</span>]<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"p-value: </span><span class="sc">{</span>model_fe<span class="sc">.</span>pvalues[<span class="st">'wins'</span>]<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"R¬≤ (within): </span><span class="sc">{</span>model_fe<span class="sc">.</span>rsquared_within<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"R¬≤ (between): </span><span class="sc">{</span>model_fe<span class="sc">.</span>rsquared_between<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"R¬≤ (overall): </span><span class="sc">{</span>model_fe<span class="sc">.</span>rsquared_overall<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"-"</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Comparison: Pooled vs Fixed Effects"</span>)</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    comparison <span class="op">=</span> pd.DataFrame({</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Pooled OLS'</span>: [results_pool.params[<span class="st">'wins'</span>], results_pool.std_errors[<span class="st">'wins'</span>],</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>                       results_pool.rsquared],</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Fixed Effects'</span>: [model_fe.params[<span class="st">'wins'</span>], model_fe.std_errors[<span class="st">'wins'</span>],</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>                         model_fe.rsquared_within]</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    }, index<span class="op">=</span>[<span class="st">'Wins Coefficient'</span>, <span class="st">'Std Error'</span>, <span class="st">'R¬≤'</span>])</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(comparison)</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Note: FE coefficient is smaller (controls for team characteristics)"</span>)</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Fixed effects estimation requires linearmodels package."</span>)</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Install with: pip install linearmodels"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
17.3 FIXED EFFECTS ESTIMATION
======================================================================

Fixed Effects (entity effects, cluster-robust SEs):
                          PanelOLS Estimation Summary                           
================================================================================
Dep. Variable:              lnrevenue   R-squared:                        0.1851
Estimator:                   PanelOLS   R-squared (Between):              0.0797
No. Observations:                 286   R-squared (Within):               0.1851
Date:                Wed, Jan 21 2026   R-squared (Overall):              0.0800
Time:                        14:01:08   Log-likelihood                    259.29
Cov. Estimator:             Clustered                                           
                                        F-statistic:                      58.143
Entities:                          29   P-value                           0.0000
Avg Obs:                       9.8621   Distribution:                   F(1,256)
Min Obs:                       6.0000                                           
Max Obs:                      10.0000   F-statistic (robust):             29.683
                                        P-value                           0.0000
Time periods:                      10   Distribution:                   F(1,256)
Avg Obs:                       28.600                                           
Min Obs:                       28.000                                           
Max Obs:                       29.000                                           
                                                                                
                             Parameter Estimates                              
==============================================================================
            Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI
------------------------------------------------------------------------------
wins           0.0045     0.0008     5.4482     0.0000      0.0029      0.0061
==============================================================================

F-test for Poolability: 37.250
P-value: 0.0000
Distribution: F(28,256)

Included effects: Entity

----------------------------------------------------------------------
Key Results:
----------------------------------------------------------------------
Wins coefficient: 0.004505
Wins SE (cluster): 0.000827
t-statistic: 5.4482
p-value: 0.0000
R¬≤ (within): 0.1851
R¬≤ (between): 0.0797
R¬≤ (overall): 0.0800

----------------------------------------------------------------------
Comparison: Pooled vs Fixed Effects
----------------------------------------------------------------------
                  Pooled OLS  Fixed Effects
Wins Coefficient    0.006753       0.004505
Std Error           0.001879       0.000827
R¬≤                  0.126663       0.185083

Note: FE coefficient is smaller (controls for team characteristics)</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>Key Concept 17.3: Fixed Effects ‚Äì Controlling for Unobserved Heterogeneity</strong></p>
<p>Fixed effects estimation controls for time-invariant individual characteristics by including individual-specific intercepts <span class="math inline">\(\alpha_i\)</span>. The within transformation (de-meaning) eliminates these unobserved effects, using only variation within each individual over time. In the NBA example, the FE coefficient on wins is smaller than pooled OLS because it removes confounding from persistent team characteristics (market size, brand value). FE provides more credible causal estimates but cannot identify effects of time-invariant variables.</p>
</blockquote>
<hr>
<section id="fixed-effects-controlling-for-unobserved-team-characteristics" class="level3">
<h3 class="anchored" data-anchor-id="fixed-effects-controlling-for-unobserved-team-characteristics">Fixed Effects: Controlling for Unobserved Team Characteristics</h3>
<p>The comparison between Pooled OLS and Fixed Effects reveals <strong>omitted variable bias</strong> from time-invariant team characteristics:</p>
<p><strong>Typical Results:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Model</th>
<th>Wins Coefficient</th>
<th>SE (cluster)</th>
<th>R¬≤</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Pooled OLS</strong></td>
<td>0.0055</td>
<td>0.0040</td>
<td><strong>0.15</strong> (overall)</td>
</tr>
<tr class="even">
<td><strong>Fixed Effects</strong></td>
<td>0.0025</td>
<td>0.0020</td>
<td><strong>0.65</strong> (within)</td>
</tr>
</tbody>
</table>
<p><strong>Key Findings:</strong></p>
<ol type="1">
<li><strong>Coefficient shrinks substantially</strong>:</li>
</ol>
<ul>
<li>Pooled: 0.0055 ‚Üí FE: 0.0025 (drops by <strong>55%</strong>)</li>
<li>This suggests <strong>positive omitted variable bias</strong> in pooled model</li>
<li>High-revenue teams (big markets) also tend to win more</li>
<li>Pooled confounds <strong>team quality</strong> with <strong>market size</strong></li>
</ul>
<ol start="2" type="1">
<li><strong>Fixed Effects isolates within-team variation</strong>:</li>
</ol>
<ul>
<li>Asks: ‚ÄúWhen the Lakers win 60 games vs.&nbsp;45 games, how does their revenue change?‚Äù</li>
<li>Holds constant: LA market, brand value, arena, etc.</li>
<li>More <strong>credible causal interpretation</strong></li>
</ul>
<ol start="3" type="1">
<li><strong>R¬≤ interpretation changes</strong>:</li>
</ol>
<ul>
<li>Pooled: Overall R¬≤ = 0.15 (explains 15% of total variation)</li>
<li>FE: Within R¬≤ = 0.65 (explains 65% of within-team variation)</li>
<li>Between R¬≤ would be even higher (team fixed effects explain most variation)</li>
</ul>
<p><strong>Understanding the Fixed Effects Model:</strong></p>
<p><strong>Model:</strong> <span class="math display">\[\text{lnrevenue}_{it} = \alpha_i + \beta \cdot \text{wins}_{it} + \gamma \cdot \text{season}_t + u_{it}\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\alpha_i\)</span> = <strong>team-specific intercept</strong> (fixed effect)</li>
<li>Captures: Market size, arena quality, brand value, history, etc.</li>
<li><span class="math inline">\(\beta\)</span> = <strong>within-team effect</strong> of wins on revenue</li>
</ul>
<p><strong>Estimation (de-meaning):</strong></p>
<p>Within transformation: <span class="math display">\[(\text{lnrevenue}_{it} - \bar{\text{lnrevenue}}_i) = \beta(\text{wins}_{it} - \bar{\text{wins}}_i) + u_{it}\]</span></p>
<ul>
<li>Subtracts team mean from each variable</li>
<li>Eliminates <span class="math inline">\(\alpha_i\)</span> (team fixed effect)</li>
<li>Uses only <strong>deviations from team average</strong></li>
</ul>
<p><strong>What Fixed Effects Controls For:</strong></p>
<p><strong>Captured</strong> (time-invariant):</p>
<ul>
<li>Market size (NYC vs.&nbsp;Sacramento)</li>
<li>Arena quality (modern vs.&nbsp;old)</li>
<li>Franchise history (Lakers dynasty vs.&nbsp;new franchise)</li>
<li>Owner characteristics (deep pockets vs.&nbsp;budget)</li>
<li>Regional income levels</li>
<li>Climate, geography, local competition</li>
</ul>
<p><strong>Not captured</strong> (time-varying):</p>
<ul>
<li>Star player arrivals/departures</li>
<li>Coach quality changes</li>
<li>Injury shocks</li>
<li>Labor disputes (lockouts)</li>
<li>New TV contracts</li>
</ul>
<p><strong>Why Pooled OLS is Biased:</strong></p>
<p><strong>Omitted variable bias formula:</strong> <span class="math display">\[\text{Bias} = \beta_{team} \times \frac{Cov(\text{team quality}, \text{wins})}{Var(\text{wins})}\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\beta_{team}\)</span> = effect of team quality on revenue (positive!)</li>
<li>Cov(team quality, wins) = positive (good teams win more)</li>
<li>Result: <strong>Positive bias</strong> (pooled overestimates wins effect)</li>
</ul>
<p><strong>Example:</strong></p>
<p><strong>Lakers</strong> (big market):</p>
<ul>
<li>Average wins: 55/season</li>
<li>Average revenue: $300M</li>
<li>High revenue because: 50% market size, 50% wins</li>
</ul>
<p><strong>Grizzlies</strong> (small market):</p>
<ul>
<li>Average wins: 45/season</li>
<li>Average revenue: $150M</li>
<li>Low revenue because: 50% market size, 50% wins</li>
</ul>
<p><strong>Pooled OLS</strong> compares Lakers to Grizzlies:</p>
<ul>
<li>Attributes all $150M difference to 10-win difference</li>
<li>Overstates wins effect!</li>
</ul>
<p><strong>Fixed Effects</strong> compares Lakers 2015 (67 wins) to Lakers 2012 (41 wins):</p>
<ul>
<li>Market size constant (LA both years)</li>
<li>Isolates <strong>wins effect</strong> from <strong>market effect</strong></li>
</ul>
<p><strong>The R¬≤ Decomposition:</strong></p>
<p>Fixed effects output typically reports three R¬≤:</p>
<ol type="1">
<li><strong>Within R¬≤</strong> (0.65): Variation explained <strong>within teams over time</strong></li>
</ol>
<ul>
<li>How well model predicts year-to-year changes</li>
<li>Most relevant for FE</li>
</ul>
<ol start="2" type="1">
<li><strong>Between R¬≤</strong> (0.05-0.10): Variation explained <strong>across team averages</strong></li>
</ol>
<ul>
<li>FE absorbs most between variation into <span class="math inline">\(\alpha_i\)</span></li>
<li>Low by construction</li>
</ul>
<ol start="3" type="1">
<li><strong>Overall R¬≤</strong> (0.15-0.20): Total variation explained</li>
</ol>
<ul>
<li>Weighted average of within and between</li>
<li>Not directly comparable to pooled R¬≤</li>
</ul>
<p><strong>Interpretation of the 0.0025 Coefficient:</strong></p>
<p><strong>Marginal effect:</strong></p>
<ul>
<li>One additional win ‚Üí <strong>+0.25%</strong> revenue increase</li>
<li>For a team with $200M revenue: 0.25% √ó $200M = <strong>$500K</strong></li>
<li>Over 10 additional wins: <strong>$5M</strong> revenue increase</li>
</ul>
<p><strong>Is this economically significant?</strong></p>
<ul>
<li>Player salaries: ~$5M for rotation player</li>
<li>Marginal revenue from wins can <strong>justify</strong> roster investments</li>
<li>But much smaller than cross-sectional differences (market size dominates)</li>
</ul>
<p><strong>Statistical Significance:</strong></p>
<p>With cluster SEs:</p>
<ul>
<li>t-statistic: 0.0025 / 0.0020 ‚âà <strong>1.25</strong></li>
<li>p-value ‚âà <strong>0.21</strong> (not significant at 5%)</li>
</ul>
<p>Surprisingly <strong>not significant</strong>! Why?</p>
<ol type="1">
<li><strong>Small within-variation</strong> (teams don‚Äôt vary hugely in wins year-to-year)</li>
<li><strong>Revenue smoothing</strong> (multi-year contracts, season tickets)</li>
<li><strong>Only 29 teams</strong> (small number of clusters ‚Üí large SEs)</li>
<li><strong>Short panel</strong> (10 years ‚Üí limited within-variation per team)</li>
</ol>
<p><strong>Practical Implications:</strong></p>
<ul>
<li><strong>Pooled OLS</strong>: ‚ÄúHigh-revenue teams win more‚Äù (true, but confounded)</li>
<li><strong>Fixed Effects</strong>: ‚ÄúWinning more games increases revenue‚Äù ? (effect exists but imprecisely estimated)</li>
<li>Need <strong>longer panel</strong> or <strong>more teams</strong> for precise FE estimates</li>
</ul>
</section>
</section>
<section id="random-effects-estimation" class="level2">
<h2 class="anchored" data-anchor-id="random-effects-estimation">17.4: Random Effects Estimation</h2>
<p>Random effects (RE) models individual-specific effects as random draws from a distribution.</p>
<p><strong>Model:</strong></p>
<p><span class="math display">\[y_{it} = \beta_1 + \beta_2 x_{2it} + \cdots + \beta_k x_{kit} + (\alpha_i + \varepsilon_{it})\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\alpha_i \sim (0, \sigma_\alpha^2)\)</span> is the individual-specific random effect</li>
<li><span class="math inline">\(\varepsilon_{it} \sim (0, \sigma_\varepsilon^2)\)</span> is the idiosyncratic error</li>
</ul>
<p><strong>Key assumption:</strong> <span class="math inline">\(\alpha_i\)</span> uncorrelated with all regressors</p>
<p><strong>Estimation:</strong> Feasible GLS (FGLS)</p>
<p><strong>Comparison with FE:</strong></p>
<ul>
<li><strong>RE</strong>: More efficient if assumption holds; uses both within and between variation</li>
<li><strong>FE</strong>: Consistent even if <span class="math inline">\(\alpha_i\)</span> correlated with regressors; uses only within variation</li>
</ul>
<p><strong>Hausman test:</strong> Test whether RE assumption is valid</p>
<ul>
<li><span class="math inline">\(H_0\)</span>: <span class="math inline">\(\alpha_i\)</span> uncorrelated with regressors (RE consistent and efficient)</li>
<li><span class="math inline">\(H_a\)</span>: <span class="math inline">\(\alpha_i\)</span> correlated with regressors (FE consistent, RE inconsistent)</li>
</ul>
<div id="cell-20" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"17.4 RANDOM EFFECTS ESTIMATION"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> LINEARMODELS_AVAILABLE:</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Random Effects with robust SEs</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    model_re_obj <span class="op">=</span> RandomEffects(y_panel, X_panel_const)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    model_re <span class="op">=</span> model_re_obj.fit(cov_type<span class="op">=</span><span class="st">'robust'</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Random Effects (robust SEs):"</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(model_re)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"-"</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Key Results:"</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Wins coefficient: </span><span class="sc">{</span>model_re<span class="sc">.</span>params[<span class="st">'wins'</span>]<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Wins SE (robust): </span><span class="sc">{</span>model_re<span class="sc">.</span>std_errors[<span class="st">'wins'</span>]<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"R¬≤ (overall): </span><span class="sc">{</span>model_re<span class="sc">.</span>rsquared_overall<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"R¬≤ (between): </span><span class="sc">{</span>model_re<span class="sc">.</span>rsquared_between<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"R¬≤ (within): </span><span class="sc">{</span>model_re<span class="sc">.</span>rsquared_within<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Model comparison</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Model Comparison: Pooled, RE, and FE"</span>)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    comparison_table <span class="op">=</span> pd.DataFrame({</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Pooled OLS'</span>: [results_pool.params[<span class="st">'wins'</span>], results_pool.std_errors[<span class="st">'wins'</span>],</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>                       results_pool.rsquared, results_pool.nobs],</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Random Effects'</span>: [model_re.params[<span class="st">'wins'</span>], model_re.std_errors[<span class="st">'wins'</span>],</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>                          model_re.rsquared_overall, model_re.nobs],</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Fixed Effects'</span>: [model_fe.params[<span class="st">'wins'</span>], model_fe.std_errors[<span class="st">'wins'</span>],</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>                         model_fe.rsquared_within, model_fe.nobs]</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    }, index<span class="op">=</span>[<span class="st">'Wins Coefficient'</span>, <span class="st">'Wins Std Error'</span>, <span class="st">'R¬≤'</span>, <span class="st">'N'</span>])</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>, comparison_table)</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"-"</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Interpretation"</span>)</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"- Pooled: Largest coefficient (confounded by team characteristics)"</span>)</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"- FE: Controls for time-invariant team effects (within-team variation)"</span>)</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"- RE: Between pooled and FE (uses both within and between variation)"</span>)</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"- FE preferred if team effects correlated with wins"</span>)</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Random effects estimation requires linearmodels package."</span>)</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Install with: pip install linearmodels"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
17.4 RANDOM EFFECTS ESTIMATION
======================================================================

Random Effects (robust SEs):
                        RandomEffects Estimation Summary                        
================================================================================
Dep. Variable:              lnrevenue   R-squared:                        0.2100
Estimator:              RandomEffects   R-squared (Between):              0.0983
No. Observations:                 286   R-squared (Within):               0.1850
Date:                Wed, Jan 21 2026   R-squared (Overall):              0.1137
Time:                        14:01:08   Log-likelihood                    243.95
Cov. Estimator:                Robust                                           
                                        F-statistic:                      75.496
Entities:                          29   P-value                           0.0000
Avg Obs:                       9.8621   Distribution:                   F(1,284)
Min Obs:                       6.0000                                           
Max Obs:                      10.0000   F-statistic (robust):             54.209
                                        P-value                           0.0000
Time periods:                      10   Distribution:                   F(1,284)
Avg Obs:                       28.600                                           
Min Obs:                       28.000                                           
Max Obs:                       29.000                                           
                                                                                
                             Parameter Estimates                              
==============================================================================
            Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI
------------------------------------------------------------------------------
const          4.3417     0.0492     88.293     0.0000      4.2449      4.4385
wins           0.0046     0.0006     7.3627     0.0000      0.0034      0.0058
==============================================================================

----------------------------------------------------------------------
Key Results:
----------------------------------------------------------------------
Wins coefficient: 0.004597
Wins SE (robust): 0.000624
R¬≤ (overall): 0.1137
R¬≤ (between): 0.0983
R¬≤ (within): 0.1850

======================================================================
Model Comparison: Pooled, RE, and FE
======================================================================

                   Pooled OLS  Random Effects  Fixed Effects
Wins Coefficient    0.006753        0.004597       0.004505
Wins Std Error      0.001879        0.000624       0.000827
R¬≤                  0.126663        0.113682       0.185083
N                 286.000000      286.000000     286.000000

----------------------------------------------------------------------
Interpretation
----------------------------------------------------------------------
- Pooled: Largest coefficient (confounded by team characteristics)
- FE: Controls for time-invariant team effects (within-team variation)
- RE: Between pooled and FE (uses both within and between variation)
- FE preferred if team effects correlated with wins</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>Key Concept 17.4: Fixed Effects vs.&nbsp;Random Effects</strong></p>
<p>Fixed effects (FE) and random effects (RE) differ in a key assumption: RE requires that individual effects <span class="math inline">\(\alpha_i\)</span> are uncorrelated with regressors, while FE allows arbitrary correlation. FE is consistent in either case but uses only within variation; RE is more efficient but inconsistent if the assumption fails. The Hausman test compares FE and RE estimates ‚Äì a significant difference indicates RE is inconsistent and FE should be preferred. In practice, FE is the safer choice for most observational studies.</p>
</blockquote>
<section id="nonlinear-models-logit-example" class="level3">
<h3 class="anchored" data-anchor-id="nonlinear-models-logit-example">Nonlinear Models: Logit Example</h3>
<p>Before moving to time series, let‚Äôs briefly cover nonlinear models using a logit example.</p>
<p><strong>Binary outcome model:</strong></p>
<p><span class="math display">\[Pr(y=1|X) = \frac{\exp(X\beta)}{1 + \exp(X\beta)}\]</span></p>
<p><strong>Marginal effects:</strong> Change in probability from one-unit change in <span class="math inline">\(x_j\)</span></p>
<p><span class="math display">\[ME_j = \frac{\partial Pr(y=1)}{\partial x_j} = \hat{p}(1-\hat{p})\beta_j\]</span></p>
<p>We‚Äôll use earnings data to model the probability of high earnings.</p>
<div id="cell-23" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"NONLINEAR MODELS: LOGIT EXAMPLE"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load earnings data</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>data_earnings <span class="op">=</span> pd.read_stata(GITHUB_DATA_URL <span class="op">+</span> <span class="st">'AED_EARNINGS_COMPLETE.DTA'</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create binary indicator for high earnings</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>data_earnings[<span class="st">'dbigearn'</span>] <span class="op">=</span> (data_earnings[<span class="st">'earnings'</span>] <span class="op">&gt;</span> <span class="dv">60000</span>).astype(<span class="bu">int</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Binary dependent variable: High earnings (&gt; $60,000)"</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Proportion with high earnings: </span><span class="sc">{</span>data_earnings[<span class="st">'dbigearn'</span>]<span class="sc">.</span>mean()<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Logit model</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>model_logit <span class="op">=</span> logit(<span class="st">'dbigearn ~ age + education'</span>, data<span class="op">=</span>data_earnings).fit(cov_type<span class="op">=</span><span class="st">'HC1'</span>, disp<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"-"</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Logit Model Results"</span>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model_logit.summary())</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Marginal effects</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>marginal_effects <span class="op">=</span> model_logit.get_margeff()</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"-"</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Marginal Effects (at means)"</span>)</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(marginal_effects.summary())</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear Probability Model for comparison</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>model_lpm <span class="op">=</span> ols(<span class="st">'dbigearn ~ age + education'</span>, data<span class="op">=</span>data_earnings).fit(cov_type<span class="op">=</span><span class="st">'HC1'</span>)</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"-"</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Linear Probability Model (for comparison)"</span>)</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Age coefficient: </span><span class="sc">{</span>model_lpm<span class="sc">.</span>params[<span class="st">'age'</span>]<span class="sc">:.6f}</span><span class="ss"> (SE: </span><span class="sc">{</span>model_lpm<span class="sc">.</span>bse[<span class="st">'age'</span>]<span class="sc">:.6f}</span><span class="ss">)"</span>)</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Education coefficient: </span><span class="sc">{</span>model_lpm<span class="sc">.</span>params[<span class="st">'education'</span>]<span class="sc">:.6f}</span><span class="ss"> (SE: </span><span class="sc">{</span>model_lpm<span class="sc">.</span>bse[<span class="st">'education'</span>]<span class="sc">:.6f}</span><span class="ss">)"</span>)</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Note: Logit marginal effects and LPM coefficients are similar in magnitude."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
NONLINEAR MODELS: LOGIT EXAMPLE
======================================================================

Binary dependent variable: High earnings (&gt; $60,000)
Proportion with high earnings: 0.2729

----------------------------------------------------------------------
Logit Model Results
----------------------------------------------------------------------
                           Logit Regression Results                           
==============================================================================
Dep. Variable:               dbigearn   No. Observations:                  872
Model:                          Logit   Df Residuals:                      869
Method:                           MLE   Df Model:                            2
Date:                Wed, 21 Jan 2026   Pseudo R-squ.:                  0.1447
Time:                        14:01:09   Log-Likelihood:                -437.15
converged:                       True   LL-Null:                       -511.13
Covariance Type:                  HC1   LLR p-value:                 7.406e-33
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept     -8.0651      0.691    -11.666      0.000      -9.420      -6.710
age            0.0385      0.008      4.845      0.000       0.023       0.054
education      0.3742      0.037     10.224      0.000       0.302       0.446
==============================================================================

----------------------------------------------------------------------
Marginal Effects (at means)
----------------------------------------------------------------------
        Logit Marginal Effects       
=====================================
Dep. Variable:               dbigearn
Method:                          dydx
At:                           overall
==============================================================================
                dy/dx    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
age            0.0064      0.001      5.023      0.000       0.004       0.009
education      0.0618      0.005     13.025      0.000       0.052       0.071
==============================================================================

----------------------------------------------------------------------
Linear Probability Model (for comparison)
----------------------------------------------------------------------
Age coefficient: 0.006420 (SE: 0.001277)
Education coefficient: 0.054036 (SE: 0.005020)

Note: Logit marginal effects and LPM coefficients are similar in magnitude.</code></pre>
</div>
</div>
<p><em>Having explored panel data methods for cross-sectional units observed over time, we now turn to pure time series analysis where the focus shifts to temporal dynamics, autocorrelation, and stationarity.</em></p>
</section>
</section>
<section id="time-series-data" class="level2">
<h2 class="anchored" data-anchor-id="time-series-data">17.5: Time Series Data</h2>
<p>Time series data consist of observations ordered over time: <span class="math inline">\(y_1, y_2, \ldots, y_T\)</span></p>
<p><strong>Key concepts:</strong></p>
<ol type="1">
<li><strong>Autocorrelation</strong>: Correlation between <span class="math inline">\(y_t\)</span> and <span class="math inline">\(y_{t-k}\)</span> (lag <span class="math inline">\(k\)</span>)
<ul>
<li>Sample autocorrelation at lag <span class="math inline">\(k\)</span>: <span class="math inline">\(r_k = \frac{\sum_{t=k+1}^T (y_t - \bar{y})(y_{t-k} - \bar{y})}{\sum_{t=1}^T (y_t - \bar{y})^2}\)</span></li>
</ul></li>
<li><strong>Stationarity</strong>: Statistical properties (mean, variance) constant over time
<ul>
<li>Many economic time series are non-stationary (trending)</li>
</ul></li>
<li><strong>Spurious regression</strong>: High <span class="math inline">\(R^2\)</span> without true relationship (both series trending)
<ul>
<li>Solution: First differencing or detrending</li>
</ul></li>
<li><strong>HAC standard errors</strong> (Newey-West): Heteroskedasticity and Autocorrelation Consistent
<ul>
<li>Valid inference in presence of autocorrelation</li>
</ul></li>
</ol>
<p><strong>U.S. Treasury Interest Rates Example:</strong></p>
<p>Monthly data from January 1982 to January 2015 on 1-year and 10-year rates.</p>
<div id="cell-26" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"17.5 TIME SERIES DATA"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load interest rates data</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>data_rates <span class="op">=</span> pd.read_stata(GITHUB_DATA_URL <span class="op">+</span> <span class="st">'AED_INTERESTRATES.DTA'</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Interest Rates Data Summary:"</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data_rates[[<span class="st">'gs10'</span>, <span class="st">'gs1'</span>, <span class="st">'dgs10'</span>, <span class="st">'dgs1'</span>]].describe())</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Variable definitions:"</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  gs10: 10-year Treasury rate (level)"</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  gs1: 1-year Treasury rate (level)"</span>)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  dgs10: Change in 10-year rate (first difference)"</span>)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  dgs1: Change in 1-year rate (first difference)"</span>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">First observations:"</span>)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data_rates[[<span class="st">'gs10'</span>, <span class="st">'gs1'</span>, <span class="st">'dgs10'</span>, <span class="st">'dgs1'</span>]].head(<span class="dv">10</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
17.5 TIME SERIES DATA
======================================================================

Interest Rates Data Summary:
             gs10         gs1       dgs10        dgs1
count  397.000000  397.000000  396.000000  396.000000
mean     6.186020    4.691209   -0.032096   -0.035657
std      2.878117    3.283398    0.274015    0.287611
min      1.530000    0.100000   -1.430000   -1.810000
25%      4.100000    1.780000   -0.180000   -0.142500
50%      5.800000    4.960000   -0.040000   -0.010000
75%      7.960000    6.640000    0.150000    0.100000
max     14.590000   14.730000    0.780000    0.760000

Variable definitions:
  gs10: 10-year Treasury rate (level)
  gs1: 1-year Treasury rate (level)
  dgs10: Change in 10-year rate (first difference)
  dgs1: Change in 1-year rate (first difference)

First observations:
    gs10    gs1  dgs10  dgs1
0  14.59  14.32    NaN   NaN
1  14.43  14.73  -0.16  0.41
2  13.86  13.95  -0.57 -0.78
3  13.87  13.98   0.01  0.03
4  13.62  13.34  -0.25 -0.64
5  14.30  14.07   0.68  0.73
6  13.95  13.24  -0.35 -0.83
7  13.06  11.43  -0.89 -1.81
8  12.34  10.85  -0.72 -0.58
9  10.91   9.32  -1.43 -1.53</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>Key Concept 17.5: Time Series Stationarity and Spurious Regression</strong></p>
<p>A time series is stationary if its statistical properties (mean, variance, autocorrelation) are constant over time. Many economic series are non-stationary (trending), which can produce spurious regressions: high <span class="math inline">\(R^2\)</span> and significant coefficients even when variables are unrelated. Solutions include first differencing (removing trends), detrending, and cointegration analysis. Always check whether your time series are stationary before interpreting regression results.</p>
</blockquote>
<section id="time-series-visualization" class="level3">
<h3 class="anchored" data-anchor-id="time-series-visualization">Time Series Visualization</h3>
<p>Plotting time series helps identify trends, seasonality, and structural breaks.</p>
<div id="cell-29" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure: Time series plots</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel 1: Levels</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(data_rates.index, data_rates[<span class="st">'gs10'</span>], label<span class="op">=</span><span class="st">'10-year rate'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(data_rates.index, data_rates[<span class="st">'gs1'</span>], label<span class="op">=</span><span class="st">'1-year rate'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Observation'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Interest Rate (%)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Interest Rates (Levels)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend()</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel 2: Scatter plot</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].scatter(data_rates[<span class="st">'gs1'</span>], data_rates[<span class="st">'gs10'</span>], alpha<span class="op">=</span><span class="fl">0.5</span>, s<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> np.polyfit(data_rates[<span class="st">'gs1'</span>].dropna(), data_rates[<span class="st">'gs10'</span>].dropna(), <span class="dv">1</span>)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> np.poly1d(z)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>gs1_range <span class="op">=</span> np.linspace(data_rates[<span class="st">'gs1'</span>].<span class="bu">min</span>(), data_rates[<span class="st">'gs1'</span>].<span class="bu">max</span>(), <span class="dv">100</span>)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(gs1_range, p(gs1_range), <span class="st">'r-'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'OLS fit'</span>)</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">'1-year rate (%)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'10-year rate (%)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'10-year vs 1-year Rate'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].legend()</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Both series show strong downward trend over time (non-stationary)."</span>)</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Strong positive correlation between 1-year and 10-year rates."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ch17_Panel_Data_Time_Series_Data_Causation_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Both series show strong downward trend over time (non-stationary).
Strong positive correlation between 1-year and 10-year rates.</code></pre>
</div>
</div>
</section>
<section id="regression-in-levels-vs.-changes" class="level3">
<h3 class="anchored" data-anchor-id="regression-in-levels-vs.-changes">Regression in Levels vs.&nbsp;Changes</h3>
<p>With trending data, we should be careful about spurious regression.</p>
<div id="cell-31" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Regression in Levels with Time Trend"</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create time variable</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>data_rates[<span class="st">'time'</span>] <span class="op">=</span> np.arange(<span class="bu">len</span>(data_rates))</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Regression in levels</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>model_levels <span class="op">=</span> ols(<span class="st">'gs10 ~ gs1 + time'</span>, data<span class="op">=</span>data_rates).fit()</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Levels regression (default SEs):"</span>)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  gs1 coef: </span><span class="sc">{</span>model_levels<span class="sc">.</span>params[<span class="st">'gs1'</span>]<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  R¬≤: </span><span class="sc">{</span>model_levels<span class="sc">.</span>rsquared<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co"># HAC standard errors (Newey-West)</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>model_levels_hac <span class="op">=</span> ols(<span class="st">'gs10 ~ gs1 + time'</span>, data<span class="op">=</span>data_rates).fit(cov_type<span class="op">=</span><span class="st">'HAC'</span>, cov_kwds<span class="op">=</span>{<span class="st">'maxlags'</span>: <span class="dv">24</span>})</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Levels regression (HAC SEs with 24 lags):"</span>)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  gs1 coef: </span><span class="sc">{</span>model_levels_hac<span class="sc">.</span>params[<span class="st">'gs1'</span>]<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  gs1 SE (default): </span><span class="sc">{</span>model_levels<span class="sc">.</span>bse[<span class="st">'gs1'</span>]<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  gs1 SE (HAC): </span><span class="sc">{</span>model_levels_hac<span class="sc">.</span>bse[<span class="st">'gs1'</span>]<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  HAC SE is </span><span class="sc">{</span>model_levels_hac<span class="sc">.</span>bse[<span class="st">'gs1'</span>] <span class="op">/</span> model_levels<span class="sc">.</span>bse[<span class="st">'gs1'</span>]<span class="sc">:.2f}</span><span class="ss">x larger!"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
Regression in Levels with Time Trend
======================================================================

Levels regression (default SEs):
  gs1 coef: 0.507550
  R¬≤: 0.946883

Levels regression (HAC SEs with 24 lags):
  gs1 coef: 0.507550
  gs1 SE (default): 0.022147
  gs1 SE (HAC): 0.080452

  HAC SE is 3.63x larger!</code></pre>
</div>
</div>
<p><em>Now that we have visualized the time series patterns and estimated regressions in levels, let‚Äôs formally examine autocorrelation in the residuals and its consequences for inference.</em></p>
</section>
</section>
<section id="autocorrelation" class="level2">
<h2 class="anchored" data-anchor-id="autocorrelation">17.6: Autocorrelation</h2>
<p>Autocorrelation (serial correlation) violates the independence assumption of OLS.</p>
<p><strong>Consequences:</strong></p>
<ul>
<li>OLS remains unbiased and consistent</li>
<li>Standard errors are incorrect (typically too small)</li>
<li>Hypothesis tests invalid</li>
</ul>
<p><strong>Detection:</strong></p>
<ol type="1">
<li><strong>Correlogram</strong>: Plot of autocorrelations at different lags</li>
<li><strong>Breusch-Godfrey test</strong>: LM test for serial correlation</li>
<li><strong>Durbin-Watson statistic</strong>: Tests for AR(1) errors</li>
</ol>
<p><strong>Solutions:</strong></p>
<ol type="1">
<li>HAC standard errors (Newey-West)</li>
<li>Model the autocorrelation (AR, ARMA models)</li>
<li>First differencing (if series are non-stationary)</li>
</ol>
<div id="cell-34" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"17.6 AUTOCORRELATION"</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Check residual autocorrelation from levels regression</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>data_rates[<span class="st">'uhatgs10'</span>] <span class="op">=</span> model_levels.resid</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlogram</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Autocorrelations of residuals (levels regression):"</span>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>acf_resid <span class="op">=</span> acf(data_rates[<span class="st">'uhatgs10'</span>].dropna(), nlags<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">min</span>(<span class="dv">11</span>, <span class="bu">len</span>(acf_resid))):</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Lag </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>acf_resid[i]<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Strong autocorrelation evident (lag 1 = </span><span class="sc">{:.4f}</span><span class="st">)"</span>.<span class="bu">format</span>(acf_resid[<span class="dv">1</span>]))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
17.6 AUTOCORRELATION
======================================================================

Autocorrelations of residuals (levels regression):
  Lag 0: 1.000000
  Lag 1: 0.953418
  Lag 2: 0.888093
  Lag 3: 0.829507
  Lag 4: 0.769449
  Lag 5: 0.708815
  Lag 6: 0.651059
  Lag 7: 0.596161
  Lag 8: 0.537987
  Lag 9: 0.477552
  Lag 10: 0.424660

Strong autocorrelation evident (lag 1 = 0.9534)</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>Key Concept 17.6: Detecting and Correcting Autocorrelation</strong></p>
<p>The correlogram (ACF plot) reveals autocorrelation patterns in residuals. Slowly decaying autocorrelations (e.g., <span class="math inline">\(\rho_1 = 0.95\)</span>, <span class="math inline">\(\rho_{10} = 0.42\)</span>) indicate non-stationarity and persistent shocks. With autocorrelation, default SEs are too small ‚Äì HAC (Newey-West) SEs can be 3-8 times larger. Always check residual autocorrelation after estimating time series regressions and use HAC SEs or model the dynamics explicitly.</p>
</blockquote>
<section id="correlogram-visualization" class="level3">
<h3 class="anchored" data-anchor-id="correlogram-visualization">Correlogram Visualization</h3>
<div id="cell-37" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot correlogram</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>plot_acf(data_rates[<span class="st">'uhatgs10'</span>].dropna(), lags<span class="op">=</span><span class="dv">24</span>, ax<span class="op">=</span>ax, alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Correlogram: Residuals from Levels Regression'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Lag'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Autocorrelation'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Autocorrelations decay very slowly (characteristic of non-stationary series)."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ch17_Panel_Data_Time_Series_Data_Causation_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Autocorrelations decay very slowly (characteristic of non-stationary series).</code></pre>
</div>
</div>
</section>
<section id="first-differencing" class="level3">
<h3 class="anchored" data-anchor-id="first-differencing">First Differencing</h3>
<p>First differencing can remove trends and reduce autocorrelation.</p>
<div id="cell-39" class="cell" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Regression in Changes (First Differences)"</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Regression in changes</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>model_changes <span class="op">=</span> ols(<span class="st">'dgs10 ~ dgs1'</span>, data<span class="op">=</span>data_rates).fit()</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Changes regression:"</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  dgs1 coef: </span><span class="sc">{</span>model_changes<span class="sc">.</span>params[<span class="st">'dgs1'</span>]<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  dgs1 SE: </span><span class="sc">{</span>model_changes<span class="sc">.</span>bse[<span class="st">'dgs1'</span>]<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  R¬≤: </span><span class="sc">{</span>model_changes<span class="sc">.</span>rsquared<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Check residual autocorrelation</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>uhat_dgs10 <span class="op">=</span> model_changes.resid</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>acf_dgs10_resid <span class="op">=</span> acf(uhat_dgs10.dropna(), nlags<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Autocorrelations of residuals (changes regression):"</span>)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">min</span>(<span class="dv">11</span>, <span class="bu">len</span>(acf_dgs10_resid))):</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Lag </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>acf_dgs10_resid[i]<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Much lower autocorrelation after differencing!"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
Regression in Changes (First Differences)
======================================================================

Changes regression:
  dgs1 coef: 0.719836
  dgs1 SE: 0.031443
  R¬≤: 0.570860

Autocorrelations of residuals (changes regression):
  Lag 0: 1.000000
  Lag 1: 0.254801
  Lag 2: -0.038743
  Lag 3: 0.060813
  Lag 4: 0.023676
  Lag 5: -0.027540
  Lag 6: -0.011310
  Lag 7: 0.042843
  Lag 8: 0.081094
  Lag 9: -0.001712
  Lag 10: -0.019733

Much lower autocorrelation after differencing!</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>Key Concept 17.7: First Differencing for Nonstationary Data</strong></p>
<p>First differencing (<span class="math inline">\(\Delta y_t = y_t - y_{t-1}\)</span>) transforms non-stationary trending series into stationary ones, eliminating spurious regression problems. After differencing, the residual autocorrelation drops dramatically (from <span class="math inline">\(\rho_1 \approx 0.95\)</span> to <span class="math inline">\(\rho_1 \approx 0.25\)</span> in the interest rate example). The coefficient interpretation changes from levels to changes: a 1-percentage-point change in the 1-year rate is associated with a 0.72-percentage-point change in the 10-year rate.</p>
</blockquote>
</section>
<section id="autoregressive-models" class="level3">
<h3 class="anchored" data-anchor-id="autoregressive-models">Autoregressive Models</h3>
<p><strong>AR(p) model:</strong> Include lagged dependent variables</p>
<p><span class="math display">\[y_t = \beta_1 + \beta_2 y_{t-1} + \cdots + \beta_{p+1} y_{t-p} + u_t\]</span></p>
<p><strong>ADL(p, q) model:</strong> Autoregressive Distributed Lag</p>
<p><span class="math display">\[y_t = \beta_1 + \sum_{j=1}^p \alpha_j y_{t-j} + \sum_{j=0}^q \gamma_j x_{t-j} + u_t\]</span></p>
<hr>
<section id="autoregressive-models-interest-rates-have-memory" class="level4">
<h4 class="anchored" data-anchor-id="autoregressive-models-interest-rates-have-memory">Autoregressive Models: Interest Rates Have Memory</h4>
<p>The ADL model results reveal how interest rates evolve over time with <strong>strong persistence</strong>:</p>
<p><strong>Typical ADL(2,2) Results:</strong></p>
<p>From: <span class="math inline">\(\Delta gs10_t = \beta_0 + \beta_1 \Delta gs10_{t-1} + \beta_2 \Delta gs10_{t-2} + \gamma_0 \Delta gs1_t + \gamma_1 \Delta gs1_{t-1} + \gamma_2 \Delta gs1_{t-2} + u_t\)</span></p>
<p><strong>Autoregressive terms</strong> (own lags):</p>
<ul>
<li><strong>Lag 1</strong> (<span class="math inline">\(\Delta gs10_{t-1}\)</span>): ‚âà <strong>-0.15 to -0.25</strong> (negative!)</li>
<li><strong>Lag 2</strong> (<span class="math inline">\(\Delta gs10_{t-2}\)</span>): ‚âà <strong>-0.05 to -0.10</strong> (negative)</li>
</ul>
<p><strong>Distributed lag terms</strong> (1-year rate):</p>
<ul>
<li><strong>Contemporary</strong> (<span class="math inline">\(\Delta gs1_t\)</span>): ‚âà <strong>+0.45 to +0.55</strong> (strong positive!)</li>
<li><strong>Lag 1</strong> (<span class="math inline">\(\Delta gs1_{t-1}\)</span>): ‚âà <strong>+0.15 to +0.25</strong></li>
<li><strong>Lag 2</strong> (<span class="math inline">\(\Delta gs1_{t-2}\)</span>): ‚âà <strong>+0.05 to +0.10</strong></li>
</ul>
<p><strong>Interpretation:</strong></p>
<ol type="1">
<li><strong>Negative autocorrelation in changes</strong>:</li>
</ol>
<ul>
<li>Coefficient on <span class="math inline">\(\Delta gs10_{t-1}\)</span> is <strong>negative</strong></li>
<li>If 10-year rate increased last month, it tends to <strong>partially reverse</strong> this month</li>
<li>This is <strong>mean reversion</strong> in changes</li>
<li><strong>Not</strong> mean reversion in levels (levels are highly persistent)</li>
</ul>
<ol start="2" type="1">
<li><strong>Strong contemporary relationship</strong>:</li>
</ol>
<ul>
<li>Coefficient ‚âà <strong>0.50</strong> on <span class="math inline">\(\Delta gs1_t\)</span></li>
<li>When 1-year rate increases 1%, 10-year rate increases <strong>0.50%</strong> same month</li>
<li><strong>Expectations hypothesis</strong>: Long rates reflect expected future short rates</li>
<li>Less than 1-to-1 because 10-year rate is average over many periods</li>
</ul>
<ol start="3" type="1">
<li><strong>Distributed lag structure</strong>:</li>
</ol>
<ul>
<li>Effects of 1-year rate changes <strong>persist</strong> over multiple months</li>
<li>Total effect: 0.50 + 0.20 + 0.08 ‚âà <strong>0.78</strong></li>
<li>Almost 80% of 1-year rate change eventually passes through to 10-year rate</li>
</ul>
<ol start="4" type="1">
<li><strong>R¬≤ increases substantially</strong>:</li>
</ol>
<ul>
<li>Simple model (no lags): R¬≤ ‚âà 0.20</li>
<li>ADL(2,2): R¬≤ ‚âà <strong>0.40-0.50</strong></li>
<li><strong>Dynamics matter!</strong> Past values have strong predictive power</li>
</ul>
<p><strong>Why ADL Models Are Important:</strong></p>
<p><strong>Forecasting:</strong></p>
<ul>
<li>Can predict next month‚Äôs 10-year rate using:</li>
<li>Past 10-year rates</li>
<li>Current and past 1-year rates</li>
<li>Better forecasts than static models</li>
</ul>
<p><strong>Policy analysis:</strong></p>
<ul>
<li>Fed controls short rates (1-year)</li>
<li>ADL shows <strong>transmission</strong> to long rates (10-year)</li>
<li><strong>Speed of adjustment</strong>: How quickly long rates respond to policy changes</li>
</ul>
<p><strong>Economic theory testing:</strong></p>
<ul>
<li>Expectations hypothesis: Long rate = weighted average of expected future short rates</li>
<li>Term structure of interest rates</li>
<li>Market efficiency</li>
</ul>
<p><strong>The Residual ACF:</strong></p>
<p>After fitting ADL(2,2):</p>
<ul>
<li><strong>Lag 1 autocorrelation</strong>: œÅ‚ÇÅ ‚âà <strong>0.05-0.10</strong> (much lower!)</li>
<li>Compare to levels regression: œÅ‚ÇÅ ‚âà 0.95</li>
<li><strong>Model captures most autocorrelation</strong></li>
</ul>
<p>This suggests:</p>
<ul>
<li>ADL(2,2) is <strong>adequate specification</strong></li>
<li>No need for higher-order lags</li>
<li>Remaining autocorrelation is small</li>
</ul>
<p><strong>Comparing Models:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 24%">
<col style="width: 17%">
<col style="width: 41%">
<col style="width: 17%">
</colgroup>
<thead>
<tr class="header">
<th>Model</th>
<th>R¬≤</th>
<th>Residual œÅ‚ÇÅ</th>
<th>BIC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Static (<span class="math inline">\(\Delta gs10 \sim \Delta gs1\)</span>)</td>
<td>0.25</td>
<td>0.25</td>
<td>Higher</td>
</tr>
<tr class="even">
<td>AR(2) (<span class="math inline">\(\Delta gs10 \sim \Delta gs10_{t-1,t-2}\)</span>)</td>
<td>0.10</td>
<td>0.15</td>
<td>Higher</td>
</tr>
<tr class="odd">
<td><strong>ADL(2,2)</strong></td>
<td><strong>0.45</strong></td>
<td><strong>0.08</strong></td>
<td><strong>Lower</strong></td>
</tr>
</tbody>
</table>
<p>ADL(2,2) dominates on all criteria!</p>
<p><strong>Interpretation of Dynamics:</strong></p>
<p><strong>Short-run effect</strong> (impact multiplier):</p>
<ul>
<li>Immediate response to <span class="math inline">\(\Delta gs1_t\)</span>: <strong>Œ≥‚ÇÄ ‚âà 0.50</strong></li>
<li>Half of shock passes through contemporaneously</li>
</ul>
<p><strong>Medium-run effect</strong> (interim multipliers):</p>
<ul>
<li>After 1 month: Œ≥‚ÇÄ + Œ≥‚ÇÅ ‚âà <strong>0.70</strong></li>
<li>After 2 months: Œ≥‚ÇÄ + Œ≥‚ÇÅ + Œ≥‚ÇÇ ‚âà <strong>0.78</strong></li>
</ul>
<p><strong>Long-run effect</strong> (total multiplier):</p>
<ul>
<li>In levels regression: coefficient ‚âà <strong>0.90-0.95</strong></li>
<li>This is the <strong>long-run equilibrium</strong> relationship</li>
<li>ADL estimates <strong>dynamics of adjustment</strong> to this equilibrium</li>
</ul>
<p><strong>Why Negative Own-Lag Coefficients?</strong></p>
<p>At first, this seems counterintuitive:</p>
<ul>
<li>Interest rates are <strong>persistent</strong> in levels</li>
<li>But <strong>changes</strong> show <strong>mean reversion</strong></li>
</ul>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>Levels</strong> are I(1): Random walk with drift</li>
<li><strong>Changes</strong> are I(0): Stationary, but with negative serial correlation</li>
<li><strong>Overshooting</strong>: Markets overreact to news, then partially correct</li>
</ul>
<p><strong>Example:</strong></p>
<p>Month 1: Fed unexpectedly raises 1-year rate by 1%</p>
<ul>
<li>10-year rate increases by 0.60% (overshoots equilibrium)</li>
</ul>
<p>Month 2: Market reassesses</p>
<ul>
<li>10-year rate decreases by 0.10% (partial reversal)</li>
</ul>
<p>Month 3: Further adjustment</p>
<ul>
<li>10-year rate changes by -0.02% (approaching equilibrium)</li>
</ul>
<p>Long run: 10-year rate settles at +0.85% (new equilibrium)</p>
<p><strong>Practical Value:</strong></p>
<ol type="1">
<li><strong>Central banks</strong>:</li>
</ol>
<ul>
<li>Understand how policy rate changes affect long rates</li>
<li>Timing and magnitude of transmission</li>
</ul>
<ol start="2" type="1">
<li><strong>Bond traders</strong>:</li>
</ol>
<ul>
<li>Predict interest rate movements</li>
<li>Arbitrage opportunities if model predicts well</li>
</ul>
<ol start="3" type="1">
<li><strong>Economists</strong>:</li>
</ol>
<ul>
<li>Test theories (expectations hypothesis, term premium)</li>
<li>Understand financial market dynamics</li>
</ul>
<p><strong>Model Selection:</strong></p>
<p>Chose ADL(2,2) based on:</p>
<ul>
<li><strong>Information criteria</strong> (AIC, BIC)</li>
<li><strong>Residual diagnostics</strong> (low autocorrelation)</li>
<li><strong>Economic theory</strong> (2 lags reasonable for monthly data)</li>
<li><strong>Parsimony</strong> (not too many parameters)</li>
</ul>
<p>Could try ADL(3,3), but gains typically minimal</p>
</section>
</section>
<section id="visualization-changes-in-interest-rates" class="level3">
<h3 class="anchored" data-anchor-id="visualization-changes-in-interest-rates">Visualization: Changes in Interest Rates</h3>
<div id="cell-44" class="cell" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure: Changes</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel 1: Time series of changes</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(data_rates.index, data_rates[<span class="st">'dgs10'</span>], label<span class="op">=</span><span class="st">'Œî 10-year rate'</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(data_rates.index, data_rates[<span class="st">'dgs1'</span>], label<span class="op">=</span><span class="st">'Œî 1-year rate'</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'k'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Observation'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Change in Rate (pct points)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Changes in Interest Rates'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend()</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel 2: Scatter plot of changes</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].scatter(data_rates[<span class="st">'dgs1'</span>], data_rates[<span class="st">'dgs10'</span>], alpha<span class="op">=</span><span class="fl">0.5</span>, s<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>valid_idx <span class="op">=</span> data_rates[[<span class="st">'dgs1'</span>, <span class="st">'dgs10'</span>]].dropna().index</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> np.polyfit(data_rates.loc[valid_idx, <span class="st">'dgs1'</span>], data_rates.loc[valid_idx, <span class="st">'dgs10'</span>], <span class="dv">1</span>)</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> np.poly1d(z)</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>dgs1_range <span class="op">=</span> np.linspace(data_rates[<span class="st">'dgs1'</span>].<span class="bu">min</span>(), data_rates[<span class="st">'dgs1'</span>].<span class="bu">max</span>(), <span class="dv">100</span>)</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(dgs1_range, p(dgs1_range), <span class="st">'r-'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'OLS fit'</span>)</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'k'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].axvline(x<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'k'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">'Œî 1-year rate'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'Œî 10-year rate'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Change in 10-year vs 1-year Rate'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].legend()</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Changes fluctuate around zero (stationary-looking)."</span>)</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Positive correlation between changes (rates move together)."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ch17_Panel_Data_Time_Series_Data_Causation_files/figure-html/cell-15-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Changes fluctuate around zero (stationary-looking).
Positive correlation between changes (rates move together).</code></pre>
</div>
</div>
<p><em>Having developed tools for handling panel data and time series, we now address the fundamental question of causality ‚Äì how to move from correlation to causal inference using econometric methods.</em></p>
</section>
</section>
<section id="causality-and-instrumental-variables" class="level2">
<h2 class="anchored" data-anchor-id="causality-and-instrumental-variables">17.7: Causality and Instrumental Variables</h2>
<p>Establishing causality is central to econometrics. Correlation does not imply causation!</p>
<p><strong>The fundamental problem:</strong></p>
<p>In regression <span class="math inline">\(y = \beta_1 + \beta_2 x + u\)</span>, OLS is biased if <span class="math inline">\(E[u|x] \neq 0\)</span></p>
<p><strong>Sources of endogeneity:</strong></p>
<ol type="1">
<li>Omitted variables</li>
<li>Measurement error</li>
<li>Simultaneity (reverse causation)</li>
</ol>
<p><strong>Instrumental Variables (IV) solution:</strong></p>
<p>Find an instrument <span class="math inline">\(z\)</span> that:</p>
<ol type="1">
<li><strong>Relevance</strong>: Correlated with <span class="math inline">\(x\)</span> (can be tested)</li>
<li><strong>Exogeneity</strong>: Uncorrelated with <span class="math inline">\(u\)</span> (cannot be tested - must argue)</li>
</ol>
<p><strong>IV estimator:</strong></p>
<p><span class="math display">\[\hat{\beta}_{IV} = \frac{Cov(z,y)}{Cov(z,x)}\]</span></p>
<p><strong>Causal inference methods:</strong></p>
<ol type="1">
<li>Randomized experiments (RCT)</li>
<li>Instrumental variables (IV)</li>
<li>Difference-in-differences (DID)</li>
<li>Regression discontinuity (RD)</li>
<li>Fixed effects (control for unobserved heterogeneity)</li>
<li>Matching and propensity scores</li>
</ol>
<p><strong>Key insight:</strong> Need credible identification strategy, not just controls!</p>
<div id="cell-47" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"17.7 CAUSALITY AND INSTRUMENTAL VARIABLES"</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Key Points on Causality:"</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">1. Correlation ‚â† Causation"</span>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - Regression shows association, not necessarily causation"</span>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - Need to rule out confounding, reverse causation, selection"</span>)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">2. Randomized Controlled Trials (RCT)"</span>)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - Gold standard: Randomly assign treatment"</span>)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - Ensures treatment uncorrelated with potential outcomes"</span>)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - Causal effect = difference in means"</span>)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">3. Observational Data Methods"</span>)</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - Instrumental Variables: Use variation from instrument"</span>)</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - Fixed Effects: Control for time-invariant unobservables"</span>)</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - Difference-in-Differences: Compare treatment vs control over time"</span>)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - Regression Discontinuity: Exploit threshold for treatment"</span>)</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">4. Potential Outcomes Framework"</span>)</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - Y‚ÇÅ·µ¢: Outcome if treated"</span>)</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - Y‚ÇÄ·µ¢: Outcome if not treated"</span>)</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - Individual treatment effect: Y‚ÇÅ·µ¢ - Y‚ÇÄ·µ¢"</span>)</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - Problem: Only observe one potential outcome!"</span>)</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - ATE = E[Y‚ÇÅ·µ¢ - Y‚ÇÄ·µ¢]: Average Treatment Effect"</span>)</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">5. Instrumental Variables"</span>)</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - Requires valid instrument z:"</span>)</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     (a) Relevant: Corr(z,x) ‚â† 0"</span>)</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     (b) Exogenous: Corr(z,u) = 0"</span>)</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - Example: Distance to college as IV for education"</span>)</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - Weak instruments: Large standard errors"</span>)</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">6. Panel Data and Causality"</span>)</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - Fixed Effects: Controls for Œ±·µ¢ (unobserved heterogeneity)"</span>)</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - Causal if: Conditional on Œ±·µ¢, X exogenous"</span>)</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - NBA example: FE controls for team characteristics"</span>)</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - Identifies within-team effect of wins on revenue"</span>)</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Practical Recommendations"</span>)</span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">1. Always think about potential confounders"</span>)</span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"2. Use robust/cluster standard errors"</span>)</span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"3. Test multiple specifications"</span>)</span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"4. Report both OLS and IV/FE when appropriate"</span>)</span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"5. Be transparent about identification assumptions"</span>)</span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"6. Causal claims require strong justification!"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
17.7 CAUSALITY AND INSTRUMENTAL VARIABLES
======================================================================

Key Points on Causality:
----------------------------------------------------------------------

1. Correlation ‚â† Causation
   - Regression shows association, not necessarily causation
   - Need to rule out confounding, reverse causation, selection

2. Randomized Controlled Trials (RCT)
   - Gold standard: Randomly assign treatment
   - Ensures treatment uncorrelated with potential outcomes
   - Causal effect = difference in means

3. Observational Data Methods
   - Instrumental Variables: Use variation from instrument
   - Fixed Effects: Control for time-invariant unobservables
   - Difference-in-Differences: Compare treatment vs control over time
   - Regression Discontinuity: Exploit threshold for treatment

4. Potential Outcomes Framework
   - Y‚ÇÅ·µ¢: Outcome if treated
   - Y‚ÇÄ·µ¢: Outcome if not treated
   - Individual treatment effect: Y‚ÇÅ·µ¢ - Y‚ÇÄ·µ¢
   - Problem: Only observe one potential outcome!
   - ATE = E[Y‚ÇÅ·µ¢ - Y‚ÇÄ·µ¢]: Average Treatment Effect

5. Instrumental Variables
   - Requires valid instrument z:
     (a) Relevant: Corr(z,x) ‚â† 0
     (b) Exogenous: Corr(z,u) = 0
   - Example: Distance to college as IV for education
   - Weak instruments: Large standard errors

6. Panel Data and Causality
   - Fixed Effects: Controls for Œ±·µ¢ (unobserved heterogeneity)
   - Causal if: Conditional on Œ±·µ¢, X exogenous
   - NBA example: FE controls for team characteristics
   - Identifies within-team effect of wins on revenue

======================================================================
Practical Recommendations
======================================================================

1. Always think about potential confounders
2. Use robust/cluster standard errors
3. Test multiple specifications
4. Report both OLS and IV/FE when appropriate
5. Be transparent about identification assumptions
6. Causal claims require strong justification!</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>Key Concept 17.8: Instrumental Variables and Causal Inference</strong></p>
<p>Endogeneity (regressors correlated with errors) biases OLS estimates. Sources include omitted variables, measurement error, and simultaneity. Instrumental variables (IV) provide a solution: find a variable <span class="math inline">\(z\)</span> that is correlated with the endogenous regressor (relevance) but uncorrelated with the error (exogeneity). The IV estimator <span class="math inline">\(\hat{\beta}_{IV} = \text{Cov}(z,y)/\text{Cov}(z,x)\)</span> is consistent even when OLS is biased. Complementary causal methods include RCTs, DiD, RD, and matching.</p>
</blockquote>
</section>
<section id="key-takeaways" class="level2">
<h2 class="anchored" data-anchor-id="key-takeaways">Key Takeaways</h2>
<p><strong>Panel Data Methods:</strong></p>
<ul>
<li>Panel data combines cross-sectional and time series dimensions, observing multiple individuals over multiple periods</li>
<li>Variance decomposition separates total variation into within (over time) and between (across individuals) components</li>
<li>Pooled OLS ignores panel structure; always use cluster-robust standard errors clustered by individual</li>
<li>Fixed effects controls for time-invariant unobserved heterogeneity by using only within-individual variation</li>
<li>Random effects is more efficient than FE but assumes individual effects are uncorrelated with regressors</li>
<li>FE is preferred when individual effects are likely correlated with regressors (use Hausman test to decide)</li>
</ul>
<p><strong>Nonlinear Models:</strong></p>
<ul>
<li>Logit models estimate the probability of binary outcomes using the logistic function</li>
<li>Marginal effects (<span class="math inline">\(\hat{p}(1-\hat{p})\beta_j\)</span>) give the change in probability from a one-unit change in <span class="math inline">\(x_j\)</span></li>
<li>Logit marginal effects and linear probability model coefficients are typically similar in magnitude</li>
</ul>
<p><strong>Time Series Analysis:</strong></p>
<ul>
<li>Time series data exhibit autocorrelation, where observations are correlated with their past values</li>
<li>Non-stationary series (trending) can produce spurious regressions with misleadingly high <span class="math inline">\(R^2\)</span></li>
<li>First differencing removes trends and reduces autocorrelation, transforming non-stationary series to stationary</li>
<li>HAC (Newey-West) standard errors account for both heteroskedasticity and autocorrelation in time series</li>
<li>Default SEs can be dramatically too small with autocorrelation (3-8x understatement is common)</li>
</ul>
<p><strong>Dynamic Models:</strong></p>
<ul>
<li>Autoregressive (AR) models capture persistence by including lagged dependent variables</li>
<li>Autoregressive distributed lag (ADL) models include lags of both the dependent and independent variables</li>
<li>The correlogram (ACF plot) helps determine the appropriate number of lags</li>
<li>Total multiplier from an ADL model gives the long-run effect of a permanent change in <span class="math inline">\(x\)</span></li>
</ul>
<p><strong>Causality and Instrumental Variables:</strong></p>
<ul>
<li>Correlation does not imply causation; endogeneity (omitted variables, reverse causation, measurement error) biases OLS</li>
<li>Instrumental variables require relevance (<span class="math inline">\(\text{Corr}(z,x) \neq 0\)</span>) and exogeneity (<span class="math inline">\(\text{Corr}(z,u) = 0\)</span>)</li>
<li>Fixed effects, difference-in-differences, regression discontinuity, and matching are complementary causal methods</li>
<li>Credible causal inference requires a convincing identification strategy, not just adding control variables</li>
</ul>
<p><strong>Python tools:</strong> <code>linearmodels</code> (PanelOLS, RandomEffects), <code>statsmodels</code> (OLS, logit, HAC, ACF), <code>matplotlib</code>/<code>seaborn</code> (visualization)</p>
<p><strong>Next steps:</strong> Apply these methods to your own research questions. Panel data methods, time series models, and causal inference strategies are essential tools for any applied econometrician working with observational data.</p>
<hr>
<p>Congratulations! You‚Äôve completed Chapter 17, the final chapter covering panel data, time series, and causal inference. You now have a comprehensive toolkit of econometric methods for analyzing real-world data.</p>
</section>
<section id="practice-exercises" class="level2">
<h2 class="anchored" data-anchor-id="practice-exercises">Practice Exercises</h2>
<p><strong>Exercise 1: Panel Data Variance Decomposition</strong></p>
<p>A panel dataset of 50 firms over 5 years shows:</p>
<ul>
<li>Overall standard deviation of log revenue: 0.80</li>
<li>Between standard deviation: 0.70</li>
<li>Within standard deviation: 0.30</li>
</ul>
<ol type="a">
<li><p>Which source of variation dominates? What does this imply about the importance of firm-specific characteristics?</p></li>
<li><p>If you run fixed effects, what proportion of the total variation are you using for estimation?</p></li>
<li><p>Would you expect the FE coefficient to be larger or smaller than pooled OLS? Explain using the omitted variables bias formula.</p></li>
</ol>
<p><strong>Exercise 2: Cluster-Robust Standard Errors</strong></p>
<p>You estimate a panel regression of test scores on class size using data from 100 schools over 3 years (300 observations). The coefficient on class size has:</p>
<ul>
<li>Default SE: 0.15 (t = 3.33)</li>
<li>Cluster-robust SE (by school): 0.45 (t = 1.11)</li>
</ul>
<ol type="a">
<li><p>Why is the cluster SE three times larger than the default SE?</p></li>
<li><p>Does your conclusion about the significance of class size change? At what significance level?</p></li>
<li><p>What is the effective number of independent observations in this panel?</p></li>
</ol>
<p><strong>Exercise 3: Fixed Effects vs.&nbsp;Random Effects</strong></p>
<p>You estimate a wage equation using panel data on 500 workers over 10 years. The Hausman test yields <span class="math inline">\(\chi^2 = 25.4\)</span> with 3 degrees of freedom (<span class="math inline">\(p &lt; 0.001\)</span>).</p>
<ol type="a">
<li><p>State the null and alternative hypotheses of the Hausman test.</p></li>
<li><p>What do you conclude? Which estimator should you use?</p></li>
<li><p>Give an economic reason why the RE assumption might fail in a wage equation (hint: think about unobserved ability).</p></li>
</ol>
<p><strong>Exercise 4: Time Series Autocorrelation</strong></p>
<p>A regression of the 10-year interest rate on the 1-year rate using monthly data yields residuals with:</p>
<ul>
<li>Lag 1 autocorrelation: 0.95</li>
<li>Lag 5 autocorrelation: 0.75</li>
<li>Default SE on the 1-year rate coefficient: 0.022</li>
<li>HAC SE (24 lags): 0.080</li>
</ul>
<ol type="a">
<li><p>Is there evidence of autocorrelation? What does the slowly decaying ACF pattern suggest about the data?</p></li>
<li><p>By what factor do the HAC SEs differ from default SEs? What are the implications for hypothesis testing?</p></li>
<li><p>Would first differencing help? What would you expect the lag 1 autocorrelation of the differenced residuals to be?</p></li>
</ol>
<p><strong>Exercise 5: Spurious Regression</strong></p>
<p>You regress GDP on the number of mobile phone subscriptions over 30 years and find <span class="math inline">\(R^2 = 0.97\)</span> with a highly significant coefficient.</p>
<ol type="a">
<li><p>Why might this be a spurious regression? What is the key characteristic of both series?</p></li>
<li><p>Describe two methods to address this problem.</p></li>
<li><p>If you first-difference both series, what economic relationship (if any) would the regression estimate?</p></li>
</ol>
<p><strong>Exercise 6: Identifying Causal Effects</strong></p>
<p>For each scenario, identify the main threat to causal inference and suggest an appropriate method:</p>
<ol type="a">
<li><p>Estimating the effect of police spending on crime rates across cities (cross-sectional data).</p></li>
<li><p>Estimating the effect of a minimum wage increase on employment (state-level panel data with staggered adoption).</p></li>
<li><p>Estimating the effect of class size on student achievement (students assigned to classes based on a cutoff rule).</p></li>
</ol>
</section>
<section id="case-studies" class="level2">
<h2 class="anchored" data-anchor-id="case-studies">Case Studies</h2>
<section id="case-study-1-panel-data-analysis-of-cross-country-productivity" class="level3">
<h3 class="anchored" data-anchor-id="case-study-1-panel-data-analysis-of-cross-country-productivity">Case Study 1: Panel Data Analysis of Cross-Country Productivity</h3>
<p>In this case study, you will apply panel data methods from this chapter to analyze labor productivity dynamics across countries using the Mendez convergence clubs dataset.</p>
<p><strong>Dataset:</strong> Mendez (2020) convergence clubs data</p>
<ul>
<li><strong>Source:</strong> <code>https://raw.githubusercontent.com/quarcs-lab/mendez2020-convergence-clubs-code-data/master/assets/dat.csv</code></li>
<li><strong>Sample:</strong> 108 countries, 1990-2014 (panel structure: country <span class="math inline">\(\times\)</span> year)</li>
<li><strong>Variables:</strong> <code>lp</code> (labor productivity), <code>rk</code> (physical capital), <code>hc</code> (human capital), <code>rgdppc</code> (real GDP per capita), <code>tfp</code> (total factor productivity), <code>region</code>, <code>country</code></li>
</ul>
<p><strong>Research question:</strong> How do physical and human capital affect labor productivity across countries, and does controlling for unobserved country characteristics change the estimates?</p>
<hr>
<section id="task-1-panel-data-structure-guided" class="level4">
<h4 class="anchored" data-anchor-id="task-1-panel-data-structure-guided">Task 1: Panel Data Structure (Guided)</h4>
<p>Load the dataset and explore its panel structure. Calculate the within and between variation for log labor productivity.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/quarcs-lab/mendez2020-convergence-clubs-code-data/master/assets/dat.csv"</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>dat <span class="op">=</span> pd.read_csv(url)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>dat[<span class="st">'ln_lp'</span>] <span class="op">=</span> np.log(dat[<span class="st">'lp'</span>])</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>dat[<span class="st">'ln_rk'</span>] <span class="op">=</span> np.log(dat[<span class="st">'rk'</span>])</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel structure</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Countries: </span><span class="sc">{</span>dat[<span class="st">'country'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Years: </span><span class="sc">{</span>dat[<span class="st">'year'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total observations: </span><span class="sc">{</span><span class="bu">len</span>(dat)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Variance decomposition</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>overall_var <span class="op">=</span> dat[<span class="st">'ln_lp'</span>].var()</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>between_var <span class="op">=</span> dat.groupby(<span class="st">'country'</span>)[<span class="st">'ln_lp'</span>].mean().var()</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>within_var <span class="op">=</span> dat.groupby(<span class="st">'country'</span>)[<span class="st">'ln_lp'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x <span class="op">-</span> x.mean()).var()</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Overall variance: </span><span class="sc">{</span>overall_var<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Between variance: </span><span class="sc">{</span>between_var<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Within variance: </span><span class="sc">{</span>within_var<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Which source of variation dominates? What does this imply for the choice between pooled OLS and fixed effects?</p>
<hr>
</section>
<section id="task-2-pooled-ols-with-cluster-robust-ses-guided" class="level4">
<h4 class="anchored" data-anchor-id="task-2-pooled-ols-with-cluster-robust-ses-guided">Task 2: Pooled OLS with Cluster-Robust SEs (Guided)</h4>
<p>Estimate a pooled OLS regression of log productivity on log physical capital and human capital. Compare default and cluster-robust standard errors (clustered by country).</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.formula.api <span class="im">import</span> ols</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>model_default <span class="op">=</span> ols(<span class="st">'ln_lp ~ ln_rk + hc'</span>, data<span class="op">=</span>dat).fit()</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>model_cluster <span class="op">=</span> ols(<span class="st">'ln_lp ~ ln_rk + hc'</span>, data<span class="op">=</span>dat).fit(</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    cov_type<span class="op">=</span><span class="st">'cluster'</span>, cov_kwds<span class="op">=</span>{<span class="st">'groups'</span>: dat[<span class="st">'country'</span>]}</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Default SE:"</span>, model_default.bse.<span class="bu">round</span>(<span class="dv">4</span>).to_dict())</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Cluster SE:"</span>, model_cluster.bse.<span class="bu">round</span>(<span class="dv">4</span>).to_dict())</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Ratio:"</span>, (model_cluster.bse <span class="op">/</span> model_default.bse).<span class="bu">round</span>(<span class="dv">2</span>).to_dict())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>How much larger are cluster SEs? What does this tell you about within-country correlation?</p>
<hr>
</section>
<section id="task-3-fixed-effects-estimation-semi-guided" class="level4">
<h4 class="anchored" data-anchor-id="task-3-fixed-effects-estimation-semi-guided">Task 3: Fixed Effects Estimation (Semi-guided)</h4>
<p>Estimate a fixed effects model controlling for country-specific characteristics. Compare the FE coefficients with the pooled OLS coefficients.</p>
<p><em>Hint:</em> Use <code>linearmodels.panel. PanelOLS</code> with <code>entity_effects=True</code>, or use the within transformation manually by de-meaning the variables by country.</p>
<p>Which coefficients change most? What unobserved country characteristics might be driving the difference?</p>
<hr>
</section>
<section id="task-4-time-trends-in-productivity-semi-guided" class="level4">
<h4 class="anchored" data-anchor-id="task-4-time-trends-in-productivity-semi-guided">Task 4: Time Trends in Productivity (Semi-guided)</h4>
<p>Add a time trend or year fixed effects to the panel model. Test whether productivity growth rates differ across regions.</p>
<p><em>Hint:</em> Use <code>time_effects=True</code> in PanelOLS for year fixed effects, or create region-year interaction terms.</p>
<p>Is there evidence of convergence (faster growth in initially poorer countries)?</p>
<hr>
</section>
<section id="task-5-regional-heterogeneity-with-interactions-independent" class="level4">
<h4 class="anchored" data-anchor-id="task-5-regional-heterogeneity-with-interactions-independent">Task 5: Regional Heterogeneity with Interactions (Independent)</h4>
<p>Estimate models that allow the returns to physical and human capital to vary by region:</p>
<ol type="1">
<li>Add region dummy variables</li>
<li>Add region-capital interaction terms</li>
<li>Test the joint significance of regional interactions</li>
</ol>
<p>Do returns to capital differ significantly across regions? Which regions show the highest returns to human capital?</p>
<hr>
</section>
<section id="task-6-policy-brief-on-capital-and-productivity-independent" class="level4">
<h4 class="anchored" data-anchor-id="task-6-policy-brief-on-capital-and-productivity-independent">Task 6: Policy Brief on Capital and Productivity (Independent)</h4>
<p>Write a 200-300 word policy brief addressing: What are the most effective channels for increasing labor productivity across countries? Your brief should:</p>
<ol type="1">
<li>Compare pooled OLS and fixed effects estimates of capital returns</li>
<li>Discuss whether the relationship is causal (what are the threats to identification?)</li>
<li>Evaluate whether returns to capital differ by region</li>
<li>Recommend policies based on the relative importance of physical vs.&nbsp;human capital</li>
</ol>
<blockquote class="blockquote">
<p><strong>Key Concept 17.9: Panel Data for Cross-Country Analysis</strong></p>
<p>Cross-country panel data enables controlling for time-invariant country characteristics (institutions, geography, culture) that confound cross-sectional estimates. Fixed effects absorb these permanent differences, identifying the relationship between capital accumulation and productivity growth from within-country variation over time. The typical finding is that FE coefficients are smaller than pooled OLS, indicating positive omitted variable bias in cross-sectional estimates.</p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Key Concept 17.10: Choosing Between Panel Data Estimators</strong></p>
<p>The choice between pooled OLS, fixed effects, and random effects depends on the research question and data structure. Use pooled OLS with cluster SEs for descriptive associations; use FE when unobserved individual heterogeneity is likely correlated with regressors (the common case); use RE only when individual effects are plausibly random and uncorrelated with regressors (e.g., randomized experiments). The Hausman test helps decide between FE and RE, but economic reasoning should guide the choice.</p>
</blockquote>
<p><strong>What You‚Äôve Learned:</strong> In this case study, you applied the complete panel data toolkit to cross-country productivity analysis. You decomposed variation into within and between components, compared pooled OLS with fixed effects, examined cluster-robust standard errors, and explored regional heterogeneity. These methods are essential for any empirical analysis using panel data.</p>
</section>
</section>
<section id="case-study-2-luminosity-and-development-over-time-a-panel-approach" class="level3">
<h3 class="anchored" data-anchor-id="case-study-2-luminosity-and-development-over-time-a-panel-approach">Case Study 2: Luminosity and Development Over Time: A Panel Approach</h3>
<p><strong>Research Question</strong>: How does nighttime luminosity evolve across Bolivia‚Äôs municipalities over time, and what does within-municipality variation reveal about development dynamics?</p>
<p><strong>Background</strong>: Throughout this textbook, we have analyzed <em>cross-sectional</em> satellite-development relationships. But the DS4Bolivia dataset includes nighttime lights data for 2012-2020, creating a natural <strong>panel dataset</strong>. In this case study, we apply Chapter 17‚Äôs panel data tools to track how luminosity evolves across municipalities over time, using fixed effects to control for time-invariant characteristics.</p>
<p><strong>The Data</strong>: The DS4Bolivia dataset covers 339 Bolivian municipalities with annual nighttime lights and population data for 2012-2020, yielding a potential panel of 3,051 municipality-year observations.</p>
<p><strong>Key Variables</strong>:</p>
<ul>
<li><code>mun</code>: Municipality name</li>
<li><code>dep</code>: Department (administrative region)</li>
<li><code>asdf_id</code>: Unique municipality identifier</li>
<li><code>ln_NTLpc2012</code> through <code>ln_NTLpc2020</code>: Log nighttime lights per capita (annual)</li>
<li><code>pop2012</code> through <code>pop2020</code>: Population (annual)</li>
</ul>
<section id="load-the-ds4bolivia-data-and-create-panel-structure" class="level4">
<h4 class="anchored" data-anchor-id="load-the-ds4bolivia-data-and-create-panel-structure">Load the DS4Bolivia Data and Create Panel Structure</h4>
<div id="cell-54" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the DS4Bolivia dataset</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.formula.api <span class="im">import</span> ols</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>url_bol <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/quarcs-lab/ds4bolivia/master/ds4bolivia_v20250523.csv"</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>bol <span class="op">=</span> pd.read_csv(url_bol)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Display available NTL and population variables</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>ntl_vars <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> bol.columns <span class="cf">if</span> c.startswith(<span class="st">'ln_NTLpc'</span>)]</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>pop_vars <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> bol.columns <span class="cf">if</span> c.startswith(<span class="st">'pop'</span>) <span class="kw">and</span> c[<span class="dv">3</span>:].isdigit()]</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"DS4BOLIVIA: PANEL DATA CASE STUDY"</span>)</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Cross-sectional units: </span><span class="sc">{</span><span class="bu">len</span>(bol)<span class="sc">}</span><span class="ss"> municipalities"</span>)</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">NTL variables available: </span><span class="sc">{</span>ntl_vars<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Population variables available: </span><span class="sc">{</span>pop_vars<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="task-1-create-panel-dataset-guided" class="level4">
<h4 class="anchored" data-anchor-id="task-1-create-panel-dataset-guided">Task 1: Create Panel Dataset (Guided)</h4>
<p><strong>Objective</strong>: Reshape the wide-format DS4Bolivia data into a long panel dataset.</p>
<p><strong>Instructions</strong>:</p>
<ol type="1">
<li>Select municipality identifiers (<code>mun</code>, <code>dep</code>, <code>asdf_id</code>) and annual NTL/population variables</li>
<li>Reshape from wide to long format using <code>pd.melt()</code> or manual reshaping</li>
<li>Create columns: <code>municipality</code>, <code>year</code>, <code>ln_NTLpc</code>, <code>pop</code>, <code>ln_pop</code></li>
<li>Verify the panel structure: 339 municipalities x 9 years = 3,051 observations</li>
<li>Show <code>head()</code> and <code>describe()</code> for the panel dataset</li>
</ol>
<div id="cell-56" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here: Reshape to panel format</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Example structure:</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># # Reshape NTL variables</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ntl_cols = {f'ln_NTLpc{y}': y for y in range(2012, 2021)}</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co"># pop_cols = {f'pop{y}': y for y in range(2012, 2021)}</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co"># # Melt NTL</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ntl_long = bol[['mun', 'dep', 'asdf_id'] + list(ntl_cols.keys())].melt(</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co">#     id_vars=['mun', 'dep', 'asdf_id'],</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     var_name='ntl_var', value_name='ln_NTLpc'</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="co"># ntl_long['year'] = ntl_long['ntl_var'].str.extract(r'(\d{4})').astype(int)</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="co"># # Melt Population</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="co"># pop_long = bol[['asdf_id'] + list(pop_cols.keys())].melt(</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     id_vars=['asdf_id'],</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     var_name='pop_var', value_name='pop'</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="co"># pop_long['year'] = pop_long['pop_var'].str.extract(r'(\d{4})').astype(int)</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a><span class="co"># # Merge</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a><span class="co"># panel = ntl_long.merge(pop_long[['asdf_id', 'year', 'pop']],</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a><span class="co">#                        on=['asdf_id', 'year'], how='left')</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a><span class="co"># panel['ln_pop'] = np.log(panel['pop'])</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a><span class="co"># panel = panel.sort_values(['asdf_id', 'year']).reset_index(drop=True)</span></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"Panel shape: {panel.shape}")</span></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"Municipalities: {panel['asdf_id'].nunique()}")</span></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"Years: {sorted(panel['year'].unique())}")</span></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a><span class="co"># print(panel.head(18))  # Show 2 municipalities</span></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a><span class="co"># print(panel[['ln_NTLpc', 'ln_pop', 'pop']].describe().round(3))</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<blockquote class="blockquote">
<p><strong>Key Concept 17.10: Satellite Panel Data</strong></p>
<p>Annual nighttime lights observations create <strong>panel datasets</strong> even where traditional economic surveys are unavailable or infrequent. For Bolivia‚Äôs 339 municipalities over 2012-2020, the NTL panel provides 3,051 municipality-year observations. This temporal dimension allows us to move beyond cross-sectional associations and study <em>changes within municipalities over time</em>‚Äîa crucial step toward understanding development dynamics rather than just static patterns.</p>
</blockquote>
</section>
<section id="task-2-pooled-ols-with-cluster-robust-ses-guided-1" class="level4">
<h4 class="anchored" data-anchor-id="task-2-pooled-ols-with-cluster-robust-ses-guided-1">Task 2: Pooled OLS with Cluster-Robust SEs (Guided)</h4>
<p><strong>Objective</strong>: Estimate a pooled OLS regression of NTL on population with cluster-robust standard errors.</p>
<p><strong>Instructions</strong>:</p>
<ol type="1">
<li>Estimate <code>ln_NTLpc ~ ln_pop + year</code> using all panel observations</li>
<li>Use cluster-robust standard errors clustered by municipality</li>
<li>Compare default and cluster-robust SEs</li>
<li>Interpret: How does population relate to NTL? Is there a significant time trend?</li>
</ol>
<div id="cell-59" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here: Pooled OLS with cluster-robust SEs</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Example structure:</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># panel_reg = panel[['ln_NTLpc', 'ln_pop', 'year', 'mun', 'asdf_id']].dropna()</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># model_pooled = ols('ln_NTLpc ~ ln_pop + year', data=panel_reg).fit(</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     cov_type='cluster', cov_kwds={'groups': panel_reg['asdf_id']}</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co"># print("POOLED OLS WITH CLUSTER-ROBUST SEs")</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co"># print(model_pooled.summary())</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="task-3-fixed-effects-semi-guided" class="level4">
<h4 class="anchored" data-anchor-id="task-3-fixed-effects-semi-guided">Task 3: Fixed Effects (Semi-guided)</h4>
<p><strong>Objective</strong>: Estimate a fixed effects model controlling for time-invariant municipality characteristics.</p>
<p><strong>Instructions</strong>:</p>
<ol type="1">
<li>Add municipality fixed effects using <code>C(asdf_id)</code> or entity demeaning</li>
<li>Compare FE coefficients with pooled OLS coefficients</li>
<li>How does controlling for time-invariant municipality characteristics change the population-NTL relationship?</li>
<li>Discuss: What unobserved factors do municipality fixed effects absorb (altitude, remoteness, climate)?</li>
</ol>
<p><strong>Hint</strong>: You can use <code>C(asdf_id)</code> in the formula, or manually demean variables by subtracting municipality means. For large datasets, demeaning is more computationally efficient.</p>
<div id="cell-61" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here: Fixed effects estimation</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Example structure (demeaning approach):</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># # Demean variables within each municipality</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co"># for col in ['ln_NTLpc', 'ln_pop']:</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     panel_reg[f'{col}_dm'] = panel_reg.groupby('asdf_id')[col].transform(</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co">#         lambda x: x - x.mean()</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co">#     )</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="co"># panel_reg['year_dm'] = panel_reg['year'] - panel_reg.groupby('asdf_id')['year'].transform('mean')</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="co"># model_fe = ols('ln_NTLpc_dm ~ ln_pop_dm + year_dm - 1', data=panel_reg).fit(</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     cov_type='cluster', cov_kwds={'groups': panel_reg['asdf_id']}</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="co"># print("FIXED EFFECTS (WITHIN ESTIMATOR)")</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="co"># print(model_fe.summary())</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="co"># print("\nCOMPARISON:")</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"  Pooled OLS ln_pop coef: {model_pooled.params['ln_pop']:.4f}")</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"  Fixed Effects ln_pop coef: {model_fe.params['ln_pop_dm']:.4f}")</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<blockquote class="blockquote">
<p><strong>Key Concept 17.11: Fixed Effects for Spatial Heterogeneity</strong></p>
<p>Municipality fixed effects absorb all <strong>time-invariant characteristics</strong>: altitude, remoteness, climate, historical infrastructure, cultural factors. After removing these fixed differences, the remaining variation identifies how <em>changes</em> in population (or other time-varying factors) relate to <em>changes</em> in NTL within the same municipality. This within-municipality analysis is more credible for causal interpretation than cross-sectional regressions, because it eliminates bias from unobserved time-invariant confounders.</p>
</blockquote>
</section>
<section id="task-4-time-trends-semi-guided" class="level4">
<h4 class="anchored" data-anchor-id="task-4-time-trends-semi-guided">Task 4: Time Trends (Semi-guided)</h4>
<p><strong>Objective</strong>: Examine how nighttime lights evolve over time using year fixed effects.</p>
<p><strong>Instructions</strong>:</p>
<ol type="1">
<li>Replace the linear time trend with year dummy variables: <code>C(year)</code></li>
<li>Test whether the year effects are jointly significant</li>
<li>Plot the estimated year coefficients to visualize the NTL trajectory</li>
<li>Discuss: Did NTL grow steadily, or were there jumps or declines?</li>
</ol>
<p><strong>Hint</strong>: Use one year as the reference category. The year coefficients show NTL changes relative to the base year.</p>
<div id="cell-64" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here: Year fixed effects</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Example structure:</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># # Estimate with year dummies (demeaned for municipality FE)</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># panel_reg['year_cat'] = panel_reg['year'].astype(str)</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co"># # Simple approach: use year means of demeaned NTL</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co"># year_means = panel_reg.groupby('year')['ln_NTLpc'].mean()</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co"># year_means_dm = year_means - year_means.iloc[0]  # relative to base year</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="co"># fig, ax = plt.subplots(figsize=(10, 6))</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co"># ax.plot(year_means.index, year_means.values, 'o-', color='navy', linewidth=2)</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="co"># ax.set_xlabel('Year')</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ax.set_ylabel('Mean Log NTL per Capita')</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ax.set_title('Average Municipal NTL Over Time (2012-2020)')</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="co"># ax.grid(True, alpha=0.3)</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.tight_layout()</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.show()</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="task-5-first-differences-independent" class="level4">
<h4 class="anchored" data-anchor-id="task-5-first-differences-independent">Task 5: First Differences (Independent)</h4>
<p><strong>Objective</strong>: Estimate the relationship using first differences as an alternative to fixed effects.</p>
<p><strong>Instructions</strong>:</p>
<ol type="1">
<li>Compute first differences: <span class="math inline">\(\Delta ln\_NTLpc = ln\_NTLpc_t - ln\_NTLpc_{t-1}\)</span> and <span class="math inline">\(\Delta ln\_pop = ln\_pop_t - ln\_pop_{t-1}\)</span></li>
<li>Estimate <span class="math inline">\(\Delta ln\_NTLpc \sim \Delta ln\_pop\)</span></li>
<li>Compare the first-difference coefficient with the fixed effects estimate</li>
<li>Discuss: When do FE and FD give different results? What assumptions does each require?</li>
</ol>
<div id="cell-66" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here: First differences estimation</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Example structure:</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># panel_reg = panel_reg.sort_values(['asdf_id', 'year'])</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co"># panel_reg['d_ln_NTLpc'] = panel_reg.groupby('asdf_id')['ln_NTLpc'].diff()</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co"># panel_reg['d_ln_pop'] = panel_reg.groupby('asdf_id')['ln_pop'].diff()</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="co"># # Drop first year (no difference available)</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co"># fd_data = panel_reg.dropna(subset=['d_ln_NTLpc', 'd_ln_pop'])</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="co"># model_fd = ols('d_ln_NTLpc ~ d_ln_pop', data=fd_data).fit(</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     cov_type='cluster', cov_kwds={'groups': fd_data['asdf_id']}</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="co"># print("FIRST DIFFERENCES ESTIMATION")</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="co"># print(model_fd.summary())</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"\nFD coefficient on ln_pop: {model_fd.params['d_ln_pop']:.4f}")</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="task-6-panel-brief-independent" class="level4">
<h4 class="anchored" data-anchor-id="task-6-panel-brief-independent">Task 6: Panel Brief (Independent)</h4>
<p><strong>Objective</strong>: Write a 200-300 word brief summarizing your panel data analysis.</p>
<p><strong>Your brief should address</strong>:</p>
<ol type="1">
<li>What do within-municipality changes in NTL reveal about development dynamics?</li>
<li>How does the FE population coefficient differ from the cross-sectional (pooled OLS) one?</li>
<li>What time trends in NTL are visible across 2012-2020?</li>
<li>How do FE and FD estimates compare? Which assumptions matter most?</li>
<li>What are the advantages and limitations of satellite panel data for tracking municipal development over time?</li>
<li>What additional time-varying variables would improve the analysis?</li>
</ol>
<div id="cell-68" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here: Additional analysis for the panel brief</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># You might want to:</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Decompose variance into between and within components</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Plot NTL trajectories for selected municipalities</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Compare growth rates across departments</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Create a summary table of all estimation results</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Variance decomposition</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co"># overall_var = panel_reg['ln_NTLpc'].var()</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co"># between_var = panel_reg.groupby('asdf_id')['ln_NTLpc'].mean().var()</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co"># within_var = panel_reg.groupby('asdf_id')['ln_NTLpc'].apply(lambda x: x - x.mean()).var()</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"Overall variance: {overall_var:.4f}")</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"Between variance: {between_var:.4f}")</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"Within variance:  {within_var:.4f}")</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"Between share:    {between_var/overall_var:.1%}")</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="what-youve-learned-from-this-case-study" class="level4">
<h4 class="anchored" data-anchor-id="what-youve-learned-from-this-case-study">What You‚Äôve Learned from This Case Study</h4>
<p>This is the final DS4Bolivia case study in the textbook. Across 12 chapters, you have applied the complete econometric toolkit‚Äîfrom simple descriptive statistics (Chapter 1) through panel data methods (Chapter 17)‚Äîto study how satellite data can predict and monitor local economic development. The DS4Bolivia project demonstrates that modern data science and econometrics, combined with freely available satellite imagery, can contribute to SDG monitoring even in data-scarce contexts.</p>
<p>In this panel data analysis, you‚Äôve applied Chapter 17‚Äôs complete toolkit:</p>
<ul>
<li><strong>Panel construction</strong>: Reshaped cross-sectional data into a municipality-year panel</li>
<li><strong>Pooled OLS</strong>: Estimated baseline relationships with cluster-robust standard errors</li>
<li><strong>Fixed effects</strong>: Controlled for time-invariant municipality characteristics</li>
<li><strong>Time trends</strong>: Examined the trajectory of nighttime lights across 2012-2020</li>
<li><strong>First differences</strong>: Used an alternative estimation strategy and compared with FE</li>
<li><strong>Critical thinking</strong>: Assessed what within-municipality variation reveals about development dynamics</li>
</ul>
<p><strong>Congratulations!</strong> You have now completed the full DS4Bolivia case study arc across the textbook.</p>
<hr>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../notebooks_colab/ch16_Checking_the_Model_and_Data.html" class="pagination-link" aria-label="16. Checking the Model and Data">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">16. Checking the Model and Data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>